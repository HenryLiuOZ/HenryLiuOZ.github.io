<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Reinforcement-Learning" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/08/Reinforcement-Learning/" class="article-date">
  <time class="dt-published" datetime="2024-09-08T09:05:10.000Z" itemprop="datePublished">2024-09-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/09/08/Reinforcement-Learning/">Reinforcement Learning</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>æ­¤åšå®¢ä¸»è¦ä»‹ç»å¼ºåŒ–å­¦ä¹ ç®—æ³•ï¼Œç›¸å…³è®ºæ–‡ä¹Ÿä¼šæ”¾åœ¨é‡Œé¢</p>
<h2 id="Chapter1ï¼šå¼ºåŒ–å­¦ä¹ èƒŒæ™¯ä¸åŸºç¡€çŸ¥è¯†"><a href="#Chapter1ï¼šå¼ºåŒ–å­¦ä¹ èƒŒæ™¯ä¸åŸºç¡€çŸ¥è¯†" class="headerlink" title="Chapter1ï¼šå¼ºåŒ–å­¦ä¹ èƒŒæ™¯ä¸åŸºç¡€çŸ¥è¯†"></a>Chapter1ï¼šå¼ºåŒ–å­¦ä¹ èƒŒæ™¯ä¸åŸºç¡€çŸ¥è¯†</h2><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://huggingface.co/learn/deep-rl-course/unit1/what-is-rl">huggingface</a><br><a target="_blank" rel="noopener" href="https://github.com/MathFoundationRL/Book-Mathmatical-Foundation-of-Reinforcement-Learning">WindyLab</a></p>
<p>å•æ™ºèƒ½ä½“å¼ºåŒ–å­¦ä¹ æ—¨åœ¨è§£å†³ä¸€ç±»é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ (é©¬å°”å¯å¤«æ€§ï¼šç¯å¢ƒçŠ¶æ€è½¬ç§»çš„æ¦‚ç‡ä»…ä¾èµ–äºå½“å‰çŠ¶æ€å’ŒåŠ¨ä½œ) çš„é—®é¢˜ã€‚å¼ºåŒ–å­¦ä¹ çš„å‡è®¾æ˜¯ä»£ç†èƒ½å¤Ÿåœ¨ä¸€ä¸ªé™æ€ç¯å¢ƒ <em>environment with stationary distribution</em> ï¼ˆçŠ¶æ€è½¬ç§»æ¦‚ç‡å’Œå¥–åŠ±å‡½æ•°æ˜¯æ’å®šçš„ï¼‰ä¸­é€šè¿‡ä¸ç¯å¢ƒçš„äº¤äº’å¯»æ‰¾æœ€å¤§åŒ–å¥–åŠ±çš„è¡Œä¸ºã€‚<br>åœ¨å•æ™ºèƒ½ä½“å¼ºåŒ–å­¦ä¹ ä¸­ï¼Œæ™ºèƒ½ä½“åŸºäº <strong>å½“å‰ç¯å¢ƒ</strong> é‡‡å–æŸäº›actionå¹¶ä¸ç¯å¢ƒè¿›è¡Œäº¤äº’ï¼Œè¿™äº›åŠ¨ä½œå¯èƒ½ä¼šæ”¹å˜ç¯å¢ƒçš„çŠ¶æ€ï¼Œç¯å¢ƒæ ¹æ®äººä¸ºå®šä¹‰çš„å¥–åŠ±å‡½æ•°å‘æ™ºèƒ½ä½“åé¦ˆå¥–åŠ±rã€‚å¼ºåŒ–å­¦ä¹ ç®—æ³•ä»¥ä¼˜åŒ–åˆ° <strong>è´å°”æ›¼æœ€ä¼˜å…¬å¼</strong> ä¸ºç›®æ ‡ï¼Œå¯»æ‰¾æœ€ä¼˜ç­–ç•¥Ï€âˆ—(a|s)  </p>
<hr>
<p>åŸºæœ¬æ¦‚å¿µï¼š</p>
<ul>
<li>state transition probability: $p(sâ€™|s,a)$</li>
<li>reward function: $r(s,a)$</li>
<li>policy function: $\pi(a|s)$, the only variable while training</li>
<li>state value:<br>$v_{\pi}(s)&#x3D;E[\sum_{t&#x3D;0}^{\infty} \gamma^{t}R_{t+1}|S_t&#x3D;s]$<br>$R_{t+1}$ is the immediate reward following current policy<br>matrix form: $v_{\pi}&#x3D;r_{\pi}+\gamma P_{\pi}v_{\pi}$</li>
<li>action value: $v_{\pi}(s)&#x3D;\sum_a \pi(a|s)q_{\pi}(s)$</li>
<li>Bellman equation: $v_{\pi}(s)&#x3D;\sum_a \pi(a|s)(\sum_r p(r|s,a)*r+\sum_{sâ€™}p(sâ€™|s,a)v_{\pi}(sâ€™))$<br>matrix form: $v_{\pi}&#x3D;r_{\pi}+\gamma P_{\pi}v_{\pi}$</li>
<li>Bellman Optimal Equation: for any policy $\pi$ and state s, $v_{\pi*}(s)\geq v_{\pi}(s)$<br>matrix form: $v&#x3D;f(v)&#x3D;{max}<em>{\pi}$ $(r</em>{\pi}+\gamma v)$</li>
</ul>
<hr>
<p><a target="_blank" rel="noopener" href="https://github.com/HenryLiuOZ/Reinforcement-Learning-Notes">my RL notes</a></p>
<h2 id="Chapter2ï¼šå†…åœ¨åŠ¨æœºå¼ºåŒ–å­¦ä¹ ç®—æ³•ï¼ˆIMRLï¼‰"><a href="#Chapter2ï¼šå†…åœ¨åŠ¨æœºå¼ºåŒ–å­¦ä¹ ç®—æ³•ï¼ˆIMRLï¼‰" class="headerlink" title="Chapter2ï¼šå†…åœ¨åŠ¨æœºå¼ºåŒ–å­¦ä¹ ç®—æ³•ï¼ˆIMRLï¼‰"></a>Chapter2ï¼šå†…åœ¨åŠ¨æœºå¼ºåŒ–å­¦ä¹ ç®—æ³•ï¼ˆIMRLï¼‰</h2><p><a target="_blank" rel="noopener" href="https://github.com/yuqingd/ellm?tab=readme-ov-file">Guiding Pretraining in Reinforcement Learning with Large Language Models</a></p>
<p>å®é™…é—®é¢˜ï¼šâ€When reward functions are sparse, agents often need to carry out a long, specific sequence of actions to achieve target tasks. As action spaces or target behaviors grow more complex, the space of alternative action sequences agents can explore grows combnatorially. In such scenarios, undirected exploration that randomly perturbs actions or policy parameters has littlechance of succeedingâ€ ä»£ç†åœ¨å¥–åŠ±ç¨€ç–ç¯å¢ƒä¸­è®­ç»ƒå›°éš¾ï¼Œäººä¸ºè®¾è®¡é¢‘ç¹ç²¾ç»†çš„å¥–åŠ±è´¹æ—¶è´¹åŠ›</p>
<p>åˆæ­¥è§£å†³-IMRLï¼šâ€Many distinct action sequences can lead to similar outcomes (Baranes &amp; Oudeyer, 2013)â€”for example, most action sequences cause a humanoid agent to fall, while very few make it walk. Building on this observation, intrinsically motivated RL algorithms (IM-RL) choose to explore outcomes rather than actionsâ€ IMRLåŸºäºæ–°é¢–çš„è¡Œä¸ºç»“æœä¸ºä»£ç†æä¾›å†…åœ¨å¥–åŠ±ä»è€Œä¿ƒä½¿ä»£ç†åšå‡ºä¸åŒçš„æ¢ç´¢ã€‚è€Œä»…ä»…æ˜¯æ¢ç´¢æ›´æ–°å¥‡çš„çŠ¶æ€å¯èƒ½ä¼šä¿ƒä½¿ä»£ç†æ²‰æµ¸åœ¨ä¸æœ€ç»ˆç›®æ ‡æ— å…³çš„è¡Œä¸ºä¸­ã€‚Competence-based Intrinsic MotivationåŸºäºè¯„ä¼°ä»£ç† <em>æŒæ¡æ–°çš„æŠ€èƒ½</em> ç»™å‡ºå¥–åŠ±<br>â€œThe approach we introduce in this paper, ELLM, may be interpreted as a CB-IM algorithm that seeks to explore the space of possible and plausibly useful skills informed by human prior knowledge.â€</p>
<h3 id="CB-IM"><a href="#CB-IM" class="headerlink" title="CB-IM"></a>CB-IM</h3><p>â€œA CB-IM agent is expected to perform well with respect to the original R when the intrinsic reward <strong>Rint(o,a,oâ€™|g)</strong> is both easier to optimize and well aligned with R, such that behaviors maximizing Rint also maximize R.â€ è¿™ä¸ªRintå’Œgoaléœ€è¦æ‰‹åŠ¨è®¾è®¡ â€œMost CB-IM algorithms hand-define the reward functions Rint and the support of the goal distribution in alignment with the original task R, but use various intrinsic motivations to guide goal sampling (1): e.g.novelty, learning progress, intermediate difficultyâ€ è€ŒELLMä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹è‡ªåŠ¨ç”Ÿæˆç›®æ ‡å¹¶è¯„ä¼°ä»£ç†è¡Œä¸º</p>
<h3 id="ELLM"><a href="#ELLM" class="headerlink" title="ELLM"></a>ELLM</h3><p><img src="/images/MARL/Rint_define.png" alt="Rint define"><br><img src="/images/MARL/ELLMprocess.png" alt="ELLMprocess"><br>â€œWe consider two forms of agent training: (1) a goal conditioned setting where the agent is given a sentence embedding of the list of suggested goals, Ï€(a | o,E(g1:k)), and (2) a goal-free setting where the agent does not have access to the suggested goals, Ï€(a | o). While Rint remains the same in either case, training a goal-conditioned agent introduces both challenges and benefits: <strong>it can take time for the agent to learn the meaning of the different goals and connect it to the reward</strong>, but having a language-goal conditioned policy can be moreamenable to downstream tasks than an agent just trained on an exploration reward.â€</p>
<h3 id="è®ºæ–‡æ¯”è¾ƒ-Eureka"><a href="#è®ºæ–‡æ¯”è¾ƒ-Eureka" class="headerlink" title="è®ºæ–‡æ¯”è¾ƒ-Eureka"></a>è®ºæ–‡æ¯”è¾ƒ-Eureka</h3><p>éƒ½æ˜¯è®¾è®¡å¥–åŠ±å‡½æ•°ä»¥è§£å†³ç¯å¢ƒå¥–åŠ±ç¨€ç–é—®é¢˜ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/eureka-research/Eureka?tab=readme-ov-file">Eureka</a>ä¸ELLMæœ‰ä½•ä¸åŒï¼Ÿ<br><img src="/images/Multi-Agents/Eureka1.png" alt="baseline"><br>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒEurekaæ›´åŠ â€œé»‘ç›’â€ã€‚ELLMæ˜¯å¸¦æœ‰é€»è¾‘æ€§çš„(å¦‚æœä½ æ‰¿è®¤LLMæœ‰é€»è¾‘çš„è¯)ï¼Œå®ƒæ ¹æ®æ¸¸æˆè§„åˆ™ä¸ºä»£ç†ç»™å‡ºå»ºè®®ï¼Œå¹¶é¼“åŠ±ä»£ç†è¾¾æˆè¿™äº›ç›®æ ‡ï¼›è€ŒEurekaæ˜¯çº¯ç²¹çš„å¥–åŠ±è®¾è®¡ï¼Œå®ƒå…ˆç”Ÿæˆä¸€æ‰¹å¥–åŠ±å‡½æ•°ï¼Œå†åœ¨ç¯å¢ƒä¸­è®­ç»ƒä»£ç†ï¼ŒæŒ‘é€‰é‚£äº›èƒ½è®©ä»£ç†è®­ç»ƒæ•ˆæœæ›´å¥½çš„å¥–åŠ±å‡½æ•°ï¼Œå¹¶ä¸æ–­è¿­ä»£</p>
<h3 id="ELLM-recurrence"><a href="#ELLM-recurrence" class="headerlink" title="ELLM recurrence"></a>ELLM recurrence</h3><p><a target="_blank" rel="noopener" href="https://gitmind.com/app/docs/mnobpjvz">my code mind map for ellm</a><br>å¯æƒœçš„æ˜¯ï¼Œellmå¹¶æ²¡æœ‰åšä»»ä½•çš„å¯è§†åŒ–ï¼Œæµ‹è¯•å‘˜å”¯ä¸€èƒ½çœ‹åˆ°çš„å°±æ˜¯è®­ç»ƒè¿›ç¨‹çš„tensorboardæˆ–è€…æœ€ç»ˆç”Ÿæˆçš„stats.jsonlæ–‡ä»¶<br>ellmä¸»è¦ä¼ é€’ç»™agentçš„observationæ˜¯æ¸¸æˆç¯å¢ƒçš„textæè¿°+å¯¹text_obsç”¨sentence-transformer tokenizeåŒ–</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">tokenize_obs</span>(<span class="params">self, obs_dict</span>):</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  Takes in obs dict and returns a dict where all strings are tokenized.</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="variable language_">self</span>.use_sbert <span class="keyword">and</span> <span class="built_in">isinstance</span>(obs_dict[<span class="string">&#x27;inv_status&#x27;</span>], <span class="built_in">dict</span>):</span><br><span class="line">      inv_status = <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="keyword">for</span> k, v <span class="keyword">in</span> obs_dict[<span class="string">&#x27;inv_status&#x27;</span>].items():</span><br><span class="line">          <span class="keyword">if</span> v != <span class="string">&#x27;.&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;null&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> v:</span><br><span class="line">              inv_status += v + <span class="string">&quot; &quot;</span></span><br><span class="line">      obs_dict[<span class="string">&#x27;text_obs&#x27;</span>] = obs_dict[<span class="string">&#x27;text_obs&#x27;</span>] + <span class="string">&quot; &quot;</span> + inv_status</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">text_obs</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Return a dictionary of text observations&quot;&quot;&quot;</span></span><br><span class="line">    inv, status = <span class="variable language_">self</span>._inventory_to_text()</span><br><span class="line">    obs = <span class="variable language_">self</span>._text_view.local_sentence_view(<span class="variable language_">self</span>.player)</span><br><span class="line">    <span class="keyword">return</span> obs.lower(), &#123;<span class="string">&#x27;inv&#x27;</span> : inv.lower(), <span class="string">&#x27;status&#x27;</span>: status.lower()&#125;</span><br></pre></td></tr></table></figure>

<p>tokenize_obs()ä¸»è¦å°†å½“å‰çš„text_obs()ä¸€ä¸²å­—ç¬¦ä¸²ä½¿ç”¨sentence-transformerè½¬æ¢ä¸ºä¸€ä¸²å€¼ï¼ˆæ–¹ä¾¿ç¥ç»ç½‘ç»œå­¦ä¹ ï¼‰</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EmbeddingView</span>(<span class="title class_ inherited__">SemanticView</span>):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, world, obj_types, grid</span>):</span><br><span class="line">    <span class="built_in">super</span>().__init__(world, obj_types)</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">self</span>._grid = np.array(grid)</span><br><span class="line">    <span class="variable language_">self</span>._offset = <span class="variable language_">self</span>._grid // <span class="number">2</span></span><br><span class="line">    <span class="variable language_">self</span>._area = np.array(<span class="variable language_">self</span>._world.area)</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">self</span>._names = &#123;value : key <span class="keyword">for</span> (key, value) <span class="keyword">in</span> <span class="variable language_">self</span>._mat_ids.items()&#125;</span><br><span class="line">    <span class="variable language_">self</span>._obj_names = &#123;value : key.__name__ <span class="keyword">for</span> (key, value) <span class="keyword">in</span> <span class="variable language_">self</span>._obj_ids.items()&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">self</span>._names.update(<span class="variable language_">self</span>._obj_names)</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">local_view</span>(<span class="params">self, player_pos</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Return local view of semantic array.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    center = np.array(player_pos)</span><br><span class="line">    canvas = <span class="variable language_">self</span>._world._mat_map.copy()</span><br><span class="line">    <span class="keyword">for</span> obj <span class="keyword">in</span> <span class="variable language_">self</span>._world.objects:</span><br><span class="line">      canvas[<span class="built_in">tuple</span>(obj.pos)] = <span class="variable language_">self</span>._obj_ids[<span class="built_in">type</span>(obj)]</span><br><span class="line">    local_canvas = np.zeros(<span class="variable language_">self</span>._grid)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>._grid[<span class="number">0</span>]):</span><br><span class="line">      <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>._grid[<span class="number">1</span>]):</span><br><span class="line">        pos = center + np.array([x, y]) - <span class="variable language_">self</span>._offset</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> _inside((<span class="number">0</span>, <span class="number">0</span>), pos, <span class="variable language_">self</span>._area):</span><br><span class="line">          <span class="keyword">continue</span> </span><br><span class="line">        local_canvas[x,y] = canvas[<span class="built_in">tuple</span>(pos)]</span><br><span class="line">    <span class="keyword">return</span> local_canvas</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">local_token_view</span>(<span class="params">self, player</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">      Return a token representation of the observations.</span></span><br><span class="line"><span class="string">      [[&quot;grass&quot;, &quot;grass&quot;, &quot;tree&quot;],</span></span><br><span class="line"><span class="string">       [&quot;grass, &quot;player&quot;, &quot;grass&quot;],</span></span><br><span class="line"><span class="string">       ...] </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    local_canvas = <span class="variable language_">self</span>.local_view(player.pos)</span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> Right now we replace each index with the corresponding string. </span></span><br><span class="line">    <span class="comment"># In the future, we should place in word embedding directly.</span></span><br><span class="line">    name_canvas = []</span><br><span class="line">    <span class="keyword">for</span> x, row <span class="keyword">in</span> <span class="built_in">enumerate</span>(local_canvas): </span><br><span class="line">      name_canvas.append([])</span><br><span class="line">      <span class="keyword">for</span> y, idx <span class="keyword">in</span> <span class="built_in">enumerate</span>(row):</span><br><span class="line">        name = <span class="variable language_">self</span>._names[idx]</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">          name = <span class="string">&#x27;Null&#x27;</span></span><br><span class="line">        name_canvas[x].append(name)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> name_canvas</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">local_sentence_view</span>(<span class="params">self, player</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">      Return a sentence representation of the observations.</span></span><br><span class="line"><span class="string">      &quot;You see cows, trees, and grass&quot;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    local_canvas = <span class="variable language_">self</span>.local_view(player.pos)</span><br><span class="line">    sentence_obs = <span class="string">&quot;You see &quot;</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>è€Œå½“å‰ç¯å¢ƒçš„text_obsç”¨äº†æ¯ä¸ªgameobjectçš„ç¼–å·æ¥ä»£æ›¿å®ƒæœ¬èº«åœ¨æ¸¸æˆä¸­çš„åƒç´ ç‚¹ï¼Œæ‰€ä»¥å–å‡ºæ¥ä¹Ÿæ˜¯ä¸€ä¸ªæ•´æ•°çŸ©é˜µï¼Œç®—æ˜¯ä¸€ä¸ªå–å·§çš„æ–¹æ³•ï¼Œä½†å¯æƒœè¿™ä¸ªæ¸¸æˆå°±å¤±å»äº†å¯è§†åŒ–ç•Œé¢äº†</p>
<p>å›åˆ°æˆ‘æœ€å¼€å§‹çš„ç ”ç©¶æ€è·¯ï¼šå½“å‰ellmæ˜¯é€šè¿‡LMä¸ºä»£ç†æä¾›å»ºè®®ï¼Œå¹¶å¥–åŠ±ä»£ç†è¾¾æˆè¿™äº›å»ºè®®ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯ä¸ºä»€ä¹ˆä¸ç›´æ¥è®©LMç”Ÿæˆä¸€æ¡è·¯å¾„ï¼Œç›´æ¥ <em>æ“çºµä»£ç†å»æ‰§è¡Œè¿™æ¡åŠ¨ä½œè·¯å¾„</em> ï¼Œè¿™æ ·ä¹Ÿå…å»äº†ä»£ç†éœ€è¦å­¦ä¹ åšå‡ºåŠ¨ä½œå’Œå¯¹åº”å»ºè®®ä¹‹é—´å…³ç³»çš„è®­ç»ƒæ—¶é—´<br><strong>ellmå’Œè½¨è¿¹ç”Ÿæˆçš„åŒºåˆ«å®é™…å¾ˆå°</strong>ï¼šæˆ‘å½“æ—¶ä»¥ä¸ºellmç”Ÿæˆçš„å»ºè®®ä¾æ—§æ˜¯éœ€è¦å¤šä¸ªæ—¶é—´æ­¥ä»¥è¾¾æˆçš„å»ºè®®ï¼Œæ¯”å¦‚å»ºè®®ä»£ç†ç°åœ¨åšä¸€å¼ æ¡Œå­ï¼Œå¯èƒ½éœ€è¦å…ˆå»ç æ ‘ï¼Œå†åˆæˆï¼›äº‹å®ä¸Šellmé‡‡ç”¨çš„crafterç¯å¢ƒæ˜¯ä¸€ä¸ªè¿‡äºç®€å•çš„æ¸¸æˆç¯å¢ƒï¼Œå»ºè®®æ˜¯åœ¨æ¯ä¸€ä¸ªæ—¶é—´æ­¥ç”Ÿæˆï¼Œå¹¶ä¸”ä¿è¯æ¯ä¸€ä¸ªæ—¶é—´æ­¥éƒ½èƒ½è¾¾æˆä¸€ä¸ªå»ºè®®ï¼ˆå»ºè®®å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªactionï¼Œè¿™å’Œç”Ÿæˆä¸€ä¸ªtrajectoryä¹Ÿæ²¡ä»€ä¹ˆåŒºåˆ«äº†ï¼‰<br><strong>æˆ‘å½“å‰çš„ç ”ç©¶æ€è·¯</strong>ï¼šå°†ellmçš„æ–¹æ³•è¿ç”¨åˆ°æˆ‘çš„FRCThreeç¯å¢ƒä¸­ï¼Œæˆ‘å¯ä»¥åƒellmä¸€æ ·ï¼Œå…ˆç”Ÿæˆæ¯ä¸€æ­¥çš„åŠ¨ä½œå»ºè®®ï¼Œå†è®¡ç®—å½“å‰åŠ¨ä½œå’Œä¸Šä¸€æ¬¡å»ºè®®ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼›ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®ç°ä¸€äº›å‡½æ•°ï¼ˆå¦‚move_a_step_toï¼‰å¹¶ä¸”è®©LMåœ¨æ¯ä¸€æ­¥é€‰æ‹©è¿™äº›å‡½æ•°å¹¶è°ƒç”¨ï¼ˆ<em>æ“çºµä»£ç†å»æ‰§è¡Œè¿™æ¡åŠ¨ä½œè·¯å¾„</em>ï¼‰ï¼Œæœ‰æ²¡æœ‰è§‰å¾—è¿™æœ‰ç‚¹åƒå®‹å­¦é•¿ä¸Šä¸ªæ˜ŸæœŸçš„æ±‡æŠ¥ï¼Ÿ<br>æ›´è¿›ä¸€æ­¥ï¼Œæˆ‘è®¤ä¸ºå½“å‰çš„ç®—æ³•ä¸è¶³ä»¥è§£å†³3v3çš„å¤šæ™ºèƒ½ä½“é—®é¢˜ï¼ˆæˆ‘ä»¬èƒ½ä¿è¯LMåŒæ—¶ç»™ä¸‰ä¸ªæœºå™¨äººæä¾›å»ºè®®ä¸ä¼šé€ æˆå†²çªå—ï¼Œæ¯”å¦‚ï¼ŒåŒæ—¶å»ºè®®ä»–ä»¬ä¸‰ä¸ªå»æ‹¿ä¸€ä¸ªNOTEï¼Ÿï¼‰ï¼Œæˆ‘è¿‘æœŸå†çœ‹ä¸€äº›å¤šæ™ºèƒ½ä½“ç®—æ³•çš„æ–‡ç« ï¼Œæ•´ç†ä¸€ä¸‹è‡ªå·±çš„æ€è·¯ï¼Œäº‰åœ¨1æœˆä»½å‰ç¡®å®šè‡ªå·±æœ€ç»ˆçš„ç®—æ³•ç»“æ„</p>
<h2 id="Chapter3ï¼šå¤šæ™ºèƒ½ä½“articleæ‚è°ˆ"><a href="#Chapter3ï¼šå¤šæ™ºèƒ½ä½“articleæ‚è°ˆ" class="headerlink" title="Chapter3ï¼šå¤šæ™ºèƒ½ä½“articleæ‚è°ˆ"></a>Chapter3ï¼šå¤šæ™ºèƒ½ä½“articleæ‚è°ˆ</h2><p><a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/document/10715990">Dynamic Formation Planning and Control for Robot Soccer Game with Multi-Agent Reinforcement Learning and Behavioral Model</a><br>æå‡ºäº†ä¸€ä¸ªéå¯¹ç§°å¯¹æŠ—ç¯å¢ƒ2(è¿›æ”»æ–¹)vs3(é˜²å®ˆæ–¹)ï¼Œé˜²å®ˆæ–¹é‡‡ç”¨PPOè®­ç»ƒï¼Œè€Œè¿›æ”»æ–¹ä½¿ç”¨äº†ä¸€ä¸ªç±»ä¼¼çŠ¶æ€æœºçš„behavior model<br><img src="/images/MARL/soccer2v3.png" alt="soccer2v3"><br><img src="/images/MARL/behavior_model.png" alt="behavior_model"><br>æ§åˆ¶æœºå™¨äººè¿½é€å°çƒï¼šu &#x3D; qdâ€™- Kp(q-qd)ï¼Œqdä¸ºå°çƒä½ç½®ï¼Œqä¸ºæœºå™¨äººä½ç½®ï¼Œuä¸ºç”µæœºå†²å‡»è¾“å…¥<br>é˜µå‹æ§åˆ¶ï¼šu &#x3D; qdâ€™ - Kp(q-qd) - Î±Î”Ïˆï¼Œå…¶ä¸­qdä¸ºè§„åˆ’å™¨ç”Ÿæˆçš„ç›®æ ‡ä½ç½®ï¼ŒÎ”Ïˆ &#x3D; {Ïˆ1-Ïˆn,Ïˆ2-Ïˆ1,â€¦,Ïˆn-Ïˆn-1}ï¼ŒÏˆ1 &#x3D; Î”q1-Î”q2ï¼ŒÏˆn &#x3D; Î”qn-Î”q1ï¼ŒÎ”qi&#x3D;qi-qdi<br>æˆ‘è§‰å¾—ç»“æœä¸€èˆ¬ï¼Œé˜µå‹æ§åˆ¶çš„å»ºæ¨¡çœ‹ä¸Šå»æœ‰ç”¨ä½†æ˜¯æ²¡æœ‰æºç </p>
<p><a target="_blank" rel="noopener" href="https://collaborative-mapush.github.io/">Learning Multi-Agent Loco-Manipulation for Long-Horizon Quadrupedal Pushing</a>å¡å†…åŸºæ¢…éš†å¤§å­¦å’ŒGoogleDeepMindåˆä½œçš„æ–‡ç« <br>ç®—æ³•æå‡ºäº†ä¸€ä¸ªåˆ†å±‚å¼MARLæ¡†æ¶ï¼Œç›®çš„æ˜¯è®©&gt;&#x3D;2ä¸ªå››è¶³æœºå™¨ç‹—æ¨åŠ¨æœ¨ç®±åˆ°è¾¾é•¿è·ç¦»çš„ç›®æ ‡ç‚¹<br><img src="/images/MARL/related_work.png" alt="related_work"><br>é«˜å±‚æ§åˆ¶å™¨ï¼šRRTï¼šç‰©ä½“å½“å‰ä½ç½®ã€ç›®æ ‡ä½ç½®ã€éšœç¢ç‰©ä½ç½®-&gt;å¯è¡Œçš„è½¨è¿¹ğœ + é›†ä¸­çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•åšfinetuneï¼šæœ¨ç®±å½“å‰ä½ç½®ã€æœ¨ç®±ç›®æ ‡ä½ç½®ã€ğœã€æ‰€æœ‰æœºå™¨ç‹—çš„å½“å‰çŠ¶æ€-&gt;æœ¨ç®±çš„å­ç›®æ ‡ä½ç½®ahï¼ŒRh&#x3D;æœ¨ç®±è¾¾åˆ°ç›®æ ‡ç‚¹å¥–åŠ±+å­ç›®æ ‡æ¥è¿‘è½¨è¿¹ğœçš„å¥–åŠ±+å¯¹è·ç¦»éšœç¢ç‰©è¾ƒè¿‘çš„æƒ©ç½šä»¥åŠå¯¹æœºå™¨äººè·Œå€’ã€ç¢°æ’ã€ç‰©ä½“å€¾æ–œå’Œè¶…æ—¶ç­‰å¼‚å¸¸æƒ…å†µçš„ä¸¥å‰æƒ©ç½š<br><img src="/images/MARL/high_level_RL.png" alt="high_level_RL"><br>ä¸­å±‚æ§åˆ¶å™¨ï¼šå»ä¸­å¿ƒåŒ–MAPPOå¼ºåŒ–å­¦ä¹ ï¼šæœºå™¨ç‹—è‡ªèº«è§‚æµ‹o+å­ç›®æ ‡ah-&gt;amæœºå™¨ç‹—çš„ç›®æ ‡é€Ÿåº¦å‘é‡ï¼Œæœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹åˆ«çš„OCB reward&#x3D;<strong>v</strong>i â‹… <strong>v</strong>targetï¼Œæœºå™¨ç‹—åˆ°æœ¨ç®±æœ€è¿‘ç‚¹çš„å‘é‡ã€æœ¨ç®±åˆ°å…¶å­ç›®æ ‡çš„å‘é‡<br><img src="/images/MARL/OCB_reward.png" alt="OCB_reward"><br>ä½å±‚æ§åˆ¶å™¨ï¼šam-&gt;alæœºå™¨ç‹—ç”µæœºæ§åˆ¶ï¼Œç›´æ¥ç”¨äº†Unitreeå†…ç½®çš„<br>è¿™ä¸ªé«˜å±‚æ§åˆ¶å™¨çš„æ¶æ„çœ‹ä¸Šå»æœ‰ç”¨ï¼Œæˆ–è®¸æˆ‘ä¹Ÿå¯ä»¥ç”¨RLå¯¹LLMç”Ÿæˆçš„å­ç›®æ ‡åšfinetune?é€šè¿‡RLå¯¹LLMç”Ÿæˆçš„å»ºè®®ä½œé€‰æ‹©ä¸ä¼˜åŒ–</p>
<p><a target="_blank" rel="noopener" href="https://ml-jku.github.io/rudder/">RUDDER</a><br>å°†LSTMåº”ç”¨äºreward-delayed RLçš„å¼€åˆ›æ€§æ–‡ç« (2018)ï¼Œè§£å†³çš„é—®é¢˜æ˜¯å…·æœ‰å»¶è¿Ÿå¥–åŠ±çš„å¼ºåŒ–å­¦ä¹ ç¯å¢ƒåŠ¨ä½œä»·å€¼å‡½æ•°å…·æœ‰é«˜åå·®ï¼Œä»£ç†è®­ç»ƒç¼“æ…¢ï¼Œè§£å†³æ–¹å¼æ˜¯å¥–åŠ±é‡åˆ†é…ã€‚<br>RUDDER ä½¿ç”¨ LSTM æ ¹æ®å½“å‰çŠ¶æ€ä»¥åŠå…ˆå‰çŠ¶æ€å’Œæ“ä½œçš„é¡ºåºé¢„æµ‹æ¯ä¸ªæ—¶é—´æ­¥çš„æœ€ç»ˆç´¯ç§¯å¥–åŠ±ï¼ˆå›æŠ¥ï¼‰ï¼Œä»¥ç¡®å®šå“ªäº›äº‹ä»¶å¯¹æœ€ç»ˆå¥–åŠ±çš„è´¡çŒ®æœ€å¤§ã€‚ä¸€æ—¦ LSTM è¯†åˆ«å‡ºå¯¼è‡´æœ€ç»ˆå¥–åŠ±çš„é‡è¦äº‹ä»¶ï¼ŒRUDDER å°±ä¼šå°†å¤–éƒ¨å¥–åŠ±é‡æ–°åˆ†é…ç»™é‚£äº›å…³é”®æ—¶é—´æ­¥ã€‚æ–‡ç« æœ‰ä¸¥è°¨çš„è¯æ˜å¥–åŠ±é‡åˆ†é…ä¸æ”¹å˜æ¸¸æˆçš„æ€»å›æŠ¥&#x2F;æœ€ä¼˜ç­–ç•¥<br>é—®é¢˜æ˜¯è®­ç»ƒä¸€ä¸ªLSTMæœ¬èº«ä¹Ÿéœ€è¦æ—¶é—´ï¼Œæˆ–è®¸<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2405.09999">reward centering</a>å·²ç»æ˜¯ä¸€ä¸ªè¶³å¤Ÿå¥½çš„æƒ³æ³•<br>ML-Agentsä¹Ÿå¯ä»¥ä½¿ç”¨LSTMï¼Œä½†å¹¶ä¸æ˜¯RUDDERç®—æ³•ï¼Œè€Œæ˜¯DRQNï¼š<a target="_blank" rel="noopener" href="https://github.com/miyamotok0105/unity-ml-agents/blob/master/docs/Feature-Memory.md">ä»£ç†å°†èƒ½å¤Ÿå­˜å‚¨æµ®ç‚¹å‘é‡ï¼Œä»¥ä¾¿åœ¨ä¸‹æ¬¡éœ€è¦åšå‡ºå†³ç­–æ—¶ä½¿ç”¨</a></p>
<h3 id="ç»å…¸å¤šæ™ºèƒ½ä½“ç®—æ³•"><a href="#ç»å…¸å¤šæ™ºèƒ½ä½“ç®—æ³•" class="headerlink" title="- ç»å…¸å¤šæ™ºèƒ½ä½“ç®—æ³•"></a>- ç»å…¸å¤šæ™ºèƒ½ä½“ç®—æ³•</h3><p>ä¸»è¦ä»‹ç»é›†ä¸­è®­ç»ƒï¼Œåˆ†æ•£æ‰§è¡Œçš„MARLç®—æ³•</p>
<p>å€¼åˆ†è§£ç±»å‹ï¼š<br><a target="_blank" rel="noopener" href="https://arxiv.org/abs/1803.11485">QMIX</a><br>åŸºäºVDNç®—æ³•æ”¹è¿›ï¼Œä¸»è¦æ€æƒ³æ˜¯ä¼˜åŒ–ä¸€ä¸ªQtotç½‘ç»œ(VDNçš„Qtotæ˜¯Qiçš„çº¿æ€§åŠ å’Œï¼Œå¯æƒ³è€ŒçŸ¥æœ‰å¾ˆå¤šé—®é¢˜)ï¼ŒQtotè¾“å…¥å½“å‰ç¯å¢ƒè§‚æµ‹Ï„,æ‰€æœ‰æ™ºèƒ½ä½“çš„åŠ¨ä½œai(ä»¥åŠæ¯ä¸ªæ™ºèƒ½ä½“Qiç½‘ç»œçš„è¾“å‡º)ï¼Œè¾“å‡ºå½“å‰çŠ¶æ€sä¸‹æ™ºèƒ½ä½“åšå‡ºè”åˆåŠ¨ä½œaçš„é¢„æœŸå›æŠ¥ï¼Œä¼˜åŒ–ç›®æ ‡æ˜¯è¶‹è¿‘æœ€ä¼˜ç­–ç•¥ä¸‹(Ï„,a)çš„çœŸå®åŠ¨ä½œä»·å€¼ï¼Œå…¶ä¸­Ï„ is a joint actionobservation historyï¼Œç”¨RNNè§£å†³Dec-POMDPçš„ç¯å¢ƒéƒ¨åˆ†å¯è§‚æµ‹é—®é¢˜<br><img src="/images/MARL/QMIX.png" alt="QMIX"><br>æ–‡ç« å‡è®¾ç»™å®šç¯å¢ƒè§‚æµ‹Ï„ï¼ŒQtot(Ï„,a)å–æœ€å¤§å€¼æ—¶ï¼Œæ¯ä¸ªæ™ºèƒ½ä½“Qi(Ï„i,ai)ä¸€å®šå–ç»™å®šè§‚æµ‹Ï„iä¸‹çš„æœ€å¤§å€¼ï¼Œæˆ–è€…è¡¨ç¤ºä¸º <strong>âˆ‚Qtot&#x2F;âˆ‚Qi&gt;&#x3D;0, âˆ€i&lt;&#x3D;N</strong><br><img src="/images/MARL/Qtot.png" alt="Qtot"><br>ç®—æ³•å…ˆé€šè¿‡group rewardä¼˜åŒ–Qtotç½‘ç»œï¼Œå†å¯¹Qtotæ±‚æ¢¯åº¦åå‘ä¼ æ’­å°±å¯ä»¥ä¼˜åŒ–æ¯ä¸ªæ™ºèƒ½ä½“çš„Qç½‘ç»œ<br>ç®—æ³•å‡è®¾ç¯å¢ƒä¸­åªæœ‰ä¸€ä¸ªå”¯ä¸€çš„å›¢é˜Ÿå¥–åŠ±ï¼Œæ¯ä¸ªæ™ºèƒ½ä½“æ²¡æœ‰è‡ªå·±ç‹¬ç«‹çš„å¥–åŠ±å‡½æ•°</p>
<p>Actor-Crticç±»å‹ï¼š<br><a target="_blank" rel="noopener" href="https://arxiv.org/abs/1706.02275">MADDPG</a>ï¼Œ<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/53811876">çŸ¥ä¹</a>è¿™ç¯‡è®²çš„å·²ç»å¾ˆç²¾ç‚¼äº†<br><img src="/images/MARL/MADDPG.png" alt="MADDPG"><br>MADDPGæ¶æ„ä¸­ï¼Œæ¯ä¸ªæ™ºèƒ½ä½“éƒ½æœ‰è‡ªå·±çš„ä¸­å¿ƒåŒ–ä»·å€¼ç½‘ç»œå’Œå»ä¸­å¿ƒåŒ–ç­–ç•¥ç½‘ç»œï¼Œå…è®¸æ¯ä¸ªæ™ºèƒ½ä½“æœ‰ç‹¬ç«‹çš„å¥–åŠ±å‡½æ•°ï¼Œæ¯ä¸ªæ™ºèƒ½ä½“çš„åŠ¨ä½œç©ºé—´ï¼Œè§‚æµ‹ç©ºé—´ä¹Ÿå¯ä»¥ä¸ä¸€æ ·</p>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/1705.08926">COMA</a> é€šè¿‡åäº‹å®æ¨ç†&#x2F;å·®å¼‚å¥–åŠ±&#x2F;ä¼˜åŠ¿å‡½æ•°å®ç°credit distributionï¼Œä»è€Œæ›´æ–°policy network<br>ä¸MADDPGä¸åŒï¼ŒCOMAå‡è®¾ç¯å¢ƒåªå­˜åœ¨group rewardï¼Œå¹¶åªä½¿ç”¨ä¸€ä¸ªä¸­å¿ƒåŒ–çš„Criticç½‘ç»œè¯„ä¼°æ™ºèƒ½ä½“è”åˆåŠ¨ä½œçš„ä»·å€¼<br><img src="/images/MARL/COMA.png" alt="COMA"><br>ä¼˜åŠ¿å‡½æ•°ä¸ºï¼š<br><img src="/images/MARL/Advantage_function.png" alt="Advantage_function"><br>policy networkæ›´æ–°é€šè¿‡ï¼š<br><img src="/images/MARL/COMA_policy_update.png" alt="COMA_policy_update"></p>
<p><a target="_blank" rel="noopener" href="https://rlg.mlanctot.info/papers/AAAI22-RLG_paper_32.pdf">MA-POCA</a>ï¼šUnityå‘è¡¨çš„å¤šæ™ºèƒ½ä½“ç®—æ³•ï¼Œä¸»è¦åœ¨COMAç®—æ³•çš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†è‡ªæ³¨æ„åŠ›æœºåˆ¶ã€‚ä½œè€…ç‹¬åˆ°åœ°æ³¨æ„åˆ°äº†ç°æœ‰å¤šæ™ºèƒ½ä½“ç®—æ³•æ— æ³•å¤„ç†å¯å˜å¤šæ™ºèƒ½ä½“æ€»æ•°çš„æƒ…å†µ <em>â€œ To the authorâ€™s knowledge, this is first time the posthumous credit assignment problem has been explicitly mentioned in the literature.â€</em> ï¼Œå¹¶é€šè¿‡æ³¨æ„åŠ›æœºåˆ¶å°†å˜é•¿çš„é›†ä¸­è§‚æµ‹ã€é›†ä¸­åŠ¨ä½œè½¬åŒ–ä¸ºäº†å®šé•¿çš„ç‰¹å¾å‘é‡ï¼Œç”¨ä½œä»·å€¼å‡½æ•°çš„è¾“å…¥ã€‚<br>ç®—æ³•å‡è®¾äº†ä¸€ä¸ªå·²çŸ¥æ€»æ™ºèƒ½ä½“æ€»æ•°ä¸è¶…è¿‡Nï¼Œä½†åœ¨æ¯ä¸€æ—¶é—´æ­¥æ™ºèƒ½ä½“æ•°ç›®ä¸ç¡®å®šçš„ç¯å¢ƒ(æœ‰æ–°æ™ºèƒ½ä½“äº§ç”Ÿæˆ–æ­»äº¡)ï¼Œæ­»äº¡çš„æ™ºèƒ½ä½“è¢«è§†ä¸ºæ— æ³•åšå‡ºåŠ¨ä½œä»¥æ”¹å˜ç¯å¢ƒ<br>ä¸ºæ¯ä¸ªæ™ºèƒ½ä½“ié¢å¤–è®­ç»ƒç¼–ç å‡½æ•°gi(oi),fi(oi,ai)ï¼Œä¸”ä¸¤ä¸ªç¼–ç å‡½æ•°è¾“å‡ºçš„ç‰¹å¾å‘é‡å¤§å°ç›¸åŒä¸ºd<br><img src="/images/MARL/POCA_center_critic.png" alt="POCA_center_critic"><br>åäº‹å®ä¼˜åŠ¿å‡½æ•°ï¼š<br><img src="/images/MARL/POCA_advantage.png" alt="POCA_advantage"><br>RSA(gj (oj), fi(oi,ai) i!&#x3D;j )è¿”å›äº†ç»¼åˆäº†ojå’Œ(oi,ai)ä¿¡æ¯çš„ç‰¹å¾å‘é‡ï¼Œå¤§å°ä»ä¸ºdï¼Œä»è€Œå¯ä»¥å¤„ç†ä»»æ„æ•°é‡çš„ä»£ç†è”åˆåŠ¨ä½œ</p>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2410.02511">LEMAE</a>å’Œ<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2410.03997">You Only LLM Once for MARL</a>çš„æƒ³æ³•æ¯”è¾ƒæ¥è¿‘ï¼Œé€šè¿‡å¯¹LLM chain-of-thought å¼çš„æé—®å¼•å¯¼ï¼Œä»¤LLMåˆ†ç¦»å‡ºä»»åŠ¡çš„å…³é”®çŠ¶æ€(å­ä»»åŠ¡)ï¼Œè®¾è®¡å¥–åŠ±å‡½æ•°ç­‰ï¼Œç›®çš„æ˜¯ä¼˜åŒ–äº†ELLMéœ€è¦åå¤è¯¢é—®LLMçš„é—®é¢˜ï¼Œä½†ç›¸åº”çš„éš¾ä»¥å¤„ç†æŒç»­æ€§ä»»åŠ¡</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">USER:</span><br><span class="line">(Task Description)</span><br><span class="line">Two agents are in a 30x30 room with the coordinate of the point in the upper left corner is</span><br><span class="line">(0,0) and the point in the lower right corner is (29,29), separated by a wall with a door.</span><br><span class="line">The door can not be directly open. There is a hidden switch in each room (The switch</span><br><span class="line">coordinates are unknown and differ from the coordinate of the door.). The door will be open</span><br><span class="line">only when one of the switch is occupied by an agent otherwise close. Both agents begin in</span><br><span class="line">the left half of the room(agent0.x&lt;15 and agent1.x&lt;15).</span><br><span class="line">The task is considered successfully completed as long as both agents are located in the right</span><br><span class="line">half-room(agent0.x&gt;15 and agent1.x&gt;15).</span><br><span class="line">(State Form)</span><br><span class="line">In each step we can get current state. The state is a 1-dim list:</span><br><span class="line">(agent0.x, agent0.y, agent1.x, agent1.y,door.open).</span><br><span class="line">(Role Instruction)(Template)</span><br><span class="line">Your role is to give several critical key states in the task...</span><br><span class="line">...</span><br><span class="line">ASSISTANT: (LLM response)</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">Key states: &#123;</span><br><span class="line">init:Initial state where both agents are in the left half of the room.,</span><br><span class="line">key state 1:Agent0 has found the switch and is standing on it, opening the door,</span><br><span class="line">key state 2:Agent1 has moved through the open door to the right half of the room while</span><br><span class="line">agent0 is still on the switch,</span><br><span class="line">key state 3:Agent0 has joined agent1 in the right half of the room</span><br><span class="line">&#125;,</span><br><span class="line">Discriminators: &#123;</span><br><span class="line">key state 1:def iskeystate1(state): return 1 if state[4] == 1 and state[0] &gt;15 else 0,</span><br><span class="line">key state 2:def iskeystate2(state): return 1 if state[4] == 1 and state[2] &gt;15 and state[0]</span><br><span class="line">&lt;15 else 0,</span><br><span class="line">key state 3:def iskeystate3(state): return 1 if state[0] &gt;15 and state[2] &gt;15 else 0</span><br><span class="line">&#125;,</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/MARL/co_pass.png" alt="co_pass"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/09/08/Reinforcement-Learning/" data-id="cm45fdq7n0000gsk31qsj4gnc" data-title="Reinforcement Learning" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Multi-Agents" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/02/Multi-Agents/" class="article-date">
  <time class="dt-published" datetime="2024-09-02T05:51:46.000Z" itemprop="datePublished">2024-09-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/09/02/Multi-Agents/">Multi Agents</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>æ­¤åšå®¢ä¸æˆ‘çš„å›¢é˜Ÿé¡¹ç›®â€œå¤šæœºå¯¹æŠ—â€åŒæ­¥  </p>
<h2 id="Chapter1ï¼šåœ¨gazeboä¸­ç‹¬ç«‹æ“çºµå¤šå°æœºå™¨äºº"><a href="#Chapter1ï¼šåœ¨gazeboä¸­ç‹¬ç«‹æ“çºµå¤šå°æœºå™¨äºº" class="headerlink" title="Chapter1ï¼šåœ¨gazeboä¸­ç‹¬ç«‹æ“çºµå¤šå°æœºå™¨äºº"></a>Chapter1ï¼šåœ¨gazeboä¸­ç‹¬ç«‹æ“çºµå¤šå°æœºå™¨äºº</h2><h3 id="1-åœ¨gazeboä¸­åŠ è½½ä¸¤å°æœºå™¨äºº"><a href="#1-åœ¨gazeboä¸­åŠ è½½ä¸¤å°æœºå™¨äºº" class="headerlink" title="1. åœ¨gazeboä¸­åŠ è½½ä¸¤å°æœºå™¨äºº"></a>1. åœ¨gazeboä¸­åŠ è½½ä¸¤å°æœºå™¨äºº</h3><p>æœ€ç®€å•çš„æƒ³æ³•æ˜¯ç›´æ¥åœ¨gazeboä¸­åŠ è½½ä¸¤å°æœºå™¨äººï¼Œå†é€šè¿‡å‘å¸ƒ <em>ä¸åŒçš„é€Ÿåº¦æ§åˆ¶è¯é¢˜</em> åˆ†åˆ«æ§åˆ¶è¿™ä¸¤å°æœºå™¨äººï¼Œè¿™é‡Œï¼Œæˆ‘è‡ªå®šä¹‰äº†ä¸€ä¸ªsimp_four_wheel.urdfæ–‡ä»¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/fishros/fishbot/blob/navgation2/src/fishbot_description/urdf/fishbot_gazebo.urdf">ä¸¤è½®å·®é€Ÿæ¨¡å‹</a>ã€‚ä¸æ¸…æ¥šå¦‚ä½•ç¼–å†™urdfæ–‡ä»¶çš„å¯ä»¥ç¿»é˜…æˆ‘çš„åšå®¢ï¼š<strong>ROS2-Learning&#x2F;Chapter 4</strong>  </p>
<hr>
<p>å°æ’æ›²ï¼Œgazeboä¿å­˜åœ°å›¾æ–‡ä»¶æœ‰ä¸¤ç§æ ¼å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥åˆ›å»ºå¥½åœ°å›¾å¹¶ç›´æ¥Saveï¼Œåœ°å›¾ä¼šè¢«ä¿å­˜ä¸ºsdfæ–‡ä»¶+configæ–‡ä»¶ç»„æˆçš„ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªsdfåœ°å›¾æ–‡ä»¶æ— æ³•é€šè¿‡å‘½ä»¤è¡Œï¼ˆlaunchæ–‡ä»¶ï¼‰å¯åŠ¨ï¼Œè€Œæ˜¯åœ¨gazeboä¸­ç‚¹å‡»Insertæ·»åŠ <br>å¦‚æœæƒ³è¦é€šè¿‡launchæ–‡ä»¶å¯åŠ¨åœ°å›¾æ–‡ä»¶ï¼Œä½ éœ€è¦å°†gazeboæ–‡ä»¶<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45084787/article/details/136536598">å¦å­˜ä¸º.worldæ–‡ä»¶</a></p>
<hr>
<p>æ¥ä¸‹æ¥ç¼–å†™launchæ–‡ä»¶ï¼Œç›´æ¥ç¿»å€spawn_entityèŠ‚ç‚¹ï¼š  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Start Gazebo server</span></span><br><span class="line">start_gazebo_cmd =  ExecuteProcess(</span><br><span class="line">    cmd=[<span class="string">&#x27;gazebo&#x27;</span>, <span class="string">&#x27;--verbose&#x27;</span>,<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;libgazebo_ros_init.so&#x27;</span>, <span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;libgazebo_ros_factory.so&#x27;</span>, gazebo_world_path],</span><br><span class="line">    output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Launch the robot</span></span><br><span class="line">spawn_entity_1_cmd = Node(</span><br><span class="line">    package=<span class="string">&#x27;gazebo_ros&#x27;</span>, </span><br><span class="line">    executable=<span class="string">&#x27;spawn_entity.py&#x27;</span>,</span><br><span class="line">    name=<span class="string">&#x27;spawn_entity_1&#x27;</span>,</span><br><span class="line">    arguments=[<span class="string">&#x27;-entity&#x27;</span>, <span class="string">&#x27;robot1&#x27;</span>,  <span class="string">&#x27;-file&#x27;</span>, urdf_model_path ,<span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;-5&#x27;</span>], output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line"></span><br><span class="line">spawn_entity_2_cmd = Node(</span><br><span class="line">    package=<span class="string">&#x27;gazebo_ros&#x27;</span>, </span><br><span class="line">    executable=<span class="string">&#x27;spawn_entity.py&#x27;</span>,</span><br><span class="line">    name=<span class="string">&#x27;spawn_entity_2&#x27;</span>,</span><br><span class="line">    arguments=[<span class="string">&#x27;-entity&#x27;</span>, <span class="string">&#x27;robot2&#x27;</span>,  <span class="string">&#x27;-file&#x27;</span>, urdf_model_path ,<span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;-Y&#x27;</span>, <span class="string">&#x27;3.14&#x27;</span>], output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rqt_steering_cmd = Node(</span><br><span class="line">    package=<span class="string">&#x27;rqt_robot_steering&#x27;</span>, </span><br><span class="line">    executable=<span class="string">&#x27;rqt_robot_steering&#x27;</span>,</span><br><span class="line">    output=<span class="string">&#x27;screen&#x27;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><img src="/images/Multi-Agents/two_robots.png" alt="two_robots"></p>
<p>ç°åœ¨ä½¿ç”¨rqt_robot_steeringï¼Œå¯ä»¥çœ‹åˆ°ä¸¤è¾†å°è½¦åŒæ—¶è¿åŠ¨ï¼Œè¿™æ˜¯ç”±äºè¿™ä¸¤è¾†å°è½¦æ˜¯é€šè¿‡åŒä¸€ä¸ªurdfæ–‡ä»¶åŠ è½½çš„ï¼Œè€Œåœ¨å¯¹åº”çš„urdfæ–‡ä»¶ä¸­ï¼š  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gazebo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">&quot;four_wheels_controller&quot;</span> <span class="attr">filename</span>=<span class="string">&quot;libgazebo_ros_diff_drive.so&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ros</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">namespace</span>&gt;</span>/<span class="tag">&lt;/<span class="name">namespace</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remapping</span>&gt;</span>cmd_vel:=cmd_vel<span class="tag">&lt;/<span class="name">remapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remapping</span>&gt;</span>odom:=odom<span class="tag">&lt;/<span class="name">remapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ros</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸¤è¾†å°è½¦é€šè¿‡diff_driveæ’ä»¶ï¼Œè®¢é˜…åˆ°çš„cmd_velä¸»é¢˜æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥æ— æ³•åˆ†åˆ«æ§åˆ¶<br>è§£å†³æ–¹æ¡ˆæ˜¯å†å†™ä¸€ä¸ªurdfæ–‡ä»¶ï¼Œå¹¶å°†å®ƒçš„diff_driveæ’ä»¶è®¢é˜…çš„cmd_velè¯é¢˜mapåˆ°ä¸€ä¸ªå…¶ä»–çš„åç§°ï¼Œå¦‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gazebo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">&quot;four_wheels_controller&quot;</span> <span class="attr">filename</span>=<span class="string">&quot;libgazebo_ros_diff_drive.so&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ros</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">namespace</span>&gt;</span>/robot2<span class="tag">&lt;/<span class="name">namespace</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remapping</span>&gt;</span>cmd_vel:=/robot2/cmd_vel<span class="tag">&lt;/<span class="name">remapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remapping</span>&gt;</span>odom:=/robot2/odom<span class="tag">&lt;/<span class="name">remapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ros</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-å°è¯•ä½¿ç”¨èŠ‚ç‚¹å‚æ•°namespaceï¼šå¤±è´¥"><a href="#2-å°è¯•ä½¿ç”¨èŠ‚ç‚¹å‚æ•°namespaceï¼šå¤±è´¥" class="headerlink" title="2. å°è¯•ä½¿ç”¨èŠ‚ç‚¹å‚æ•°namespaceï¼šå¤±è´¥"></a>2. å°è¯•ä½¿ç”¨èŠ‚ç‚¹å‚æ•°namespaceï¼šå¤±è´¥</h3><p>åœ¨åˆšæ‰çš„è§£å†³æ–¹æ¡ˆä¸­ï¼Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>ä¸¤ä¸ªèŠ‚ç‚¹çš„link&#x2F;jointåç§°æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œä½¿ç”¨robot_state_publisherå‘å¸ƒæ—¶ä¸¤ä¸ªæœºå™¨äººçš„æ¶ˆæ¯ä¼šæ··æ·†ï¼Œå¯¼è‡´rvizä¼šè®¤ä¸ºè¿™ä¸ªç¯å¢ƒä¸­åªæœ‰ä¸€ä¸ªæœºå™¨äººï¼Œä½†å®ƒåŒæ—¶å­˜åœ¨äºå½“å‰ä¸–ç•Œä¸‹çš„ä¸¤ä¸ªä½ç½®ï¼Œåœ¨rvizä¸­çš„ä½“ç°æ˜¯æœºå™¨äººä¸åœåœ°åœ¨ä¸¤ä¸ªä½ç½®ä¹‹é—´é—ªçƒï¼Œå¦‚æœå¸Œæœ›rvizå¯ä»¥åŒºåˆ†è¿™ä¸¤ä¸ªæœºå™¨äººï¼Œé‚£ä¹ˆä½ å¯¹åº”æœºå™¨äººçš„urdfæ–‡ä»¶çš„æ‰€æœ‰link&#x2F;jointçš„åç§°éƒ½è¦åšå‡ºåŒºåˆ†</li>
<li>å¦‚æœéœ€è¦åŠ è½½æ›´å¤šæœºå™¨äººï¼Œåªèƒ½ç¼–å†™æ›´å¤šçš„urdfæ–‡ä»¶ï¼Œæ¯ä¸ªæœºå™¨äººçš„æ–‡ä»¶çš„æ¶æ„æ˜¯ä¸€æ ·çš„ï¼Œä½†æœºå™¨äººçš„æ‰€æœ‰åç§°éƒ½è¦åšä¿®æ”¹ï¼Œæå…¶ç¹ç</li>
</ol>
<p>æˆ‘æœ€åˆçš„æƒ³æ³•æ˜¯ä½¿ç”¨robot_state_publisherç­‰èŠ‚ç‚¹çš„namespaceå‚æ•°ï¼Œä»é€»è¾‘ä¸Šæ¥è®²namespaceå‚æ•°ä¼šå½±å“spawn_entityä¸robot_state_publisherå‘å¸ƒçš„å…³äºæœºå™¨äººçš„æ‰€æœ‰æ¶ˆæ¯ï¼ŒåŒ…æ‹¬link&#x2F;jointä¸æ’ä»¶çš„è¾“å…¥è¾“å‡ºæ¥å£ï¼Œéƒ½åŠ ä¸Šå¯¹åº”çš„å‘½åç©ºé—´ï¼Œä½†å®é™…æ“ä½œåï¼š  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Start Gazebo server</span></span><br><span class="line">start_gazebo_cmd =  ExecuteProcess(</span><br><span class="line">    cmd=[<span class="string">&#x27;gazebo&#x27;</span>, <span class="string">&#x27;--verbose&#x27;</span>,<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;libgazebo_ros_init.so&#x27;</span>, <span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;libgazebo_ros_factory.so&#x27;</span>, gazebo_world_path],</span><br><span class="line">    output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Launch the robot</span></span><br><span class="line">spawn_entity_1_cmd = Node(</span><br><span class="line">    package=<span class="string">&#x27;gazebo_ros&#x27;</span>, </span><br><span class="line">    executable=<span class="string">&#x27;spawn_entity.py&#x27;</span>,</span><br><span class="line">    name=<span class="string">&#x27;spawn_entity_1&#x27;</span>,</span><br><span class="line">    namespace=<span class="string">&#x27;robot1&#x27;</span>,</span><br><span class="line">    arguments=[<span class="string">&#x27;-entity&#x27;</span>, <span class="string">&#x27;robot1&#x27;</span>,  <span class="string">&#x27;-file&#x27;</span>, urdf_model_path ,<span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;-5&#x27;</span>], output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line"></span><br><span class="line">spawn_entity_2_cmd = Node(</span><br><span class="line">    package=<span class="string">&#x27;gazebo_ros&#x27;</span>, </span><br><span class="line">    executable=<span class="string">&#x27;spawn_entity.py&#x27;</span>,</span><br><span class="line">    name=<span class="string">&#x27;spawn_entity_2&#x27;</span>,</span><br><span class="line">    namespace=<span class="string">&#x27;robot2&#x27;</span>,</span><br><span class="line">    arguments=[<span class="string">&#x27;-entity&#x27;</span>, <span class="string">&#x27;robot2&#x27;</span>,  <span class="string">&#x27;-file&#x27;</span>, urdf_model_path ,<span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;-Y&#x27;</span>, <span class="string">&#x27;3.14&#x27;</span>], output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rqt_steering_cmd = Node(</span><br><span class="line">    package=<span class="string">&#x27;rqt_robot_steering&#x27;</span>, </span><br><span class="line">    executable=<span class="string">&#x27;rqt_robot_steering&#x27;</span>,</span><br><span class="line">    output=<span class="string">&#x27;screen&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">robot_state_publisher1_node = Node(</span><br><span class="line">    package=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">    executable=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">    name=<span class="string">&#x27;robot_state_publisher1&#x27;</span>,</span><br><span class="line">    namespace=<span class="string">&#x27;robot1&#x27;</span>,</span><br><span class="line">    arguments=[urdf_model_path],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">joint_state_publisher1_node = Node(</span><br><span class="line">    package=<span class="string">&#x27;joint_state_publisher&#x27;</span>,</span><br><span class="line">    executable=<span class="string">&#x27;joint_state_publisher&#x27;</span>,</span><br><span class="line">    name=<span class="string">&#x27;joint_state_publisher1&#x27;</span>,</span><br><span class="line">    namespace=<span class="string">&#x27;robot1&#x27;</span>,</span><br><span class="line">    arguments=[urdf_model_path],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">rviz2_node = Node(</span><br><span class="line">    package=<span class="string">&#x27;rviz2&#x27;</span>,</span><br><span class="line">    executable=<span class="string">&#x27;rviz2&#x27;</span>,</span><br><span class="line">    name=<span class="string">&#x27;rviz2&#x27;</span>,</span><br><span class="line">    output=<span class="string">&#x27;screen&#x27;</span>,</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p><img src="/images/Multi-Agents/failure_ns.png" alt="failure_ns"></p>
<p>frameåç§°å’Œcmd_velä¾æ—§æ²¡æœ‰å‘½åç©ºé—´å‰ç¼€ï¼Œä½†robot_state_publisherå‘å¸ƒçš„joint_stateså’Œrobot_descriptionæ‹¥æœ‰å‘½åç©ºé—´ï¼Œæˆ‘çš„åˆ¤æ–­æ˜¯spawn_entityèŠ‚ç‚¹æ¥æ”¶namespaceåæ— æ³•ä¸ºurdfæ–‡ä»¶ä¸­çš„æ’ä»¶èŠ‚ç‚¹åŠ ä¸Šå‘½åç©ºé—´å‰ç¼€  </p>
<h3 id="3-xacroæ–‡ä»¶çš„ä½¿ç”¨"><a href="#3-xacroæ–‡ä»¶çš„ä½¿ç”¨" class="headerlink" title="3. xacroæ–‡ä»¶çš„ä½¿ç”¨"></a>3. xacroæ–‡ä»¶çš„ä½¿ç”¨</h3><hr>
<p>åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘å‚è€ƒäº†<a target="_blank" rel="noopener" href="https://robotics.snowcron.com/robotics_ros2/dif_drive_xacro.htm">snowcron</a>å¹¶å¯¹å…¶<a target="_blank" rel="noopener" href="https://robotics.snowcron.com/robotics_ros2/multi_bot_03_intro.htm">æºç </a>è¿›è¡Œäº†åˆ†å‰²</p>
<hr>
<p>urdfï¼ˆxmlï¼‰æ–‡ä»¶æ— æ³•ä½¿ç”¨å‚æ•°ï¼Œå˜é‡ç­‰æŠ½è±¡åŒ–çš„æœ¯å¼ï¼Œè¿™ä¹Ÿå¯¼è‡´æˆ‘ä»¬æ— æ³•å‘urdfæ–‡ä»¶ä¼ å…¥å‚æ•°ï¼ˆå¦‚robot_name&#x3D;â€™robot1â€™ï¼‰æ¥å»ä¿®æ”¹urdfæ–‡ä»¶<br>xacroæ–‡ä»¶æ˜¯xml macroã€‚xacroå®ç”¨ç¨‹åºè¿è¡Œæ‰€æœ‰å®å¹¶è¾“å‡ºç»“æœï¼Œç”Ÿæˆå•ä¸ªæ–‡ä»¶ï¼Œå…¶æ–¹å¼ç±»ä¼¼äºé¢„å¤„ç†å™¨å¯¹åŒ…å«æ–‡ä»¶å’Œå®æ‰§è¡Œçš„æ“ä½œï¼Œé€šè¿‡xacroæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’å‚æ•°ï¼Œå®šä¹‰å˜é‡ï¼Œä»è€Œå¯¹urdfä»£ç è¿›è¡Œåˆ†å—ï¼Œå¹¶ <strong>å®æ—¶ç”Ÿæˆ</strong> ç¬¦åˆæˆ‘ä»¬è¦æ±‚çš„urdfæ–‡ä»¶  </p>
<p>ä½¿xacroæ–‡ä»¶æœ‰æ„ä¹‰çš„æ–‡ä»¶å¤´ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">&quot;http://www.ros.org/wiki/xacro&quot;</span> <span class="attr">name</span>=<span class="string">&quot;bot&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- all other stuff --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å®šä¹‰å˜é‡å¹¶ä½¿ç”¨ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;wheel_radius&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.04&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;wheel_length&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;wheel_color_name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;red&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;wheel_color_rgb&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1 0 0 1&quot;</span> /&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!--å…è®¸å››åˆ™è¿ç®—å’Œæ‹¬å·--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;$&#123;wheel_name&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">visual</span>&gt;</span><span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">&quot;$&#123;wheeldiam/2&#125;&quot;</span> <span class="attr">length</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;$&#123;reflect*(width+.02)&#125; 0 0.25&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>å®šä¹‰ä¸€ä¸ªå®å¹¶ä½¿ç”¨ï¼š  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">&quot;wheel&quot;</span> <span class="attr">params</span>=<span class="string">&quot;wheel_name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;$&#123;wheel_name&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">&quot;$&#123;wheel_radius&#125;&quot;</span> <span class="attr">length</span>=<span class="string">&quot;$&#123;wheel_length&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;$&#123;wheel_color_name&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;$&#123;wheel_color_rgb&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:wheel</span> <span class="attr">wheel_name</span>=<span class="string">&quot;right_wheel_frontside&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>å£°æ˜å‚æ•°ä¸å…¶é»˜è®¤å€¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">&quot;http://www.ros.org/wiki/xacro&quot;</span> <span class="attr">name</span>=<span class="string">&quot;multi_bot_03&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:arg</span> <span class="attr">name</span>=<span class="string">&quot;namespace&quot;</span> <span class="attr">default</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:arg</span> <span class="attr">name</span>=<span class="string">&quot;robot_material_name&quot;</span> <span class="attr">default</span>=<span class="string">&quot;Green&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:arg</span> <span class="attr">name</span>=<span class="string">&quot;robot_material_color_rgb&quot;</span> <span class="attr">default</span>=<span class="string">&quot;0 1 0 1&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(find multi_bot_03)/description/xacro/inertial_macros.xacro&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(find multi_bot_03)/description/xacro/lidar.xacro&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(find multi_bot_03)/description/xacro/camera.xacro&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(find multi_bot_03)/description/xacro/imu_sensor.xacro&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(find multi_bot_03)/description/xacro/gazebo_control.xacro&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(find multi_bot_03)/description/xacro/robot_core.xacro&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨robot_core.xacroä¸­ä½¿ç”¨è¿™äº›å‚æ•°ï¼Œè¿™é‡Œä½¿ç”¨äº†$(arg namespace)ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">&quot;http://www.ros.org/wiki/xacro&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">&quot;box_link&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">params</span>=<span class="string">&quot;name size color color_rgb mass mass_x mass_y mass_z&quot;</span> &gt;</span></span><br><span class="line">        </span><br><span class="line">        # Here we use the &quot;namespace&quot; as a prefix</span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;$(arg namespace)/$&#123;name&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;$&#123;size&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;$&#123;color&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;$&#123;color_rgb&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡launch.pyæ–‡ä»¶å‘xacroæ–‡ä»¶ä¼ é€’å‚æ•°ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">robot_description_config = xacro.process_file(</span><br><span class="line">def_urdf,</span><br><span class="line">    mappings=&#123;</span><br><span class="line">        <span class="comment"># &quot;robot_name&quot;: robot[&#x27;name&#x27;],</span></span><br><span class="line">        <span class="string">&quot;namespace&quot;</span>: namespace,</span><br><span class="line">        <span class="string">&quot;robot_material_name&quot;</span>: robot[<span class="string">&#x27;color_name&#x27;</span>],</span><br><span class="line">        <span class="string">&quot;robot_material_color_rgb&quot;</span>: robot[<span class="string">&#x27;color_rgb&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡åœ¨xacroæ–‡ä»¶ä¸­æ¯ä¸€ä¸ªlink&#x2F;joint&#x2F;æ’ä»¶ç«¯å£åŠ ä¸Š$(arg namespace)å‰ç¼€ï¼Œå¹¶å‘xacroæ–‡ä»¶ä¼ é€’å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è¯•è¯•ç”Ÿæˆæˆ‘ä»¬éœ€è¦çš„æ‹¥æœ‰å‘½åç©ºé—´çš„æœºå™¨äººurdfæ–‡ä»¶ï¼Œæˆ‘ä»¬å°†å®ƒå†™åœ¨launchæ–‡ä»¶çš„ <strong>forå¾ªç¯</strong> ä¸­ä»¥åŠ è½½å¤šä¸ªæœºå™¨äºº  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> robot <span class="keyword">in</span> robots:</span><br><span class="line">    <span class="comment"># Ex.: /robot1</span></span><br><span class="line">    namespace = <span class="string">&quot;/&quot;</span> + robot[<span class="string">&#x27;name&#x27;</span>] <span class="keyword">if</span> robot[<span class="string">&#x27;name&#x27;</span>] != <span class="string">&quot;&quot;</span> <span class="keyword">else</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    robot_description_config = xacro.process_file(</span><br><span class="line">        path_to_urdf_xacro,</span><br><span class="line">        mappings=&#123;</span><br><span class="line">            <span class="string">&quot;namespace&quot;</span>: namespace,</span><br><span class="line">            <span class="string">&quot;robot_material_name&quot;</span>: robot[<span class="string">&#x27;color_name&#x27;</span>],</span><br><span class="line">            <span class="string">&quot;robot_material_color_rgb&quot;</span>: robot[<span class="string">&#x27;color_rgb&#x27;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># robot_description_config æ˜¯ä½ å®æ—¶ç”Ÿæˆçš„æœºå™¨äººurdfæ–‡ä»¶</span></span><br><span class="line">    params = &#123;<span class="string">&#x27;robot_description&#x27;</span>: robot_description_config.toxml(), </span><br><span class="line">        <span class="string">&#x27;use_sim_time&#x27;</span>: <span class="literal">True</span>&#125; <span class="comment"># è¿™é‡Œä¸€å®šè¦ä½¿ç”¨simulation time</span></span><br><span class="line"></span><br><span class="line">    start_robot_state_publisher_cmd = Node(</span><br><span class="line">        package=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">        executable=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">        name=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">        namespace=namespace,</span><br><span class="line">        output=<span class="string">&#x27;screen&#x27;</span>,</span><br><span class="line">        parameters=[params]</span><br><span class="line">    )    </span><br><span class="line">    arrNodes.append(start_robot_state_publisher_cmd)</span><br><span class="line">                                 </span><br><span class="line">    spawn_entity_cmd = Node(package=<span class="string">&#x27;gazebo_ros&#x27;</span>, executable=<span class="string">&#x27;spawn_entity.py&#x27;</span>,</span><br><span class="line">        namespace=namespace,</span><br><span class="line">        arguments=[</span><br><span class="line">            <span class="string">&quot;-topic&quot;</span>, namespace + <span class="string">&quot;/robot_description&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;-entity&#x27;</span>, robot[<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;-robot_namespace&#x27;</span>, robot[<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;-x&#x27;</span>, <span class="built_in">str</span>(robot[<span class="string">&#x27;x_pos&#x27;</span>]),</span><br><span class="line">            <span class="string">&#x27;-y&#x27;</span>, <span class="built_in">str</span>(robot[<span class="string">&#x27;y_pos&#x27;</span>]),</span><br><span class="line">            <span class="string">&#x27;-z&#x27;</span>, <span class="built_in">str</span>(robot[<span class="string">&#x27;z_pos&#x27;</span>]),             </span><br><span class="line">        ],</span><br><span class="line">        parameters=[&#123;<span class="string">&#x27;use_sim_time&#x27;</span>: use_sim_time&#125;],</span><br><span class="line">        output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line">    arrNodes.append(spawn_entity_cmd)</span><br><span class="line"></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å¯ä»¥åˆ†åˆ«æ§åˆ¶ä¸¤ä¸ªæœºå™¨äººï¼Œå¹¶åœ¨rvizä¸­æ­£ç¡®æ˜¾ç¤ºäº†ï¼ˆæ¯ä¸ªæœºå™¨äººçš„link&#x2F;joint&#x2F;robot_description&#x2F;æ§åˆ¶æ¥å£éƒ½å…·æœ‰å‘½åç©ºé—´å‰ç¼€ï¼‰<br><img src="/images/Multi-Agents/valid_two_robots.png" alt="valid_two_robots"></p>
<hr>
<p>æ³¨æ„è¿™ä¸€è¡Œï¼š<code>params = &#123;&#39;robot_description&#39;: robot_description_config.toxml(), &#39;use_sim_time&#39;: True&#125;</code><br>å¦‚æœä¸è®¾ç½®â€™use_sim_timeâ€™ï¼ˆé»˜è®¤ä¸ºfalseï¼‰ï¼Œgazeboæ’ä»¶ä¼šé»˜è®¤ä½¿ç”¨ç³»ç»Ÿæ—¶é—´ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„timerå‘å¸ƒæ•°æ®ï¼Œåœ¨å¤šä¸ªæ’ä»¶å­˜åœ¨æ—¶è¿™ä¼šå¯¼è‡´ä¸åŒæ’ä»¶å‘å¸ƒæ¶ˆæ¯çš„æ—¶é—´ä¸ä¸€è‡´ã€‚<br>åœ¨rvizä¸­çš„ä½“ç°æ˜¯â€œno transform from front_left_wheel to odomâ€æŠ¥é”™ï¼Œæ— æ³•æ˜¾ç¤ºæœºå™¨äººçš„å››ä¸ªè½®å­ï¼Œæˆ‘çš„ç†è§£æ˜¯ä¸ä½¿ç”¨simulation timeå¯¼è‡´joint_state_publisherå‘å¸ƒçš„è½®è½´çš„tfå…³ç³»ä¸robot_state_publisherå‘å¸ƒçš„å…¶ä»–å…³èŠ‚çš„tfä¿¡æ¯æ²¡æœ‰å¯¹å…¶ï¼Œå¯¼è‡´robot_descriptionä¸å®Œæ•´ï¼ˆç¼ºå°‘è½®è½´çš„tfå…³ç³»ï¼‰  </p>
<h2 id="Chapter2ï¼šUnityä¸ML-agents"><a href="#Chapter2ï¼šUnityä¸ML-agents" class="headerlink" title="Chapter2ï¼šUnityä¸ML-agents"></a>Chapter2ï¼šUnityä¸ML-agents</h2><h3 id="ä¸‹è½½ä¸ç¯å¢ƒé…ç½®"><a href="#ä¸‹è½½ä¸ç¯å¢ƒé…ç½®" class="headerlink" title="- ä¸‹è½½ä¸ç¯å¢ƒé…ç½®"></a>- ä¸‹è½½ä¸ç¯å¢ƒé…ç½®</h3><p>Date:2024&#x2F;9&#x2F;23ï¼Œåœ¨å†™è¿™ç¯‡åšå®¢çš„æ—¶å€™ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/Unity-Technologies/ml-agents/blob/develop/docs/Installation.md">ML-agents github</a>å¿½ç„¶æ›´æ–°åˆ°äº†branch-21ï¼Œml-agents&#x3D;&#x3D;1.0.0ã€‚<br>æœ€æ–°ç‰ˆæœ¬çš„ä¸‹è½½æ•™ç¨‹æ‰€æä¾›çš„ç¯å¢ƒæ˜¯æ­£ç¡®çš„ï¼Œä¸éœ€è¦é‡æ–°é…ç½®ç¯å¢ƒï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸è¿‡ml-agents1.0ä½¿ç”¨çš„UnityåŒ…æ˜¯é¢„å‘è¡Œçš„éç¨³å®šç‰ˆæœ¬ï¼›branch-20ï¼Œml-agents&#x3D;&#x3D;0.30.0çš„ç¯å¢ƒé”™è¯¯å¾ˆå¤šï¼Œä¸è¿‡ä½¿ç”¨çš„UnityåŒ…éƒ½æ˜¯é•¿æœŸç¨³å®šç‰ˆæœ¬ã€‚<br>é¦–å…ˆåœ¨å®˜ç½‘ä¸‹è½½<a target="_blank" rel="noopener" href="https://unity.com/cn/download">UnityHub</a>ï¼Œ<a target="_blank" rel="noopener" href="https://www.anaconda.com/download">anaconda</a>ï¼Œä½¿ç”¨C#è¿˜éœ€è¦ä¸‹è½½<a target="_blank" rel="noopener" href="https://dotnet.microsoft.com/en-us/download">.NET SDK</a><br>ç›®å‰å»ºè®®ç›´æ¥ <strong>ä¸‹è½½æœ€æ–°ç‰ˆæœ¬</strong>ï¼Œåœ¨<a target="_blank" rel="noopener" href="https://github.com/Unity-Technologies/ml-agents/blob/develop/docs/Installation.md">ML-agents github</a>è·Ÿç€æ•™ç¨‹ç›´æ¥ä¸‹è½½<br><em>ä¸‹é¢æ˜¯ml-agents&#x3D;&#x3D;0.30.0çš„ç¯å¢ƒé…ç½®</em>ï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#create a new environment</span><br><span class="line">conda create -n unity_rl python=3.10.0 &amp;&amp; conda activate mlagents</span><br><span class="line">#install ml-agents clones for models and projects</span><br><span class="line">git clone --branch release_20 https://github.com/Unity-Technologies/ml-agents.git</span><br><span class="line">#install ml-agents</span><br><span class="line">python -m pip install mlagents==0.30.0</span><br><span class="line">#need to Downgrade protobuf</span><br><span class="line">pip uninstall protobuf</span><br><span class="line">pip install protobuf==3.20.0</span><br><span class="line">#you might need to install six</span><br><span class="line">pip install six</span><br><span class="line">#default torch installation is not cannot compute for RTX3060(sm86)</span><br><span class="line">pip uninstall torch</span><br><span class="line">conda install pytorch==1.11.0 torchvision==0.12.0 torchaudio==0.11.0 cudatoolkit=11.3 -c pytorch</span><br><span class="line"># numpy&#x27; has no attribute &#x27;float&#x27;. `np.float` was a deprecated alias for the builtin `float` ...</span><br><span class="line">cd path-to-buffer.py &amp; change line210 np.float to float</span><br><span class="line"># Could not infer dtype of numpy.float32&quot; When trying to learn ml-agents</span><br><span class="line">pip uninstall numpy</span><br><span class="line">pip install numpy==1.22.0</span><br><span class="line"># this will raise an error &#x27;mlagents-envs requires numpy==1.21.2&#x27;, just ignore it</span><br></pre></td></tr></table></figure>

<p><a href="https://'earn.unity.com/tutorial/install-unity-software">UnityåŸºæœ¬ä½¿ç”¨</a><br>è·Ÿéš<a target="_blank" rel="noopener" href="https://github.com/Unity-Technologies/ml-agents/blob/develop/docs/Getting-Started.md">å®˜æ–¹æ•™ç¨‹</a>åˆ›å»ºä»£ç†ç¯å¢ƒå¹¶è®­ç»ƒmlagents</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ml-agents</span><br><span class="line">mlagents-learn config/ppo/3DBall.yaml --run-id=first3DBallRun</span><br></pre></td></tr></table></figure>

<h3 id="å¤ç”¨SoccerTwoç¯å¢ƒ"><a href="#å¤ç”¨SoccerTwoç¯å¢ƒ" class="headerlink" title="- å¤ç”¨SoccerTwoç¯å¢ƒ"></a>- å¤ç”¨SoccerTwoç¯å¢ƒ</h3><ol>
<li>åœ¨UnityHubä¸­New Projectæ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå°†Editor Versionæ”¹ä¸º2023.2.13f1</li>
<li>å¤åˆ¶ml-agents&#x2F;Project&#x2F;ML-Agents&#x2F;Examples&#x2F;Socceræ–‡ä»¶å¤¹åˆ°æ–°å»ºé¡¹ç›®çš„Assetsæ–‡ä»¶å¤¹ä¸‹</li>
<li>å°†æ–°å»ºé¡¹ç›®çš„Packagesæ–‡ä»¶å¤¹æ›¿æ¢ä¸ºml-agents&#x2F;Project&#x2F;Packagesæ–‡ä»¶å¤¹</li>
<li>å¤åˆ¶com.unity.ml-agents,com.unity.ml-agents.extensions,ml-agents-trainer-pluginæ–‡ä»¶å¤¹åˆ°ä½ é¡¹ç›®çš„åŒçº§ç›®å½•</li>
<li>åœ¨UnityHubä¸‹è¿è¡Œä½ çš„é¡¹ç›®æ–‡ä»¶</li>
</ol>
<h3 id="ML-Agentsä»£ç è§£æ"><a href="#ML-Agentsä»£ç è§£æ" class="headerlink" title="- ML-Agentsä»£ç è§£æ"></a>- ML-Agentsä»£ç è§£æ</h3><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Packages/com.unity.ml-agents@3.0/api/index.html">å®˜æ–¹APIåº“</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/tianjuewudi/article/details/121115480">SoccerTwoä»£ç è§£æ</a></p>
<h2 id="Chapter3ï¼šFRC-Three-simple"><a href="#Chapter3ï¼šFRC-Three-simple" class="headerlink" title="Chapter3ï¼šFRC Three simple"></a>Chapter3ï¼šFRC Three simple</h2><h3 id="FRCæ¯”èµ›è§„åˆ™"><a href="#FRCæ¯”èµ›è§„åˆ™" class="headerlink" title="- FRCæ¯”èµ›è§„åˆ™"></a>- FRCæ¯”èµ›è§„åˆ™</h3><p><img src="/images/Multi-Agents/FRC_field1.png" alt="FRC field1"><br><img src="/images/Multi-Agents/FRC_field2.png" alt="FRC field2"></p>
<ol>
<li>åœºæ™¯å†…å…è®¸ä¸¤åªé˜Ÿä¼ï¼Œæ¯é˜Ÿä¸‰ä¸ªæœºå™¨äººåœ¨åœºåœ°å†…æ¯”èµ›ï¼Œæœºå™¨äººé€šè¿‡å°†NOTEæŠ•å…¥åˆ° <em>å·±æ–¹åœºåœ°å†…çš„</em> Speakerä¸­ä»¥å¾—åˆ†</li>
<li>æ¯”èµ›å‰15ç§’ï¼Œæœºå™¨äººå¤„äºè‡ªåŠ¨é˜¶æ®µï¼ŒæŒ‰ç…§é¢„å…ˆè®¾å®šçš„ç¨‹åºå¾—åˆ†ï¼›åœ¨å‰©ä¸‹çš„2åˆ†15ç§’å†…ï¼Œæ“ä½œæ‰‹æ§åˆ¶è‡ªå·±çš„æœºå™¨äººã€‚æœºå™¨äººä»Sourceå¤„æ”¶é›†æ¥NOTEsï¼Œå¹¶é€å…¥Speakerå’Œ<br>AMPä¸­å¾—åˆ†ã€‚æ¯å½“ä¸€ä¸ªé˜Ÿä¼åœ¨å…¶AMPä¸­ç§¯ç´¯2ä¸ªéŸ³ç¬¦ï¼Œæ“ä½œè€…å¯ä»¥å†³å®šæ¿€æ´» <em>æ”¾å¤§çŠ¶æ€</em> çš„æ—¶é—´ã€‚åœ¨æ”¾å¤§çŠ¶æ€çš„10ç§’å†…æŠ•å…¥Speakerå¯ä»¥è·å¾—æ›´é«˜å¾—åˆ†</li>
<li>å¦‚æœåŒæ–¹é˜Ÿä¼éƒ½åœ¨æ‰‹åŠ¨é˜¶æ®µçš„å‰45ç§’å†…æŒ‰ä¸‹ <em>åˆä½œç«äº‰æŒ‰é’®</em> é‡æ–°åˆ©ç”¨ä¸€ä¸ªéŸ³ç¬¦ï¼ˆå°†æŠ•å…¥AMPçš„NOTEå–å‡ºç”¨äºå¾—åˆ†ï¼‰ï¼Œé‚£ä¹ˆæ¯”èµ›ä¸­çš„æ‰€æœ‰é˜Ÿä¼éƒ½ä¼šè·å¾—1ä¸ªåˆä½œç«äº‰åˆ†ï¼ˆè¿™ä¼šå½±å“ä»–ä»¬åœ¨æ¯”èµ›ä¸­çš„æ’åï¼‰ï¼ŒåŒæ—¶æ—‹å¾‹å¥–åŠ±ï¼ˆä¸€ç§å¾—åˆ†æˆå°±ï¼Œå½“ä¸€ä¸ªé˜Ÿä¼åœ¨æ‰©éŸ³å™¨å’Œæ‰¬å£°å™¨ä¸­ç§¯ç´¯äº†ä¸€å®šæ•°é‡çš„éŸ³ç¬¦æ—¶ï¼Œå¯ä»¥è·å¾—é¢å¤–çš„åˆ†æ•°ï¼‰æ‰€éœ€çš„éŸ³ç¬¦æ•°é‡ä¹Ÿä¼šå‡å°‘</li>
<li>æœºå™¨äººè¢«å…è®¸è·¨è¿‡åŠåœºä»¥å¹²æ‰°å¯¹æ‰‹çš„å¾—åˆ†ï¼ˆå¦‚äº‰å¤ºå¯¹æ–¹çš„NOTEï¼Œè¿«ä½¿å¯¹æ–¹çŠ¯è§„ç­‰ï¼‰ï¼Œå¹¶å¯ä»¥ä¸å¯¹æ‰‹å‘ç”Ÿæ¥è§¦ï¼ˆä½†æ¥è§¦æ—¶é—´éœ€è¦å°äº5ç§’ï¼‰</li>
</ol>
<p><img src="/images/Multi-Agents/scoring_rules.png" alt="scoring rules"></p>
<h3 id="FRCå…¬å¼€è®ºå›ã€å’¨è¯¢ä¸ä»¿çœŸ"><a href="#FRCå…¬å¼€è®ºå›ã€å’¨è¯¢ä¸ä»¿çœŸ" class="headerlink" title="- FRCå…¬å¼€è®ºå›ã€å’¨è¯¢ä¸ä»¿çœŸ"></a>- FRCå…¬å¼€è®ºå›ã€å’¨è¯¢ä¸ä»¿çœŸ</h3><p><a target="_blank" rel="noopener" href="https://www.chiefdelphi.com/c/first/open-alliance/89">å¼€æºçš„FRCè”ç›Ÿ</a><br>æ¯”èµ›å½•åƒå¯ä»¥ä»youtubeä¸Šç›´æ¥æœç´¢FRC event review<br><a target="_blank" rel="noopener" href="https://mostudios.itch.io/mosimulator">MoSimulator</a>ä½¿ç”¨Unityåˆ¶ä½œäº†FRCæ¸¸æˆæ¨¡æ‹Ÿ<br><a target="_blank" rel="noopener" href="https://www.chiefdelphi.com/t/6328s-advance-swerve-drive-example-with-more-enhanced-physics-simulation-collision-detection-and-more/470626/3">Maple-Swerve-Skeleton</a>é›†æˆäº†ç¢°æ’æ¨¡æ‹Ÿï¼Œé©¾é©¶æ¨¡æ‹Ÿï¼Œæ¸¸æˆé“å…·æ¨¡æ‹Ÿï¼Œ<strong>é‡Œç¨‹è®¡æ¨¡æ‹Ÿï¼ˆæ‰“æ»‘ï¼‰</strong> ä¸ <strong>è§†è§‰æ¨¡æ‹Ÿ</strong></p>
<h3 id="my-AgentFRC-simple"><a href="#my-AgentFRC-simple" class="headerlink" title="- my AgentFRC simple"></a>- my AgentFRC simple</h3><p>Enviroment Designï¼šåŸºäºå®˜æ–¹æ–‡æ¡£SoccerTwoç¯å¢ƒåšå‡ºä¿®æ”¹ã€‚åˆ é™¤åœºæ™¯å†…çš„è¶³çƒï¼Œå°†ä»£ç†æ•°æ·»åŠ è‡³3v3ï¼Œä»¿ç…§FRCæ¯”èµ›åœºåœ°æ·»åŠ AMP(blue and purple)ä¸Source(yellow)ï¼Œç›´æ¥å°†BlueGoalå’ŒPurpleGoalçƒé—¨è§†ä¸ºè“é˜Ÿå’Œç´«é˜Ÿçš„Speakerã€‚</p>
<p><img src="/images/Multi-Agents/FRCThree_env.png" alt="FRCThree env"></p>
<p>Game Designï¼šä»£ç†çš„åŠ¨ä½œç©ºé—´ä»ä¸º3*discrete(å‰åã€å·¦å³ã€æ°´å¹³è½¬åŠ¨å…±ä¸‰ç»´)ï¼Œä»£ç†é€šè¿‡ä¸Sourceæ¥è§¦è·å¾—Notesï¼Œå¹¶é€šè¿‡ä¸AMPæˆ–Speakeræ¥è§¦å°†NoteæŠ•å…¥å¹¶å¾—åˆ†ï¼ˆå¾—åˆ†è®¡å…¥å„é˜Ÿçš„ <strong>GroupReward</strong>ï¼‰ã€‚å¾—åˆ†è§„åˆ™ä¸GameManualä¸€è‡´ï¼šæºå¸¦Noteçš„ä»£ç†ä¸å·±æ–¹çš„AMPæ¥è§¦æ—¶å›¢é˜Ÿå¾—åˆ†+1ï¼ŒAMPä¸­å‚¨å­˜çš„Note+1ï¼Œå½“AMPä¸­å·²ç»å­˜å‚¨äº†ä¸¤ä¸ªNoteå¹¶å†æ¬¡ä¸å·±æ–¹çš„ä»£ç†æ¥è§¦æ—¶ï¼Œè§¦å‘<strong>æ”¾å¤§æ—¶é—´</strong> ï¼ˆæ³¨æ„åœ¨FRCæ¯”èµ›ä¸­æ”¾å¤§æ—¶é—´æ˜¯ç”±æ“ä½œæ‰‹å†³å®šçš„ï¼Œå¯ä»¥åœ¨ä»»æ„æ—¶é—´è§¦å‘ï¼Œè¿™é‡Œé€šè¿‡ä»£ç†å†æ¬¡è§¦ç¢°çš„æ–¹å¼å®ç°ä»£ç†è‡ªä¸»å†³å®šä½•æ—¶è§¦å‘æ”¾å¤§æ—¶é—´ï¼‰ï¼›æºå¸¦Noteçš„ä»£ç†ä¸å·±æ–¹çš„Speakeræ¥è§¦æ—¶å›¢é˜Ÿå¾—åˆ†+2ï¼Œåœ¨æ”¾å¤§æ—¶é—´å†…å¾—åˆ†+5</p>
<p>Module Introductionï¼š</p>
<p>Unityä¸­C#è„šæœ¬æ–‡ä»¶ä¸‹å£°æ˜ä¸ºpublicçš„å˜é‡ä¼šæ˜¾ç¤ºåœ¨UIçª—å£ä¸­ï¼Œå¯ä»¥é€šè¿‡å°†Hierarchyçª—å£ä¸‹çš„ç‰©ä½“æ‹–åŠ¨åˆ°å¯¹åº”çš„æ–¹æ¡†ä¸‹å®ç°å˜é‡èµ‹å€¼</p>
<ul>
<li>FRC_field<br><img src="/images/Multi-Agents/m_FRC_field.jpg" alt="my FRC field"><br>FRCEnvControlleræ–‡ä»¶æ³¨å†Œäº†ç¯å¢ƒä¸­çš„æ‰€æœ‰6ä¸ªä»£ç†ï¼Œç”¨ä»¥æ›´æ–°ç¯å¢ƒè®¡æ—¶å™¨å¹¶åœ¨æ¸¸æˆé‡æ–°å¼€å§‹æ—¶é‡ç½®ä»£ç†ä½ç½®ã€‚BlueScoreå’ŒPurpleScoreæ˜¯æˆ‘åˆ›å»ºçš„è®¡åˆ†æ¿</li>
<li>BlueAgent<br><img src="/images/Multi-Agents/BlueAgent.jpg" alt="BlueAgent"><br>BehaviourParametersæ–‡ä»¶æ˜¯ML-Agentsçš„åº“æ–‡ä»¶ï¼Œå®ƒå®šä¹‰äº†ç½‘ç»œçš„è§‚æµ‹ç©ºé—´ï¼ˆè¾“å…¥ç«¯ï¼‰ä¸åŠ¨ä½œç©ºé—´ï¼ˆè¾“å‡ºç«¯ï¼‰ã€‚VectorObservationä¸‹çš„Space Sizeéœ€è¦ä¸å¯¹åº”ä»£ç†è„šæœ¬æ–‡ä»¶ä¸­å®šä¹‰çš„CollectObservation()ä¸‹çš„addObservationæ•°ç›®ä¸€è‡´ï¼ŒRaySensorç­‰ä¼ æ„Ÿå™¨æ–‡ä»¶è·å¾—çš„è§‚æµ‹ç©ºé—´ä¸è®¡å…¥Space Sizeã€‚æ³¨æ„Behaviour Nameéœ€è¦ä¸trainingconfig.yamlæ–‡ä»¶ä¸­çš„åç§°ä¿æŒä¸€è‡´æ‰èƒ½è®­ç»ƒ</li>
<li>AMPBlue<br><img src="/images/Multi-Agents/AMPBlue.jpg" alt="AMPBlue"><br>AMPControllerç±»å†…å‚¨å­˜äº†FRCEnvï¼Œå› ä¸ºFRCEnvæ³¨å†Œäº†ç¯å¢ƒä¸­çš„6ä¸ªä»£ç†ï¼Œç°åœ¨AMPControllerå¯ä»¥é€šè¿‡FRCEnvä¸ºä»£ç†æ·»åŠ GroupReward<br>AMPçš„Collideræ–‡ä»¶ä¸‹å‹¾é€‰äº†IsTriggerï¼Œç°åœ¨AMPä¸ä¼šå‚ä¸ç‰©ç†ç¢°æ’ï¼ˆå¯ä»¥ç›´æ¥ç©¿è¿‡ï¼‰ï¼Œå«æœ‰RigidBodyçš„ç‰©ä½“ <em>å‘ç”Ÿç§»åŠ¨</em> å¹¶è¿›å…¥AMPå†…éƒ¨ï¼Œä¼šè§¦å‘OnTriggerEnterå‡½æ•°ï¼Œé€šè¿‡è¿™ç§é€»è¾‘åˆ¤æ–­ä»£ç†ä¸AMPå‘ç”Ÿæ¥è§¦</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/HenryLiuOZ/FRCThree">Code Implementation</a>ï¼šåŒ…å«äº†æˆ‘çš„Scriptæ–‡ä»¶ï¼Œè®­ç»ƒå¥½çš„ç½‘ç»œä¸è§†é¢‘æ¼”ç¤º</p>
<p><img src="/images/Multi-Agents/500000Training.png" alt="500000Training"></p>
<h2 id="Chapter4ï¼šMosimulator-FRC-field"><a href="#Chapter4ï¼šMosimulator-FRC-field" class="headerlink" title="Chapter4ï¼šMosimulator FRC field"></a>Chapter4ï¼šMosimulator FRC field</h2><p>å·²ç»é€šè¿‡æ¨¡ä»¿å­¦ä¹ +åŒ…å«RNNçš„å¼ºåŒ–å­¦ä¹ ç®—æ³•å®ç°æ™ºèƒ½ä½“åœ¨FRCOneåœºæ™¯ä¸‹çš„è‡ªä¸»å¾—åˆ†</p>
<p>åªç”¨åŸºç¡€çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ï¼Œä»£ç†éš¾ä»¥å­¦ä¹ åˆ°æ¸¸æˆçš„å¾—åˆ†æ¨¡å¼ï¼Œä¸€ç›´éš¾ä»¥å¾—åˆ†ã€‚è¿™å¯èƒ½æ˜¯ç”±äºFRCç¯å¢ƒä¸­æ¶‰åŠç±»ä¼¼æŠ•ç¯®çš„æ—¶åºæ€§é—®é¢˜ï¼Œä»£ç†åœ¨è·å¾—å¥–åŠ±å’Œå®ƒåšå‡ºæ­£ç¡®è¡Œä¸ºä¹‹é—´æœ‰æ—¶é—´å·®ã€‚</p>
<p>ä½¿ç”¨æ¨¡ä»¿å­¦ä¹ +å¼ºåŒ–å­¦ä¹ è®­ç»ƒï¼Œä»£ç†èƒ½å¤Ÿå¾—åˆ†ï¼Œä½†æ•ˆç‡ä¸é«˜</p>
<p>ä½¿ç”¨æ¨¡ä»¿å­¦ä¹ +RNNå¼ºåŒ–å­¦ä¹ ï¼Œä»£ç†æ‹¥æœ‰æ›´é«˜çš„å¾—åˆ†æ•ˆç‡</p>
<p><a target="_blank" rel="noopener" href="https://github.com/eureka-research/Eureka?tab=readme-ov-file">Eureka</a></p>
<p><img src="/images/Multi-Agents/Eureka1.png" alt="baseline"></p>
<p><img src="/images/Multi-Agents/Eureka2.png" alt="optimize goal"></p>
<p><img src="/images/Multi-Agents/Eureka3.png" alt="fitness function"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/09/02/Multi-Agents/" data-id="cm0ku4u150000x4k3fj0j90ug" data-title="Multi Agents" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ROS2-Learning" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/07/28/ROS2-Learning/" class="article-date">
  <time class="dt-published" datetime="2024-07-28T09:03:17.000Z" itemprop="datePublished">2024-07-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/07/28/ROS2-Learning/">ROS2_Learning</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome! This is my simple note learning ROS2. Hope it be helpful!<br>Reference websites:  </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://fishros.com/d2lros2/#/">fishros: åŠ¨æ‰‹å­¦ROS2</a></li>
<li><a target="_blank" rel="noopener" href="https://gitee.com/gwmunan/ros2/wikis/pages?sort_id=9188028&doc_id=4855084">GundaSmartçš„åšå®¢</a></li>
</ul>
<h2 id="Chapter1-ROS2åŸºç¡€çŸ¥è¯†ä¸æœ€ç®€å•çš„æœºå™¨äººé¿éšœ"><a href="#Chapter1-ROS2åŸºç¡€çŸ¥è¯†ä¸æœ€ç®€å•çš„æœºå™¨äººé¿éšœ" class="headerlink" title="Chapter1: ROS2åŸºç¡€çŸ¥è¯†ä¸æœ€ç®€å•çš„æœºå™¨äººé¿éšœ"></a>Chapter1: ROS2åŸºç¡€çŸ¥è¯†ä¸æœ€ç®€å•çš„æœºå™¨äººé¿éšœ</h2><h3 id="1-ROS1-ä¸-ROS2-çš„åŒºåˆ«"><a href="#1-ROS1-ä¸-ROS2-çš„åŒºåˆ«" class="headerlink" title="1. ROS1 ä¸ ROS2 çš„åŒºåˆ«"></a>1. ROS1 ä¸ ROS2 çš„åŒºåˆ«</h3><p>é€šè¿‡è¯é¢˜ã€æœåŠ¡ã€å‚æ•°ã€åŠ¨ä½œè¿™äº›é€šä¿¡æœºåˆ¶ï¼ŒROS1å®ç°äº†å°†æœºå™¨äººçš„å„ä¸ªç»„ä»¶ç»™çš„è¿æ¥èµ·æ¥ã€‚ROS1çš„å®ç°æ–¹å¼æ˜¯è€Œè®¾è®¡ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹ï¼ˆæ¯”å¦‚ï¼šæ¿€å…‰é›·è¾¾ï¼‰çš„é€šä¿¡å»ºç«‹å¿…é¡»ç»è¿‡<strong>Ros Master</strong>èŠ‚ç‚¹ã€‚<br>MasterèŠ‚ç‚¹é€šè¿‡NodeHandleræ¥ç®¡ç†å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€å’Œé€šä¿¡ã€‚NodeHandleræ˜¯MasterèŠ‚ç‚¹å†…éƒ¨çš„ä¸€ä¸ªç»„ä»¶ï¼Œè´Ÿè´£ç»´æŒèŠ‚ç‚¹çš„åˆ—è¡¨å’ŒçŠ¶æ€ä¿¡æ¯ã€‚å½“ä½ åœ¨ROS1ä¸­å¯åŠ¨ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¼šå‘MasterèŠ‚ç‚¹æ³¨å†Œè‡ªå·±ï¼Œè€ŒMasterèŠ‚ç‚¹åˆ™é€šè¿‡NodeHandleræ¥å¤„ç†è¿™äº›æ³¨å†Œä¿¡æ¯ã€‚  </p>
<p><img src="/images/ROS2-Learning/image.png" alt="ROS1 NodeHandle"></p>
<p>ä¸€æ—¦ä¸»èŠ‚ç‚¹æŒ‚æ‰åï¼Œå°±ä¼šé€ æˆæ•´ä¸ªç³»ç»Ÿé€šä¿¡çš„å¼‚å¸¸,æ­¤æ—¶é¿éšœç­–ç•¥å°†ä¼šå¤±æ•ˆï¼Œå¦‚æœæœºå™¨äººæ­£åœ¨è¿è¡Œï¼Œç¢°åˆ°éšœç¢ç‰©ä¼šå¾„ç›´æ’ä¸Šå»ã€‚<br>æ‰€ä»¥åœ¨ROS2ä¸­ï¼Œé¦–å½“å…¶å†²åœ°å°†ROSçš„ä¸»èŠ‚ç‚¹å¹²æ‰äº†  </p>
<p><img src="/images/ROS2-Learning/image-1.png" alt="ROS1 Vs ROS2"></p>
<p><img src="/images/ROS2-Learning/image-2.png" alt="ROS2 Publisher"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒROS2ä¸­publisheræ˜¯ç”±nodeè‡ªèº«ç›´æ¥åˆ›å»ºçš„  </p>
<hr>
<p>æ“ä½œç³»ç»Ÿå±‚é¢ï¼ŒROS1åªæ”¯æŒlinuxå¹³å° -&gt; ROS2æ”¯æŒLinuxï¼ŒWindowsã€Macä»¥åŠåµŒå…¥å¼RTOSå¹³å°<br>èŠ‚ç‚¹é—´é€šä¿¡æ–¹é¢ï¼šROS1æ˜¯åŸºäºTCPå®ç°ï¼Œå®æ—¶æ€§å·®ã€ç³»ç»Ÿå¼€é”€å¤§ï¼Œè€ŒROS2é‡‡ç”¨DDSé€šä¿¡ï¼Œåœ¨å®æ—¶æ€§ã€å¯é æ€§å’Œè¿ç»­æ€§ä¸Šéƒ½æœ‰äº†å¢å¼ºã€‚<br>ROS2è¿›è¡Œçš„æ”¹è¿›æœ‰ï¼š</p>
<ul>
<li>python2åˆ°pyhton3çš„æ”¯æŒï¼Œ<strong>å¯ä»¥ç”¨Pythonç¼–å†™Launchæ–‡ä»¶</strong></li>
<li>ç¼–è¯‘ç³»ç»Ÿçš„æ”¹è¿›ï¼Œ<strong>catkinåˆ°ament</strong></li>
<li>è½¯ä»¶åŒ…æ›´æ–°åˆ°c++11</li>
<li>å¯ä»¥ä½¿ç”¨ç›¸åŒ API çš„è¿›ç¨‹é—´å’Œè¿›ç¨‹å†…é€šä¿¡</li>
</ul>
<h3 id="2-ROS2åŸºæœ¬ä½¿ç”¨"><a href="#2-ROS2åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2. ROS2åŸºæœ¬ä½¿ç”¨"></a>2. ROS2åŸºæœ¬ä½¿ç”¨</h3><h4 id="èŠ‚ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#èŠ‚ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="- èŠ‚ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"></a>- èŠ‚ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>ROSä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé€šè¿‡<strong>mainå‡½æ•°</strong>å®ç°ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—åŒ–çš„åŠŸèƒ½ï¼ˆæ¯”å¦‚ä¸€ä¸ªèŠ‚ç‚¹è´Ÿè´£æ§åˆ¶è½¦è½®è½¬åŠ¨ï¼Œä¸€ä¸ªèŠ‚ç‚¹è´Ÿè´£ä»æ¿€å…‰é›·è¾¾è·å–æ•°æ®ã€ä¸€ä¸ªèŠ‚ç‚¹è´Ÿè´£å¤„ç†æ¿€å…‰é›·è¾¾çš„æ•°æ®ã€ä¸€ä¸ªèŠ‚ç‚¹è´Ÿè´£å®šä½ç­‰ç­‰ï¼‰<br>èŠ‚ç‚¹çš„æºç å­˜åœ¨äºå…¶å¯¹åº”çš„åŒ…<strong>package</strong>ä¸­ï¼Œåœ¨åŒ…ä¸­ç”±CmakeList.txtå’Œpackage.xmlæ–‡ä»¶æŒ‡å¯¼ç¼–è¯‘<br>ä¸€ä¸ªç®€å•çš„å·¥ä½œç©ºé—´çœ‹èµ·æ¥å¯èƒ½åƒ:  </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">workspace_folder/</span><br><span class="line">    src/</span><br><span class="line">    cpp_package_1/</span><br><span class="line">        CMakeLists.txt</span><br><span class="line">        include/cpp_package_1/</span><br><span class="line">        package.xml</span><br><span class="line">        src/</span><br><span class="line"></span><br><span class="line">    py_package_1/</span><br><span class="line">        package.xml</span><br><span class="line">        resource/py_package_1</span><br><span class="line">        setup.cfg</span><br><span class="line">        setup.py</span><br><span class="line">        py_package_1/</span><br><span class="line">    ...</span><br><span class="line">    cpp_package_n/</span><br><span class="line">        CMakeLists.txt</span><br><span class="line">        include/cpp_package_n/</span><br><span class="line">        package.xml</span><br><span class="line">        src/</span><br></pre></td></tr></table></figure>

<ol>
<li>ä¸‹è½½colconï¼š<code>sudo apt install python3-colcon-common-extensions</code>  </li>
<li>åˆ›å»ºå·¥ä½œåŒºï¼š<code>mkdir -p ~/ros2_ws/src &amp;&amp; cd ~/ros2_ws</code>  </li>
<li>åˆ›å»ºä¸€ä¸ªåŒ…ï¼ˆå¹¶åŒ…å«ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ï¼š<code>ros2 pkg create --build-type ament_cmake --node-name my_node my_package</code>  </li>
<li>æ„å»ºåŠŸèƒ½åŒ…ï¼š<code>cd ~/ros2_ws &amp;&amp; colcon build</code> <strong>ä¸€å®šè¦åœ¨ <em>å·¥ä½œç©ºé—´æ–‡ä»¶å¤¹</em> ä¸‹æ„å»ºï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ä¸å¯é¢„æµ‹çš„åæœ!</strong><br>å¦‚æœéœ€è¦ä¾èµ–é¡¹ï¼Œ<code>ros2 pkg create my_package --build-type ament_cmake --dependencies rclcpp</code>  </li>
<li>sourceåˆ°installæ–‡ä»¶ç›®å½•ï¼š<code>source install/local_setup.bash</code> è¿™ä¸€è¡Œå¯ä»¥æ·»åŠ åˆ° <strong>~&#x2F;.bashrc</strong> ä¸‹  </li>
<li>æ­¤æ—¶å°±å¯ä»¥è¿è¡ŒèŠ‚ç‚¹ï¼š<code>ros2 run my_package my_node</code>ï¼Œç»ˆç«¯å°†è¿”å›ï¼šhello world my_package package</li>
</ol>
<h4 id="Topic"><a href="#Topic" class="headerlink" title="- Topic"></a>- Topic</h4><p><img src="/images/ROS2-Learning/image-3.png" alt="Topic and Service"></p>
<p>rclcppå®šä¹‰çš„Nodeèƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªå‘å¸ƒè€…ï¼Œåœ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸­</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;rclcpp::Node&gt;(<span class="string">&quot;automatic_payroll_posting&quot;</span>);</span><br><span class="line">rclcpp::Publisher&lt;std_msgs::msg::UInt32&gt;::SharedPtr pub_;</span><br><span class="line"><span class="comment">//åˆ›å»ºè¯é¢˜å‘å¸ƒè€…ï¼Œå‘å¸ƒçš„è¯é¢˜ä¸ºsalary_payï¼Œå‘å¸ƒçš„æ¶ˆæ¯ç±»å‹ä¸ºstd_msgs::msg::UInt32</span></span><br><span class="line">pub_ = node-&gt;<span class="built_in">create_publisher</span>&lt;std_msgs::msg::UInt32&gt;(<span class="string">&quot;salary_pay&quot;</span>,<span class="number">10</span>); </span><br><span class="line"><span class="comment">//åˆ›å»ºå®šæ—¶å™¨ï¼Œæ¯500mså‘é€ä¸€æ¬¡æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯çš„æ–¹å¼å®šä¹‰åœ¨å®šæ—¶å™¨çš„å›è°ƒå‡½æ•°ä¸­</span></span><br><span class="line">timer_ = node-&gt;<span class="built_in">create_wall_timer</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">500</span>), timer_callback);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">timer_callback</span><span class="params">()</span></span>&#123;</span><br><span class="line">  std_msgs::msg::UInt32 money;   <span class="comment">//åˆ›å»ºä¸€ä¸ªå‘é€çš„æ¶ˆæ¯</span></span><br><span class="line">  money.data = <span class="number">10</span>;       </span><br><span class="line">  pub_-&gt;<span class="built_in">publish</span>(money);          <span class="comment">//é€šè¿‡publisherçš„publishï¼ˆï¼‰å‡½æ•°æ¥å‘é€æ¶ˆæ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>rclcppå®šä¹‰çš„Nodeä¹Ÿèƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªè®¢é˜…è€…,åœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸­é€šè¿‡<strong>è®¢é˜…åˆ°ä¸å‘å¸ƒè€…ç›¸åŒçš„ä¸»é¢˜</strong>æ¥æ”¶å–å‘å¸ƒè€…ä¼ æ¥çš„æ¶ˆæ¯</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;rclcpp::Node&gt;(<span class="string">&quot;worker_wang&quot;</span>);</span><br><span class="line">rclcpp::Subscription&lt;std_msgs::msg::UInt32&gt;::SharedPtr sub_;</span><br><span class="line">sub_ = node-&gt;<span class="built_in">create_subscription</span>&lt;std_msgs::msg::UInt32&gt;(<span class="string">&quot;salary_pay&quot;</span>, <span class="number">10</span>, callback);</span><br></pre></td></tr></table></figure>

<p>create_subscriptionçš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°ï¼ˆçš„åœ°å€ï¼‰ï¼Œå½“èŠ‚ç‚¹è®¢é˜…äº†ä¸€ä¸ªè¯é¢˜ï¼ˆTopicï¼‰æ—¶ï¼Œæ¯å½“æœ‰æ–°çš„æ¶ˆæ¯å‘å¸ƒåˆ°è¯¥è¯é¢˜ï¼ŒROS2ç³»ç»Ÿå°±ä¼šè°ƒç”¨ç›¸åº”çš„å›è°ƒå‡½æ•°æ¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚<br>æ›´è¯¦ç»†çš„C++ ROS2ä»£ç ç¼–å†™ï¼Œä½ å¯ä»¥ç¿»é˜…<a target="_blank" rel="noopener" href="https://fishros.com/d2lros2/#/humble/codebook/README">ROS2å¸¸ç”¨ä»£ç æ¨¡æ¿</a>  </p>
<h3 id="3-æœ€ç®€å•çš„æœºå™¨äººé¿éšœ"><a href="#3-æœ€ç®€å•çš„æœºå™¨äººé¿éšœ" class="headerlink" title="3. æœ€ç®€å•çš„æœºå™¨äººé¿éšœ"></a>3. æœ€ç®€å•çš„æœºå™¨äººé¿éšœ</h3><p>ä»£ç é€»è¾‘ï¼šåˆ›å»ºä¸€ä¸ªé›·è¾¾é¿éšœèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹è®¢é˜…åˆ°é›·è¾¾ä¼ æ„Ÿå™¨å‘å¸ƒçš„ <strong>&#x2F;scan</strong> è¯é¢˜ï¼Œå¹¶å‘å¸ƒä¸€ä¸ªé€Ÿåº¦æ¶ˆæ¯<code>geometry_msgs::msg::Twist</code>ç»™æœºå™¨äººçš„é€Ÿåº¦æ§åˆ¶èŠ‚ç‚¹ <strong>&#x2F;cmd_vel</strong> ,æ‰€ä»¥è¿™ä¸ªèŠ‚ç‚¹æ—¢æ˜¯ä¸€ä¸ªå‘å¸ƒè€…ä¹Ÿæ˜¯ä¸€ä¸ªè®¢é˜…è€…<br>è¿™ä¸ªèŠ‚ç‚¹ä½œä¸ºä¸€ä¸ªå‘å¸ƒè€…ï¼Œæ²¡æœ‰åˆ›å»ºå®šæ—¶å™¨æ¥å®šæ—¶å‘å¸ƒæ¶ˆæ¯ï¼Œè¿™æ˜¯å› ä¸ºå®ƒå‘å¸ƒç»™ <strong>&#x2F;cmd_vel</strong> çš„é¢‘ç‡å®Œå…¨å–å†³äºä» <strong>&#x2F;scan</strong> è¯é¢˜æ¥å—æ¶ˆæ¯çš„é¢‘ç‡  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;rclcpp/rclcpp.hpp&gt;</span>                <span class="comment">//ROS2çš„å¤´æ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sensor_msgs/msg/laser_scan.hpp&gt;</span>   <span class="comment">//éœ€è¦includeçš„æ¶ˆæ¯åŒ…</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;geometry_msgs/msg/twist.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::shared_ptr&lt;rclcpp::Node&gt; node;</span><br><span class="line">rclcpp::Publisher&lt;geometry_msgs::msg::Twist&gt;::SharedPtr vel_pub;</span><br><span class="line"><span class="type">int</span> nCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">LidarCallback</span><span class="params">(<span class="type">const</span> sensor_msgs::msg::LaserScan::SharedPtr msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> nNum = msg-&gt;ranges.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> nMid = nNum / <span class="number">2</span>;</span><br><span class="line">    <span class="type">float</span> fMidDist = msg-&gt;ranges[nMid];</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(node-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;ranges[%d] = %f m&quot;</span>, nMid, fMidDist);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nCount &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        nCount--;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    geometry_msgs::msg::Twist vel_msg;</span><br><span class="line">    <span class="keyword">if</span> (fMidDist &lt; <span class="number">1.5f</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        vel_msg.angular.z = <span class="number">0.3</span>;</span><br><span class="line">        nCount = <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        vel_msg.linear.x = <span class="number">0.1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    vel_pub-&gt;<span class="built_in">publish</span>(vel_msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line"></span><br><span class="line">    node = std::<span class="built_in">make_shared</span>&lt;rclcpp::Node&gt;(<span class="string">&quot;lidar_behavior_node&quot;</span>);</span><br><span class="line"></span><br><span class="line">    vel_pub = node-&gt;<span class="built_in">create_publisher</span>&lt;geometry_msgs::msg::Twist&gt;(<span class="string">&quot;/cmd_vel&quot;</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">auto</span> lidar_sub = node-&gt;<span class="built_in">create_subscription</span>&lt;sensor_msgs::msg::LaserScan&gt;(<span class="string">&quot;/scan&quot;</span>, <span class="number">10</span>, LidarCallback);</span><br><span class="line">    <span class="comment">//åœ¨æœºå™¨äººä¸­çº¦å®šä¿—æˆçš„é€Ÿåº¦ä¸»é¢˜å’Œæ¢æµ‹å™¨ä¸»é¢˜åç§°</span></span><br><span class="line"></span><br><span class="line">    rclcpp::<span class="built_in">spin</span>(node);  <span class="comment">//å¯åŠ¨èŠ‚ç‚¹çš„æ¶ˆæ¯å¤„ç†å¾ªç¯ï¼Œä¸æ–­åœ°æ£€æŸ¥å’Œåˆ†å‘æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">    rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¿€å…‰é›·è¾¾æ¯æ¬¡æ‰«æä¼šä»$-\pi$è§’åº¦ï¼ˆæœºå™¨äººæ­£åæ–¹ï¼‰å¼€å§‹åˆ°$\pi$è§’åº¦ç»“æŸï¼Œæ¯ä¸€åº¦è¿›è¡Œä¸€æ¬¡é‡‡æ ·ï¼ˆæˆ–è€…å…¶ä»–é¢‘ç‡ï¼‰ï¼Œå¹¶æŠŠå®Œæ•´çš„é‡‡æ ·ç»“æœæ‰“åŒ…åœ¨ä¸€ä¸ªé•¿åº¦ä¸º359çš„æ•°ç»„ä¸­ï¼Œè¿›è¡Œä¸€æ¬¡æ¶ˆæ¯å‘é€<br>è¦å¾—åˆ°æœºå™¨äººæ­£å‰æ–¹éšœç¢ç‰©çš„è·ç¦»ï¼Œé‚£å°±æ˜¯è¯¥æ•°ç»„æ­£ä¸­é—´ä½ç½®çš„å€¼<br><img src="/images/ROS2-Learning/lidar.jpeg" alt="how lidar scan"><br>åˆ¤æ–­æœºå™¨äººæ­£å‰æ–¹éšœç¢ç‰©çš„è·ç¦»ï¼Œå¦‚æœå¤§äºé¢„å®šå€¼ï¼Œåˆ™æœºå™¨äººä»¥æ’å®šé€Ÿåº¦å‘æ­£å‰æ–¹ç§»åŠ¨ï¼Œè‹¥å°äºé¢„å®šå€¼ï¼Œåˆ™æœºå™¨äººåœæ­¢å‘æ­£å‰æ–¹çš„è¿åŠ¨ï¼Œè½¬ä¸ºå‘å·¦æ—‹è½¬ï¼Œå¹¶æŒç»­<code>nCount</code>ä¸ªå‘¨æœŸ  </p>
<h2 id="Chapter2-æœåŠ¡ã€å‚æ•°ä¸åŠ¨ä½œ"><a href="#Chapter2-æœåŠ¡ã€å‚æ•°ä¸åŠ¨ä½œ" class="headerlink" title="Chapter2: æœåŠ¡ã€å‚æ•°ä¸åŠ¨ä½œ"></a>Chapter2: æœåŠ¡ã€å‚æ•°ä¸åŠ¨ä½œ</h2><h3 id="1-Service-æœåŠ¡"><a href="#1-Service-æœåŠ¡" class="headerlink" title="1. Service æœåŠ¡"></a>1. Service æœåŠ¡</h3><p>æ„æˆä¸€ä¸ªæœåŠ¡çš„åŒæ–¹æ˜¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ï¼Œæœ€åå®¢æˆ·ç«¯æ ¹æ®æœåŠ¡ç«¯çš„å“åº”åšå‡ºè°ƒæ•´ï¼Œå› è€ŒæœåŠ¡ä¹Ÿè¢«ç§°ä¸ºè¯·æ±‚-å“åº”æ¨¡å‹<br>ä¸è¯é¢˜ç›¸æ¯”ï¼Œè¯é¢˜æ˜¯å•å‘çš„ï¼Œé¢‘ç‡é«˜ï¼Œå®æ—¶æ€§å¼ºçš„ä¼ æ„Ÿå™¨æ•°æ®çš„ä¼ é€’ä¸€èˆ¬ä½¿ç”¨è¯é¢˜å®ç°ï¼›è€ŒæœåŠ¡æ˜¯åŒå‘çš„ï¼Œé¢‘ç‡è¾ƒä½ï¼Œå¼ºè°ƒæœåŠ¡ç‰¹æ€§å’Œåé¦ˆçš„åœºæ™¯ä¸€èˆ¬ä½¿ç”¨æœåŠ¡å®ç°  </p>
<p><img src="/images/ROS2-Learning/service.png" alt="service"></p>
<p>ä¸€ä¸ªæœåŠ¡çš„åˆ›å»ºè€…åªèƒ½æœ‰ä¸€ä¸ªï¼Œå³ä¸€ä¸ªæœåŠ¡ç«¯ï¼Œè€Œä¸€ä¸ªæœåŠ¡å¯ä»¥æœ‰å¤šä¸ªå®¢æˆ·ç«¯<br>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨OOPçš„æ–¹å¼æ¥åˆ›å»ºä¸€ç»„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯  </p>
<h4 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="- æœåŠ¡ç«¯"></a>- æœåŠ¡ç«¯</h4><p>å®šä¹‰ç±»ServiceServer01ï¼Œç»§æ‰¿è‡ªrclcpp::Node</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;example_interfaces/srv/add_two_ints.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ServiceServer01</span> : <span class="keyword">public</span> rclcpp::Node &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">ServiceServer01</span>(std::string name) : <span class="built_in">Node</span>(name) &#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;èŠ‚ç‚¹å·²å¯åŠ¨ï¼š%s.&quot;</span>, name.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="comment">// åˆ›å»ºæœåŠ¡</span></span><br><span class="line">    add_ints_server_ =</span><br><span class="line">      <span class="keyword">this</span>-&gt;<span class="built_in">create_service</span>&lt;example_interfaces::srv::AddTwoInts&gt;(</span><br><span class="line">        <span class="string">&quot;add_two_ints_srv&quot;</span>,</span><br><span class="line">        std::<span class="built_in">bind</span>(&amp;ServiceServer01::handle_add_two_ints, <span class="keyword">this</span>,std::placeholders::_1, std::placeholders::_2));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">// service server åº”å½“æ˜¯nodeçš„ä¸€ä¸ªæˆå‘˜</span></span><br><span class="line">  rclcpp::Service&lt;example_interfaces::srv::AddTwoInts&gt;::SharedPtr add_ints_server_;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®šä¹‰å›è°ƒå‡½æ•°ï¼šæ¥æ”¶åˆ°è¯·æ±‚åï¼Œå°†è¯·æ±‚çš„ä¸¤ä¸ªæ•´æ•°ç›¸åŠ </span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">handle_add_two_ints</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> std::shared_ptr&lt;example_interfaces::srv::AddTwoInts::Request&gt; request,</span></span></span><br><span class="line"><span class="params"><span class="function">    std::shared_ptr&lt;example_interfaces::srv::AddTwoInts::Response&gt; response)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//å‘ç»ˆç«¯æ‰“å°æ—¥å¿—ï¼Œè®©èŠ‚ç‚¹é€šä¿¡æ›´åŠ å¯è§†åŒ–</span></span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;æ”¶åˆ°a: %ld b: %ld&quot;</span>, request-&gt;a,request-&gt;b);</span><br><span class="line">      <span class="comment">//responseçš„å€¼ä¸ºè¯·æ±‚çš„ä¸¤ä¸ªæ•´æ•°ä¹‹å’Œ</span></span><br><span class="line">      response-&gt;sum = request-&gt;a + request-&gt;b;</span><br><span class="line">      <span class="comment">//æ³¨æ„è¿™é‡Œï¼ŒæœåŠ¡ç«¯å¹¶æ²¡æœ‰ä¸»åŠ¨åœ°å°†responseä¼ å›å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ¥æ”¶å“åº”æ˜¯ç”±å®¢æˆ·ç«¯å›è°ƒå‡½æ•°ä¸­çš„shared_futureå‚æ•°å®Œæˆçš„</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> </span>&#123;</span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">  <span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;ServiceServer01&gt;(<span class="string">&quot;service_server_01&quot;</span>); </span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(node);</span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œresponse å˜é‡å¹¶æ²¡æœ‰è¢«æ˜¾å¼åˆ›å»ºã€‚åœ¨æœåŠ¡ç«¯çš„å›è°ƒå‡½æ•° handle_add_two_ints ä¸­ï¼Œresponse æ˜¯ä½œä¸ºå‚æ•°ä¼ é€’è¿›æ¥çš„ï¼Œä¸éœ€è¦æœåŠ¡ç«¯æ˜¾å¼åˆ›å»ºã€‚è¿™ä¸ªå‚æ•°æ˜¯ç”± ROS 2 çš„æœåŠ¡å›è°ƒæœºåˆ¶è‡ªåŠ¨ç®¡ç†çš„<br>æœåŠ¡ç«¯ä¸éœ€è¦ <strong>ä¹Ÿä¸åº”è¯¥</strong> å°è¯•è‡ªå·±åˆ›å»ºæˆ–é”€æ¯è¿™ä¸ª response å¯¹è±¡ã€‚å½“æœåŠ¡ç«¯çš„å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼ŒROS 2 æ¡†æ¶ä¼šè‡ªåŠ¨å¤„ç†è¿™ä¸ªå“åº”å¯¹è±¡ï¼Œå°†å…¶å‘é€å›å®¢æˆ·ç«¯  </p>
<h4 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="- å®¢æˆ·ç«¯"></a>- å®¢æˆ·ç«¯</h4><p>å®šä¹‰ç±»ServiceClient01ï¼Œç»§æ‰¿è‡ªrclcpp::Node  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;example_interfaces/srv/add_two_ints.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ServiceClient01</span> : <span class="keyword">public</span> rclcpp::Node &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// æ„é€ å‡½æ•°,æœ‰ä¸€ä¸ªå‚æ•°ä¸ºèŠ‚ç‚¹åç§°</span></span><br><span class="line">  <span class="built_in">ServiceClient01</span>(std::string name) : <span class="built_in">Node</span>(name) &#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;èŠ‚ç‚¹å·²å¯åŠ¨ï¼š%s.&quot;</span>, name.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="comment">// åˆ›å»ºå®¢æˆ·ç«¯</span></span><br><span class="line">    client_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_client</span>&lt;example_interfaces::srv::AddTwoInts&gt;(<span class="string">&quot;add_two_ints_srv&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">send_request</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;è®¡ç®—%d+%d&quot;</span>, a, b);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.ç­‰å¾…æœåŠ¡ç«¯ä¸Šçº¿</span></span><br><span class="line">    <span class="keyword">while</span> (!client_-&gt;<span class="built_in">wait_for_service</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">1</span>))) &#123;</span><br><span class="line">      <span class="comment">//æ£€æµ‹rclcppçš„çŠ¶æ€</span></span><br><span class="line">      <span class="keyword">if</span> (!rclcpp::<span class="built_in">ok</span>()) &#123;</span><br><span class="line">        <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;ç­‰å¾…æœåŠ¡çš„è¿‡ç¨‹ä¸­è¢«æ‰“æ–­...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;ç­‰å¾…æœåŠ¡ç«¯ä¸Šçº¿ä¸­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.æœåŠ¡ç«¯å·²ä¸Šçº¿ï¼Œæ„é€ è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">auto</span> request = std::<span class="built_in">make_shared</span>&lt;example_interfaces::srv::AddTwoInts_Request&gt;();</span><br><span class="line">    request-&gt;a = a;</span><br><span class="line">    request-&gt;b = b;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.å‘é€å¼‚æ­¥è¯·æ±‚ï¼Œç„¶åç­‰å¾…è¿”å›ï¼Œè¿”å›æ—¶è°ƒç”¨å›è°ƒå‡½æ•°</span></span><br><span class="line">    client_-&gt;<span class="built_in">async_send_request</span>(</span><br><span class="line">      request, std::<span class="built_in">bind</span>(&amp;ServiceClient01::result_callback_, <span class="keyword">this</span>,</span><br><span class="line">                         std::placeholders::_1));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">// service client åº”ä¸ºnodeçš„æˆå‘˜</span></span><br><span class="line">  rclcpp::Client&lt;example_interfaces::srv::AddTwoInts&gt;::SharedPtr client_;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å®šä¹‰å›è°ƒå‡½æ•°ï¼šå®¢æˆ·ç«¯çš„å›è°ƒå‡½æ•°ä¸æ­¢å®šä¹‰äº†è‡ªå·±æ”¶åˆ°æœåŠ¡å“åº”åçš„è¡Œä¸ºï¼Œè¿˜é€šè¿‡shared_futureæ¥è‡ªåŠ¨æ¥å—æœåŠ¡ç«¯ä¼ æ¥çš„å“åº”</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">result_callback_</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    rclcpp::Client&lt;example_interfaces::srv::AddTwoInts&gt;::SharedFuture</span></span></span><br><span class="line"><span class="params"><span class="function">      result_future)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//é€šè¿‡è°ƒç”¨ result_future.get() æ¥è·å–æœåŠ¡çš„å“åº”ç»“æœ</span></span><br><span class="line">    <span class="keyword">auto</span> response = result_future.<span class="built_in">get</span>();</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;è®¡ç®—ç»“æœï¼š%ld&quot;</span>, response-&gt;sum);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> </span>&#123;</span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">  <span class="comment">/*åˆ›å»ºå¯¹åº”èŠ‚ç‚¹çš„å…±äº«æŒ‡é’ˆå¯¹è±¡*/</span></span><br><span class="line">  <span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;ServiceClient01&gt;(<span class="string">&quot;service_client_01&quot;</span>);</span><br><span class="line">  <span class="comment">//å‘é€è¯·æ±‚</span></span><br><span class="line">  node-&gt;<span class="built_in">send_request</span>(<span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">  <span class="comment">/* è¿è¡ŒèŠ‚ç‚¹ï¼Œå¹¶æ£€æµ‹é€€å‡ºä¿¡å·*/</span></span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(node);</span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨mainå‡½æ•°ä¸­ï¼Œnodeåªè°ƒç”¨äº†ä¸€æ¬¡send_request()å‡½æ•°ï¼Œå¹¶æ²¡æœ‰å†…ç½®å®šæ—¶å™¨ï¼Œæ‰€ä»¥spin(node)åè¯·æ±‚ä¹Ÿåªä¼šå‘é€ä¸€æ¬¡  </p>
<h3 id="2-Interface-æ¥å£"><a href="#2-Interface-æ¥å£" class="headerlink" title="2. Interface æ¥å£"></a>2. Interface æ¥å£</h3><p>æ¥å£æ˜¯ROS2å®šä¹‰çš„ç»Ÿä¸€çš„æ¶ˆæ¯æ ¼å¼ï¼Œæ¯”å¦‚ï¼Œæ¯ä¸ªé›·è¾¾å‚å®¶éƒ½ä¼šç¼–å†™ç¨‹åºä½¿è‡ªå·±é›·è¾¾çš„æ•°æ®é€‚é…sensor_msgs&#x2F;msg&#x2F;LaserScanæ ¼å¼ï¼Œè¿™æ ·ä¸åŒå‚å•†ç”Ÿäº§çš„é›·è¾¾éƒ½èƒ½ä¸æœºå™¨äººå…¶ä»–ç»„ä»¶é€šä¿¡<br>å¯ä»¥ä½¿ç”¨<code>ros2 interface package sensor_msgs</code>å‘½ä»¤æŸ¥çœ‹æŸä¸€ä¸ªæ¥å£åŒ…ä¸‹æ‰€æœ‰çš„æ¥å£<br>é€šè¿‡<code>ros2 interface show std_msgs/msg/String</code>æŸ¥çœ‹æŸä¸€æ¥å£çš„è¯¦ç»†å†…å®¹<br>ä¹Ÿæ¨èåœ¨<a target="_blank" rel="noopener" href="https://index.ros.org/">ros index</a>ä¸ŠæŸ¥æ‰¾èµ„æ–™<br>ROS2ä¸­åŸºç¡€çš„æ¶ˆæ¯ç±»å‹æœ‰ï¼š  </p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bool</span><br><span class="line">byte</span><br><span class="line">char</span><br><span class="line">float32,float64</span><br><span class="line">int8,uint8</span><br><span class="line">int16,uint16</span><br><span class="line">int32,uint32</span><br><span class="line">int64,uint64</span><br><span class="line">string</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥åœ¨åŸºç¡€ç±»å‹ä¹‹ä¸Šå°è£…ï¼Œå¥—å¨ƒ  </p>
<p>ä½ å¯ä»¥è‡ªå®šä¹‰.msg .srv .actionæ¥å£ï¼Œåœ¨å·¥ä½œåŒ…ä¸­åˆ›å»ºmsgå’Œsrvæ–‡ä»¶å¤¹  </p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#ç”±äºæ¥å£ä¾èµ–äºrosidl_default_generatorsç”Ÿæˆç‰¹å®šäºè¯­è¨€çš„ä»£ç ï¼Œå› æ­¤æ‚¨éœ€è¦å£°æ˜å¯¹å…¶çš„æ„å»ºå·¥å…·ä¾èµ–é¡¹ã€‚</span><br><span class="line"></span><br><span class="line">find_package(rosidl_default_generators REQUIRED)</span><br><span class="line"></span><br><span class="line">rosidl_generate_interfaces($&#123;PROJECT_NAME&#125;</span><br><span class="line">  &quot;msg/Num.msg&quot;              # your self-defined interface files</span><br><span class="line">  &quot;msg/Sphere.msg&quot;</span><br><span class="line">  &quot;srv/AddThreeInts.srv&quot;</span><br><span class="line">  DEPENDENCIES geometry_msgs # Add packages above messages depend on, in this case geometry_msgs for Sphere.msg</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="3-Parameters-å‚æ•°"><a href="#3-Parameters-å‚æ•°" class="headerlink" title="3. Parameters å‚æ•°"></a>3. Parameters å‚æ•°</h3><p>å‚æ•°å¯ä»¥ç†è§£ä¸ºæ–¹ä¾¿è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹å’Œç®¡ç†çš„æœºå™¨äººè®¾ç½®ï¼Œç”±ROS2çš„å‚æ•°æœåŠ¡ä¸­å¤®é›†ä¸­ç®¡ç†<br>å‚æ•°æ˜¯ç”±é”®å€¼å¯¹ç»„æˆçš„ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²å­˜å‚¨åå­—ï¼Œæ•°å€¼çš„å­˜å‚¨å¯ä»¥ç”± bool, int64, float64, string, byte ä»¥åŠå®ƒä»¬çš„æ•°ç»„å®Œæˆ<br>å‚æ•°çš„æ“ä½œæœ‰ï¼š  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node-&gt;<span class="built_in">declare_parameter</span>(name, default_value, type)   <span class="comment">//å£°æ˜å’Œåˆå§‹åŒ–ä¸€ä¸ªå‚æ•°,å‚æ•°ç±»å‹å¯çœç•¥</span></span><br><span class="line">node-&gt;<span class="built_in">describe_parameter</span>(name)                       <span class="comment">//é€šè¿‡å‚æ•°åå­—è·å–å‚æ•°çš„æè¿°</span></span><br><span class="line">node-&gt;<span class="built_in">get_parameter</span>(name, value)                     <span class="comment">//é€šè¿‡å‚æ•°åå­—å°†å‚æ•°çš„å€¼èµ‹å€¼åˆ°valueä¸Š</span></span><br><span class="line">node-&gt;<span class="built_in">set_parameter</span>(name, value)                     <span class="comment">//å°†å‚æ•°çš„å€¼è®¾ä¸ºvalue</span></span><br></pre></td></tr></table></figure>

<h3 id="4-Action-åŠ¨ä½œ"><a href="#4-Action-åŠ¨ä½œ" class="headerlink" title="4. Action åŠ¨ä½œ"></a>4. Action åŠ¨ä½œ</h3><p>åŠ¨ä½œç»“åˆäº†è¯é¢˜ä¸æœåŠ¡ï¼Œç”¨äºå¤„ç†éœ€è¦é¢‘ç¹åé¦ˆåœºæ™¯ï¼Œæ¯”å¦‚ç°åœ¨éœ€è¦å‘é€ä¸€ä¸ªç›®æ ‡ç‚¹ç»™æœºå™¨äººï¼š  </p>
<ol>
<li>éœ€è¦çŸ¥é“æœºå™¨äººæ˜¯å¦æ¥æ”¶åˆ°ï¼Œå¹¶åœ¨å¤„ç†ç§»åŠ¨åˆ°ç›®æ ‡ç‚¹çš„è¯·æ±‚</li>
<li>å‡è®¾æœºå™¨äººæ”¶åˆ°äº†è¯·æ±‚ï¼Œéœ€è¦çŸ¥é“æœºå™¨äººæ­¤æ—¶çš„ä½ç½®å’Œè·ç¦»ç›®æ ‡ç‚¹çš„è·ç¦»ï¼ˆåé¦ˆï¼‰</li>
<li>å‡è®¾æœºå™¨äººç§»åŠ¨ä¸€åŠï¼Œä½ æƒ³è®©æœºå™¨äººåœä¸‹æ¥ï¼Œè¿™æ—¶éœ€è¦é€šçŸ¥æœºå™¨äºº</li>
</ol>
<p>å› è€ŒActionç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆï¼šç›®æ ‡ã€åé¦ˆå’Œç»“æœã€‚</p>
<ul>
<li>ç›®æ ‡ï¼šå³Actionå®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯è¦åšä»€ä¹ˆï¼ŒæœåŠ¡ç«¯é’ˆå¯¹è¯¥ç›®æ ‡è¦æœ‰å“åº”</li>
<li>åé¦ˆï¼šå³ActionæœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯æ­¤æ—¶åšçš„è¿›åº¦å¦‚ä½•ï¼ˆç±»ä¼¼ä¸å·¥ä½œæ±‡æŠ¥ï¼‰</li>
<li>ç»“æœï¼šå³ActionæœåŠ¡ç«¯æœ€ç»ˆå‘Šè¯‰å®¢æˆ·ç«¯å…¶æ‰§è¡Œç»“æœï¼Œç»“æœæœ€åè¿”å›ï¼Œç”¨äºè¡¨ç¤ºä»»åŠ¡æœ€ç»ˆæ‰§è¡Œæƒ…å†µã€‚</li>
</ul>
<p>äº‹å®ä¸Šï¼ŒActionæ˜¯ç”±è¯é¢˜å’ŒæœåŠ¡å…±åŒæ„å»ºå‡ºæ¥çš„ï¼ˆä¸€ä¸ªAction &#x3D; ä¸‰ä¸ªæœåŠ¡+ä¸¤ä¸ªè¯é¢˜ï¼‰ ä¸‰ä¸ªæœåŠ¡åˆ†åˆ«æ˜¯ï¼š1.ç›®æ ‡ä¼ é€’æœåŠ¡ 2.ç»“æœä¼ é€’æœåŠ¡ 3.å–æ¶ˆæ‰§è¡ŒæœåŠ¡ ä¸¤ä¸ªè¯é¢˜ï¼š1.åé¦ˆè¯é¢˜ï¼ˆæœåŠ¡å‘å¸ƒï¼Œå®¢æˆ·ç«¯è®¢é˜…ï¼‰ 2.çŠ¶æ€è¯é¢˜ï¼ˆæœåŠ¡ç«¯å‘å¸ƒï¼Œå®¢æˆ·ç«¯è®¢é˜…ï¼‰  </p>
<p><img src="/images/ROS2-Learning/action.png" alt="action"></p>
<p>ä¾‹å¦‚ï¼Œturtlesimä¸­å°ä¹Œé¾Ÿçš„æ—‹è½¬æ§åˆ¶æ˜¯ç”±actionå®ç°çš„</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯·æ±‚ï¼šæ—‹è½¬åˆ°çš„ç›®æ ‡è§’åº¦ï¼ˆå¼§åº¦åˆ¶ï¼‰</span></span><br><span class="line"><span class="string">float32</span> <span class="string">theta</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># ç»“æœï¼šæ—‹è½¬äº†å¤šå°‘è§’åº¦</span></span><br><span class="line"><span class="string">float32</span> <span class="string">delta</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># åé¦ˆï¼šè¿˜éœ€æ—‹è½¬çš„è§’åº¦</span></span><br><span class="line"><span class="string">float32</span> <span class="string">remaining</span></span><br></pre></td></tr></table></figure>

<p>å‘ç»ˆç«¯å‘é€<code>ros2 action send_goal /turtle1/rotate_absolute turtlesim/action/RotateAbsolute &quot;&#123;theta: 1.5&#125;&quot; --feedback</code><br>ç»ˆç«¯å°†è¿”å›ï¼š  </p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Waiting for an action server to become available...</span><br><span class="line">Sending goal:</span><br><span class="line">     theta: 1.5</span><br><span class="line"></span><br><span class="line">Feedback:</span><br><span class="line">    remaining: -0.0840003490447998</span><br><span class="line"></span><br><span class="line">Goal accepted with ID: b368de0ed1a54e00890f1b078f4671c8</span><br><span class="line"></span><br><span class="line">Feedback:</span><br><span class="line">    remaining: -0.06800031661987305</span><br><span class="line"></span><br><span class="line">Feedback:</span><br><span class="line">    remaining: -0.05200028419494629</span><br><span class="line"></span><br><span class="line">Feedback:</span><br><span class="line">    remaining: -0.03600025177001953</span><br><span class="line"></span><br><span class="line">Feedback:</span><br><span class="line">    remaining: -0.020000219345092773</span><br><span class="line"></span><br><span class="line">Feedback:</span><br><span class="line">    remaining: -0.004000186920166016</span><br><span class="line"></span><br><span class="line">Result:</span><br><span class="line">    delta: 0.08000016212463379</span><br><span class="line"></span><br><span class="line">Goal finished with status: SUCCEEDED</span><br></pre></td></tr></table></figure>

<h2 id="Chapter3ï¼šSLAM-â€”â€”-åŒæ­¥å®šä½ä¸åœ°å›¾æ„å»º"><a href="#Chapter3ï¼šSLAM-â€”â€”-åŒæ­¥å®šä½ä¸åœ°å›¾æ„å»º" class="headerlink" title="Chapter3ï¼šSLAM â€”â€” åŒæ­¥å®šä½ä¸åœ°å›¾æ„å»º"></a>Chapter3ï¼šSLAM â€”â€” åŒæ­¥å®šä½ä¸åœ°å›¾æ„å»º</h2><p>SLAMæ¶‰åŠåˆ°ç›¸å½“å¤šçš„å†…å®¹ï¼ŒåŒ…æ‹¬ç¹å¤šçš„å‚æ•°æ§åˆ¶ï¼Œç‰¹å¾æå–ï¼Œä¼˜åŒ–ç®—æ³•ä¸å¾ªç¯æ£€æµ‹ç­‰ï¼Œå¯¹äºä¸ªäººè€Œè¨€ï¼Œä»å¤´æ„å»ºSLAMç®—æ³•æ˜¯å›°éš¾çš„ã€‚å¥½åœ¨æœ‰è®¸å¤šæˆç†Ÿçš„SLAMè½¯ä»¶åŒ…ï¼Œå¦‚åŸºäºæ»¤æ³¢çš„gmappingã€hector_slamå’ŒåŸºäºå›¾ä¼˜åŒ–çš„Cartographerç­‰ï¼Œèƒ½æ»¡è¶³å¤§éƒ¨åˆ†çš„åº”ç”¨åœºæ™¯<br>SLAMå¼€æºåº“ï¼š  </p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/cartographer-project/cartographer">Cartographer</a><br>  Cartographeræ˜¯ä¸€ä¸ªå¯è·¨å¤šä¸ªå¹³å°å’Œä¼ æ„Ÿå™¨é…ç½®ä»¥2Då’Œ3Då½¢å¼æä¾›å®æ—¶åŒæ—¶å®šä½å’Œå»ºå›¾ï¼ˆSLAMï¼‰çš„ç³»ç»Ÿã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.com/raulmur/ORB_SLAM2">ORB_SLAM2(çº¯è§†è§‰)</a><br>  ORB-SLAM2æ˜¯ç”¨äºå•ç›®ï¼ŒåŒç›®å’ŒRGB-Dç›¸æœºçš„å®æ—¶SLAMåº“ï¼Œç”¨äºè®¡ç®—ç›¸æœºè½¨è¿¹å’Œç¨€ç–3Dé‡å»º</li>
<li><a target="_blank" rel="noopener" href="https://github.com/HKUST-Aerial-Robotics/VINS-Mono">VINS</a><br>  VINS-Monoæ˜¯å•ç›®è§†è§‰æƒ¯æ€§ç³»ç»Ÿçš„å®æ—¶SLAMæ¡†æ¶ã€‚å®ƒä½¿ç”¨åŸºäºä¼˜åŒ–çš„æ»‘åŠ¨çª—å£é…æ–¹æ¥æä¾›é«˜ç²¾åº¦çš„è§†è§‰æƒ¯æ€§æµ‹è·</li>
</ol>
<h3 id="1-æ …æ ¼åœ°å›¾æ ¼å¼"><a href="#1-æ …æ ¼åœ°å›¾æ ¼å¼" class="headerlink" title="1. æ …æ ¼åœ°å›¾æ ¼å¼"></a>1. æ …æ ¼åœ°å›¾æ ¼å¼</h3><p>SLAMä¸­åœ°å›¾çš„å‘é€æ ¼å¼æ˜¯nav_msgs&#x2F;OccupancyGrid å æ®æ …æ ¼æ ¼å¼  </p>
<p><img src="/images/ROS2-Learning/OccupancyGrid.jpeg" alt="OccupancyGrid"></p>
<p>è¿™ç›¸å½“äºå¯¹åœºæ™¯ç”¨å°æ–¹æ ¼åšç»†ç²’åº¦åˆ’åˆ†ï¼Œç”¨0-100ä»£è¡¨éšœç¢ç‰©çš„å æ®å€¼ï¼ˆä¸å¯èƒ½æœ‰éšœç¢ç‰©-&gt;ç»å¯¹æœ‰éšœç¢ç‰©ï¼‰ï¼Œç”¨-1ä»£è¡¨éšœç¢ç‰©æƒ…å†µæœªçŸ¥ï¼ˆåœ¨éƒ¨åˆ†åœ°å›¾ä¸­ç”¨é«˜æ–¯å™ªå£°è¡¨ç¤ºéšœç¢ç‰©æƒ…å†µæœªçŸ¥ï¼‰ï¼Œå› è€Œæ …æ ¼åœ°å›¾é€šè¿‡æ•´å‹æ•°ç»„å‚¨å­˜<br>SLAMçš„map_serverèŠ‚ç‚¹ä»¥nav_msgs&#x2F;OccupancyGridçš„æ ¼å¼å‘å¸ƒ&#x2F;mapè¯é¢˜  </p>
<p>åœ¨OccupancyGrid.msgä¸­ï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># This represents a 2-D grid map</span><br><span class="line">std_msgs/Header header</span><br><span class="line"></span><br><span class="line"># MetaData for the map</span><br><span class="line">MapMetaData info</span><br><span class="line"></span><br><span class="line"># The map data, in row-major order, starting with (0,0). </span><br><span class="line"># Cell (1, 0) will be listed second, representing the next cell in the x direction. </span><br><span class="line"># Cell (0, 1) will be at the index equal to info.width, followed by (1, 1).</span><br><span class="line"># The values inside are application dependent, but frequently, </span><br><span class="line"># 0 represents unoccupied, 1 represents definitely occupied, and</span><br><span class="line"># -1 represents unknown. </span><br><span class="line">int8[] data</span><br></pre></td></tr></table></figure>

<p>MapMetaDataå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># This hold basic information about the characteristics of the OccupancyGrid</span><br><span class="line"></span><br><span class="line"># The time at which the map was loaded</span><br><span class="line">builtin_interfaces/Time map_load_time</span><br><span class="line"></span><br><span class="line"># Map resolution: the side length of each grid</span><br><span class="line">float32 resolution</span><br><span class="line"></span><br><span class="line"># Map width [total]</span><br><span class="line">uint32 width</span><br><span class="line"></span><br><span class="line"># Map height [total]</span><br><span class="line">uint32 height</span><br><span class="line"></span><br><span class="line"># The origin of the map [m, m, rad]. </span><br><span class="line"># This is the real-world pose of the bottom left corner of cell (0,0) in the map.</span><br><span class="line">geometry_msgs/Pose origin</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„Pose originçš„å®šä¹‰ä¸å¤Ÿæ¸…æ™°ï¼ˆè¿™ä¸ªreal-world poseæŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯æœºå™¨äººåœ¨å›¾ä¸­çš„åˆå§‹ä½ç½®å—ï¼Ÿï¼‰ï¼Œåœ¨æˆ‘çš„å®è·µä¸‹ï¼Œæˆ‘ç¡®å®šè¿™ä¸ªoriginæè¿°çš„æ˜¯åœ°å›¾æœ€å·¦ä¸‹è§’åˆ° <strong>mapåæ ‡ç³»åŸç‚¹</strong> çš„ä½å§¿å…³ç³»ï¼Œå…·ä½“çš„è§£é‡Šæ”¾åœ¨åé¢çš„slamæ¼”ç¤ºéƒ¨åˆ†  </p>
<h3 id="2-SLAMç®—æ³•é€»è¾‘"><a href="#2-SLAMç®—æ³•é€»è¾‘" class="headerlink" title="2. SLAMç®—æ³•é€»è¾‘"></a>2. SLAMç®—æ³•é€»è¾‘</h3><p>ä¸åŒçš„ä¼ æ„Ÿå™¨ä¼šç”¨åˆ°ä¸åŒçš„SLAMç®—æ³•ï¼Œå¦‚è§†è§‰ä¼ æ„Ÿå™¨éœ€è¦ç”¨åˆ°ç‰¹å¾æå–å»ºå›¾</p>
<p><img src="/images/ROS2-Learning/visual_SLAM.jpeg" alt="visual SLAM"></p>
<p>è¿™é‡Œæˆ‘ä»¬ä»‹ç»æœ€åŸºç¡€çš„SLAM â€”â€” ä½¿ç”¨é›·è¾¾ä¿¡å·çš„ 2D SLAM ç®—æ³•  </p>
<ol>
<li>æœºå™¨äººåœ¨åˆå§‹ä½ç½®åŸåœ°æ‰«æä¸€åœˆï¼Œæ¢æµ‹åˆ°éšœç¢ç‰©çš„ä½ç½®æ ‡è®°ä¸º100ï¼Œæ— éšœç¢ç‰©çš„ä½ç½®æ ‡è®°ä¸º0ï¼Œå…¶ä»–ä½ç½®ä¿æŒåˆå§‹å€¼-1<br>  <img src="/images/ROS2-Learning/first_scan1.jpeg" alt="first scan1"><br>  <img src="/images/ROS2-Learning/first_scan2.jpeg" alt="first scan2"></li>
<li>æœºå™¨äººåœ¨ç§»åŠ¨ä¸€å®šæ—¶é—´åå†è¿›è¡Œä¸€æ¬¡æ‰«æï¼Œå¹¶ä¸æœ€æ–°çš„åœ°å›¾è¿›è¡Œç‰¹å¾æ¯”è¾ƒï¼ˆåœ¨é›·è¾¾SLAMä¸­ï¼Œåœ°å›¾çš„ç‰¹å¾æ˜¯éšœç¢ç‰©æ …æ ¼çš„æ’å¸ƒæƒ…å†µï¼‰ï¼Œè¿›è¡Œæ—‹è½¬è´´åˆï¼Œä»è€Œå¾—åˆ°æ‹“å±•åçš„åœ°å›¾å’Œå½“å‰åŸºäºä¸Šä¸€æ¬¡åœ°å›¾æ›´æ–°çš„ç›¸å¯¹ä½ç½®ï¼Œè¿™ä¸€æ­¥æ˜¯SLAMçš„æ ¸å¿ƒ<br>  <img src="/images/ROS2-Learning/map_fitting1.jpeg" alt="map fitting1"><br>  <img src="/images/ROS2-Learning/map_fitting2.jpeg" alt="map fitting2"></li>
<li>é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œå°±å¯ä»¥è·å¾—å®Œæ•´çš„æ …æ ¼åœ°å›¾ï¼Œåœ¨å¯¼èˆªæ—¶å¯ä»¥åœ¨æ— éšœç¢åŒºåŸŸè¿›è¡Œè·¯å¾„è§„åˆ’<br>  <img src="/images/ROS2-Learning/full_map.jpeg" alt="full map"></li>
</ol>
<p>æ€»ç»“æ¥è¯´ï¼Œä¸€ä¸ªSLAMèŠ‚ç‚¹è®¢é˜…é›·è¾¾ä¼ æ„Ÿå™¨çš„&#x2F;scanè¯é¢˜ï¼Œåœ¨å†…éƒ¨å­˜å‚¨å½“å‰æœ€æ–°çš„æ …æ ¼åœ°å›¾å¹¶å‘å¸ƒåœ°å›¾æ•°æ®è¯é¢˜&#x2F;map<br><img src="/images/ROS2-Learning/slam_node.jpeg" alt="slam node"></p>
<h3 id="3-ä»¿çœŸæ¼”ç¤º"><a href="#3-ä»¿çœŸæ¼”ç¤º" class="headerlink" title="3. ä»¿çœŸæ¼”ç¤º"></a>3. ä»¿çœŸæ¼”ç¤º</h3><p>ä¸ºäº†ä¾¿äºæ¼”ç¤ºï¼Œæœ¬ç« ä½¿ç”¨çš„æ˜¯6-robotå‘å¸ƒçš„<a target="_blank" rel="noopener" href="https://github.com/6-robot/wpr_simulation2">wpr_simulation2</a>ï¼Œä»…æ”¯æŒhumbleç‰ˆæœ¬ã€‚wpr_simulation2çš„ä»¿çœŸåŸºäºgazeboï¼ŒSLAMç®—æ³•åŸºäºslam_toolboxã€‚å¯¹äºSLAMæ›´ç³»ç»Ÿæ€§çš„é˜è¿°ä¼šåœ¨åé¢çš„ç« èŠ‚å±•ç¤º  </p>
<p><img src="/images/ROS2-Learning/slam_simulation.png" alt="slam simulaion"></p>
<h3 id="4-TFä¸é‡Œç¨‹è®¡"><a href="#4-TFä¸é‡Œç¨‹è®¡" class="headerlink" title="4. TFä¸é‡Œç¨‹è®¡"></a>4. TFä¸é‡Œç¨‹è®¡</h3><h4 id="TF"><a href="#TF" class="headerlink" title="- TF"></a>- TF</h4><p>TFç³»ç»Ÿæè¿°äº†çˆ¶åæ ‡ç³»ä¸å­åæ ‡ç³»ä¹‹é—´çš„å…³ç³»ï¼Œé€šè¿‡å‘é‡ä¸æ—‹è½¬çš„å åŠ ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥å¾—åˆ°æœºå™¨äººç§»åŠ¨åå½“å‰ä½ç½®å…³äºåŸç‚¹çš„ä½ç½®å…³ç³»ï¼Œä¹Ÿèƒ½å¾—åˆ°æœºå™¨äººæœ«ç«¯å…³äºæœºå™¨äººåº•åº§çš„ä½å§¿å…³ç³»</p>
<p><img src="/images/ROS2-Learning/robot_arm.png" alt="robot arm"></p>
<p>&#x2F;tfè¯é¢˜å‘å¸ƒçš„æ¶ˆæ¯æ ¼å¼æ˜¯tf2_msgs&#x2F;TFMessage.msgï¼Œæ˜¯ä¸€ä¸ªTransformStampedæ•°æ®ç»„æˆçš„æ•°ç»„ <strong>transforms</strong><br>åœ¨å•ä¸ªTransformStampedæ•°æ®ä¸­,åŒ…å«äº†headerï¼ˆçˆ¶åæ ‡ç³»åç§°frame_idï¼‰ï¼Œå­åæ ‡ç³»åç§°child_frame_idå’Œå­åæ ‡ç³»åœ¨çˆ¶åæ ‡ç³»ä¸­çš„å˜æ¢  </p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># This expresses a transform from coordinate frame header.frame_id</span><br><span class="line"># to the coordinate frame child_frame_id</span><br><span class="line">#</span><br><span class="line"># This message is mostly used by the </span><br><span class="line"># tf package. </span><br><span class="line"># See its documentation for more information.</span><br><span class="line"></span><br><span class="line">Header header</span><br><span class="line">string child_frame_id # the frame id of the child frame</span><br><span class="line">Transform transform</span><br></pre></td></tr></table></figure>

<p>transformä¸­åŒ…å«ä¸‰ç»´ä½ç§»ä¿¡æ¯å’Œå››å…ƒæ•°ï¼ˆä¸‰ç»´è§’åº¦åç§»é‡ï¼‰ä¿¡æ¯ï¼Œç»ˆç«¯è¾“å…¥<code>ros2 topic echo /tf</code>  </p>
<p><img src="/images/ROS2-Learning/transform.jpeg" alt="transform"></p>
<h4 id="é‡Œç¨‹è®¡åœ¨SLAMä¸­çš„åº”ç”¨"><a href="#é‡Œç¨‹è®¡åœ¨SLAMä¸­çš„åº”ç”¨" class="headerlink" title="- é‡Œç¨‹è®¡åœ¨SLAMä¸­çš„åº”ç”¨"></a>- é‡Œç¨‹è®¡åœ¨SLAMä¸­çš„åº”ç”¨</h4><p>ROS1ä¸­æœ‰ä¸¤ç§SLAMç®—æ³•ï¼ˆå¯æƒœåœ¨ROS2ä¸­æ²¡æœ‰äº†ï¼Œåªæœ‰ä¸€ä¸ªslam_toolboxï¼Œæ‰€ä»¥æ²¡æ³•æ¼”ç¤ºï¼‰ï¼šhector_mappingä¸gmappingï¼Œhector_mappingåªæ ¹æ®æ¿€å…‰é›·è¾¾æ•°æ®æ¨ç®—ä½ç§»å…³ç³»å¹¶æ‹“å±•åœ°å›¾ï¼Œè€Œgmappingä½¿ç”¨æ¿€å…‰é›·è¾¾æ•°æ®å¯¹é‡Œç¨‹è®¡æ¨ç®—çš„ä½ç§»é‡åšå‡ºä¿®æ­£ï¼Œè¿™ä¸€ç‚¹å¯ä»¥åœ¨tfæ ‘å’Œrviz2ä¸­å¾—åˆ°éªŒè¯<br>ä¸‹è½½rqt_tf_tree:<code>sudo apt install ros-humble-rqt-tf-tree</code><br>hector_mappingä¼šå‘é€mapï¼ˆåœ°å›¾åŸç‚¹ï¼‰ä¸å½“å‰æœºå™¨äººä½ç½®çš„tfå˜æ¢scanmatcher_frame,å¹¶åå‘è¡¥å¿é‡Œç¨‹è®¡è®¡ç®—çš„ä½ç§»é‡ï¼ˆå› ä¸ºé‡Œç¨‹è®¡å·²ç»å‘å¸ƒäº†å‘å¸ƒçš„odomåˆ°base_footprintçš„tfå…³ç³»ï¼Œç›¸å½“äºéœ€è¦æŠµæ¶ˆé‡Œç¨‹è®¡è¾“å‡ºçš„æœºå™¨äººä½ç½®åç§»é‡ï¼‰</p>
<p><img src="/images/ROS2-Learning/hector_rqt.jpeg" alt="hector_rqt"><br><img src="/images/ROS2-Learning/hector_rviz.jpeg" alt="hector_rviz"></p>
<p>gmappingåˆ™ç›´æ¥å‘é€mapåˆ°odomçš„tfå˜æ¢ï¼Œè¿™æ˜¯å¯¹é‡Œç¨‹è®¡æ¨ç®—çš„ä½ç§»é‡çš„ä¿®æ­£</p>
<p><img src="/images/ROS2-Learning/gmapping_rqt.jpeg" alt="gmapping_rqt"><br><img src="/images/ROS2-Learning/gmapping_rviz.jpeg" alt="gmapping_rviz"></p>
<p>ä¸ºä»€ä¹ˆéœ€è¦é‡Œç¨‹è®¡å‘¢ï¼Œå½“æœºå™¨äººè¡Œèµ°åœ¨é•¿ç›´èµ°å»Šä¸­æ—¶ï¼ŒSLAMæ— æ³•ä»é›·è¾¾ä¿¡å·ä¸­æå–ç‰¹å¾ç‚¹ï¼Œå°±å¥½æ¯”äººèµ°åœ¨é•¿ç›´èµ°å»Šä¸­æ—¶æ— æ³•ä»å‘¨å›´ç¯å¢ƒçš„å˜åŒ–æ¨ç®—ä½ç§»ä¿¡æ¯  </p>
<p><img src="/images/ROS2-Learning/long_corridor1.jpeg" alt="long corridor1"><br><img src="/images/ROS2-Learning/long_corridor2.jpeg" alt="long corridor2"></p>
<p>è€Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè½®èƒçš„æ‰“æ»‘æ˜¯ä¸å¯é¿å…çš„ï¼Œæ‰€ä»¥é‡Œç¨‹è®¡æ¨ç®—çš„ä½ç§»ä¿¡æ¯ä¼šå­˜åœ¨è¯¯å·®ï¼Œè€Œä¸”è¿™ä¸€è¯¯å·®ä¼šåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç´¯ç§¯ï¼Œæ‰€ä»¥å¿…é¡»è¦é€šè¿‡SLAMæ¥ä¿®æ­£  </p>
<hr>
<p>ä¹‹å‰æåˆ°äº†MapMetaDataä¸­originçš„å®šä¹‰  </p>
<p><img src="/images/ROS2-Learning/origin_pose.png" alt="origin pose"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œorigin.positionä¸­çš„x,yåˆ†é‡åŸºæœ¬ä¸Šç›¸åŒå¤§å°çš„ï¼Œæ‰€ä»¥è¿™ä¸ªoriginæè¿°çš„æ˜¯åœ°å›¾æœ€å·¦ä¸‹è§’åˆ°mapåæ ‡ç³»åŸç‚¹çš„ä½å§¿å…³ç³»<br>è€Œæœºå™¨äººçš„åˆå§‹ä½ç½®è¢«æè¿°åœ¨odomä¸base_footpointçš„tfå…³ç³»ä¸­ï¼Œé‚£ä¹ˆæœºå™¨äººçš„åˆå§‹ä½ç½®æ˜¯å¦‚ä½•å®šä¹‰çš„å‘¢ï¼Ÿ  </p>
<p><img src="/images/ROS2-Learning/robot_initial_pose.png" alt="robot initial pose"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæœºå™¨äººçš„åˆå§‹ä½ç½®æ˜¯åœ¨launchæ–‡ä»¶ä¸­æè¿°çš„ï¼Œå®ƒæ˜¯slamèŠ‚ç‚¹çš„ä¸€ä¸ªå‚æ•°  </p>
<h2 id="Chapter4ï¼šæœºå™¨äººå»ºæ¨¡ä¸ä»¿çœŸ"><a href="#Chapter4ï¼šæœºå™¨äººå»ºæ¨¡ä¸ä»¿çœŸ" class="headerlink" title="Chapter4ï¼šæœºå™¨äººå»ºæ¨¡ä¸ä»¿çœŸ"></a>Chapter4ï¼šæœºå™¨äººå»ºæ¨¡ä¸ä»¿çœŸ</h2><h3 id="1-æœºå™¨äººç»Ÿä¸€å»ºæ¨¡æ ¼å¼urdf"><a href="#1-æœºå™¨äººç»Ÿä¸€å»ºæ¨¡æ ¼å¼urdf" class="headerlink" title="1. æœºå™¨äººç»Ÿä¸€å»ºæ¨¡æ ¼å¼urdf"></a>1. æœºå™¨äººç»Ÿä¸€å»ºæ¨¡æ ¼å¼urdf</h3><p>urdfä½¿ç”¨XMLæ–‡ä»¶æ ¼å¼æè¿°æœºå™¨äººæ–‡ä»¶ï¼ŒåŸºæœ¬æ ¼å¼ä¸ºï¼š  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">&quot;my_robot&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;link1&quot;</span>&gt;</span>å…·ä½“çš„æè¿°<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;joint1_2&quot;</span>&gt;</span>å…·ä½“çš„æè¿°<span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;link2&quot;</span>&gt;</span>å…·ä½“çš„æè¿°<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœºå™¨äººçš„éƒ¨ä»¶è¢«ç§°ä¸ºlinkï¼Œè€Œlinkå’Œlinkä¹‹é—´çš„è¿æ¥éƒ¨åˆ†ç§°ä¸ºjointï¼Œä¸€ä¸ªä¸¤è½®å·®é€Ÿæ¨¡å‹å¯ä»¥æè¿°ä¸º  </p>
<p><img src="/images/ROS2-Learning/link_and_joint.png" alt="link and joint"></p>
<p>linkçš„æ ‡ç­¾å®šä¹‰ä¸ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">visual</span>&gt;</span> æ˜¾ç¤ºå½¢çŠ¶</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">geometry</span>&gt;</span> (å‡ ä½•å½¢çŠ¶)</span><br><span class="line">    <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;1 1 1&quot;</span> /&gt;</span>  é•¿æ–¹ä½“</span><br><span class="line">    <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">&quot;1&quot;</span> <span class="attr">length</span>=<span class="string">&quot;0.5&quot;</span>/&gt;</span>  åœ†æŸ±ä½“</span><br><span class="line">    <span class="tag">&lt;<span class="name">sphere</span> <span class="attr">radius</span>=<span class="string">&quot;0.015&quot;</span>/&gt;</span>  çƒä½“</span><br><span class="line">    <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">&quot;package://robot_description/meshes/base_link.DAE&quot;</span>/&gt;</span>  ç¬¬ä¸‰æ–¹å¯¼å‡ºçš„æ¨¡å‹æ–‡ä»¶</span><br><span class="line">  <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;0 0 0&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;0 0 0&quot;</span> /&gt;</span>  æè¿°çš„æ˜¯æ˜¾ç¤ºçš„æ¨¡å‹åœ¨è‡ªèº«åæ ‡ç³»ä¸­çš„ä½å§¿</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;white&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;1.0 1.0 1.0 0.5&quot;</span> /&gt;</span> <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">collision</span>&gt;</span> ç¢°æ’å±æ€§</span><br><span class="line"><span class="tag">&lt;<span class="name">inertial</span>&gt;</span> æƒ¯æ€§å‚æ•° è´¨é‡ç­‰</span><br></pre></td></tr></table></figure>

<p>collisionå¯ä»¥åŒ…å«çš„å­æ ‡ç­¾å¦‚ä¸‹ï¼Œè¿™äº›å‚æ•°ä¸€èˆ¬ä¸visualæ ‡ç­¾ä¸‹çš„ä¸€è‡´ï¼š</p>
<ul>
<li>originï¼Œè¡¨ç¤ºç¢°æ’ä½“çš„ä¸­å¿ƒä½å§¿</li>
<li>geometryï¼Œç”¨äºè¡¨ç¤ºç”¨äºç¢°æ’æ£€æµ‹çš„å‡ ä½•å½¢çŠ¶</li>
<li>materialï¼Œå¯é€‰çš„ï¼Œæè¿°ç¢°æ’å‡ ä½•ä½“çš„ææ–™</li>
</ul>
<p>intertialæ ‡ç­¾åŒ…å«çš„å­æ ‡ç­¾å¦‚ä¸‹ï¼Œè½¬åŠ¨æƒ¯é‡çŸ©é˜µçš„è®¡ç®—å¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/3L8Lilesy2W_WY5qup0gmA">æƒ¯æ€§çŸ©é˜µ</a>ï¼š</p>
<ul>
<li>massï¼Œæè¿°linkçš„è´¨é‡</li>
<li>inertiaï¼Œæè¿°linkçš„æ—‹è½¬æƒ¯é‡ï¼ˆè¯¥æ ‡ç­¾æœ‰å…­ä¸ªå±æ€§å€¼ixx\ixy\ixz\iyy\iyz\izzï¼‰</li>
</ul>
<p>æ‘©æ“¦åŠ›ä¿¡æ¯å¯ä»¥ä»¥gazeboè¯­å¥æ·»åŠ åˆ°urdfæ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">&quot;caster_link&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mu1</span> <span class="attr">value</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mu2</span> <span class="attr">value</span>=<span class="string">&quot;0.0&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">kp</span> <span class="attr">value</span>=<span class="string">&quot;1000000.0&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">kd</span> <span class="attr">value</span>=<span class="string">&quot;10.0&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>jointæ ‡ç­¾å®šä¹‰ä¸ºï¼š  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  revolute: æ—‹è½¬å…³èŠ‚ï¼Œç»•å•è½´æ—‹è½¬,è§’åº¦æœ‰ä¸Šä¸‹é™,æ¯”å¦‚èˆµæœº0-180</span><br><span class="line">  continuous: æ—‹è½¬å…³èŠ‚ï¼Œå¯ä»¥ç»•å•è½´æ— é™æ—‹è½¬,æ¯”å¦‚è‡ªè¡Œè½¦çš„å‰åè½®</span><br><span class="line">  fixed: å›ºå®šå…³èŠ‚ï¼Œä¸å…è®¸è¿åŠ¨çš„ç‰¹æ®Šå…³èŠ‚</span><br><span class="line">  prismatic: æ»‘åŠ¨å…³èŠ‚ï¼Œæ²¿æŸä¸€è½´çº¿ç§»åŠ¨çš„å…³èŠ‚ï¼Œæœ‰ä½ç½®æé™</span><br><span class="line">  planer: å¹³é¢å…³èŠ‚ï¼Œå…è®¸åœ¨xyzï¼Œrxryrzå…­ä¸ªæ–¹å‘è¿åŠ¨</span><br><span class="line">  floating: æµ®åŠ¨å…³èŠ‚ï¼Œå…è®¸è¿›è¡Œå¹³ç§»ã€æ—‹è½¬è¿åŠ¨</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;&quot;</span> <span class="attr">rpy</span>=<span class="string">&quot;&quot;</span> /&gt;</span>  å­åæ ‡ç³»åœ¨çˆ¶åæ ‡ç³»ä¸­çš„ä½å§¿</span><br><span class="line">  <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">&quot;&quot;</span> /&gt;</span>           å›´ç»•å­åæ ‡ç³»æ—‹è½¬çš„è½´å‘é‡</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-Gazeboæœºå™¨äººä»¿çœŸ"><a href="#2-Gazeboæœºå™¨äººä»¿çœŸ" class="headerlink" title="2. Gazeboæœºå™¨äººä»¿çœŸ"></a>2. Gazeboæœºå™¨äººä»¿çœŸ</h3><p>å…ˆè¯´ç»“è®ºï¼Œgazebo-rosä¸­çš„å„ä¸ªæ’ä»¶ä¹Ÿæ˜¯ç”¨èŠ‚ç‚¹çš„æ–¹å¼å®ç°çš„ï¼Œæ’ä»¶èŠ‚ç‚¹ä»ä»¿çœŸç¯å¢ƒæˆ–å…¶ä»–èŠ‚ç‚¹ä¸­è®¢é˜…ä¿¡æ¯ï¼Œå¹¶å‘å¸ƒç‰¹å®šçš„æ¶ˆæ¯ï¼ˆå¦‚tfå…³ç³»ï¼Œè½®è½´è¿åŠ¨ä¿¡æ¯ç­‰ï¼‰  </p>
<p>å‡†å¤‡å·¥ä½œï¼š</p>
<ol>
<li>å®‰è£…gazebo-rosï¼š<code>sudo apt install ros-humble-gazebo-ros</code>  </li>
<li>å¯åŠ¨gazeboåŠå…¶æ’ä»¶å¯ä»¥ä½¿ç”¨ï¼š<code>gazebo --verbose -s libgazebo_ros_init.so -s libgazebo_ros_factory.so</code>  </li>
<li>åœ¨&#x2F;ros2_ws&#x2F;srcç›®å½•ä¸‹ï¼š<code>ros2 pkg create fishbot_description --build-type ament_python</code>  </li>
<li>åœ¨&#x2F;src&#x2F;fishbot_descriptionä¸‹åˆ›å»ºlaunchå’Œurdfç›®å½•ï¼š<code>mkdir urdf launch</code></li>
<li>ä¸‹è½½<a target="_blank" rel="noopener" href="https://github.com/fishros/fishbot/blob/navgation2/src/fishbot_description/urdf/fishbot_gazebo.urdf">å®Œæ•´çš„ä¸¤è½®å·®é€Ÿæ¨¡å‹urdfæ–‡ä»¶</a>åˆ°&#x2F;urdf&#x2F;fishbot_gazebo.urdfæ–‡ä»¶ä¸‹</li>
<li>ä¿®æ”¹setup.pyä¸‹çš„data_filesï¼Œå°†urdfå’Œlaunchç›®å½•ä¸‹çš„æ–‡ä»¶ä¸‹è½½åˆ°installç›®å½•ä¸‹</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup</span><br><span class="line"><span class="keyword">from</span> glob <span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">package_name = <span class="string">&#x27;fishbot_description&#x27;</span></span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name=package_name,</span><br><span class="line">    version=<span class="string">&#x27;0.0.0&#x27;</span>,</span><br><span class="line">    packages=[package_name],</span><br><span class="line">    data_files=[</span><br><span class="line">        (<span class="string">&#x27;share/ament_index/resource_index/packages&#x27;</span>,</span><br><span class="line">            [<span class="string">&#x27;resource/&#x27;</span> + package_name]),</span><br><span class="line">        (<span class="string">&#x27;share/&#x27;</span> + package_name, [<span class="string">&#x27;package.xml&#x27;</span>]),</span><br><span class="line">        (os.path.join(<span class="string">&#x27;share&#x27;</span>, package_name, <span class="string">&#x27;launch&#x27;</span>), glob(<span class="string">&#x27;launch/*.launch.py&#x27;</span>)),</span><br><span class="line">        (os.path.join(<span class="string">&#x27;share&#x27;</span>, package_name, <span class="string">&#x27;urdf&#x27;</span>), glob(<span class="string">&#x27;urdf/**&#x27;</span>)),</span><br><span class="line">    ],</span><br><span class="line">    install_requires=[<span class="string">&#x27;setuptools&#x27;</span>],</span><br><span class="line">    zip_safe=<span class="literal">True</span>,</span><br><span class="line">    maintainer=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    maintainer_email=<span class="string">&#x27;root@todo.todo&#x27;</span>,</span><br><span class="line">    description=<span class="string">&#x27;TODO: Package description&#x27;</span>,</span><br><span class="line">    license=<span class="string">&#x27;TODO: License declaration&#x27;</span>,</span><br><span class="line">    tests_require=[<span class="string">&#x27;pytest&#x27;</span>],</span><br><span class="line">    entry_points=&#123;</span><br><span class="line">        <span class="string">&#x27;console_scripts&#x27;</span>: [</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<p>æ¥ä¸‹æ¥ä¸»è¦ä»‹ç»gazeboæ’ä»¶gazebo_ros_diff_drive  </p>
<p>diff_driveèŠ‚ç‚¹é€šè¿‡è½®è·ç­‰å‚æ•°ä¿¡æ¯åŠ <strong>æ§åˆ¶æŒ‡ä»¤cmd_vel</strong> ï¼Œè®¡ç®—ä¸¤è½®çš„ç›®æ ‡è½¬é€Ÿï¼Œ <em>å°†è½®å­çš„ç›®æ ‡è½¬é€Ÿå‘é€ç»™Gazebo</em> ï¼Œå¹¶ä»Gazebo <strong>è·å–å®é™…çš„é€Ÿåº¦å’Œä½ç½®ä¿¡æ¯odom</strong> ï¼Œdiff_driveè¿˜å¯ä»¥å‘å¸ƒodomä»¥åŠè½®è½´çš„tfä¿¡æ¯  </p>
<p><img src="/images/ROS2-Learning/diff_drive.png" alt="diff_drive"></p>
<p>diff_driveçš„é…ç½®å‚æ•°æœ‰ï¼š</p>
<p><img src="/images/ROS2-Learning/diff_drive_paras.png" alt="diff_drive_paras"></p>
<p>ä¸¤è½®å·®é€Ÿçš„å‚æ•°é…ç½®åœ¨urdfæ–‡ä»¶ä¸­å†™ä¸ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gazebo</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">&#x27;diff_drive&#x27;</span> <span class="attr">filename</span>=<span class="string">&#x27;libgazebo_ros_diff_drive.so&#x27;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--nameä¸ºå‘½åç©ºé—´ï¼Œfilenameä¸ºåŠ è½½çš„é…ç½®æ–‡ä»¶å--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ros</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">namespace</span>&gt;</span>/<span class="tag">&lt;/<span class="name">namespace</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">remapping</span>&gt;</span>cmd_vel:=cmd_vel<span class="tag">&lt;/<span class="name">remapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">remapping</span>&gt;</span>odom:=odom<span class="tag">&lt;/<span class="name">remapping</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--é‡æ˜ å°„ï¼Œå°†èŠ‚ç‚¹ç«¯å£ä¸rosè¯é¢˜å¯¹æ¥--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ros</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update_rate</span>&gt;</span>30<span class="tag">&lt;/<span class="name">update_rate</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- wheels --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">left_joint</span>&gt;</span>left_wheel_joint<span class="tag">&lt;/<span class="name">left_joint</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">right_joint</span>&gt;</span>right_wheel_joint<span class="tag">&lt;/<span class="name">right_joint</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- kinematics --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">wheel_separation</span>&gt;</span>0.2<span class="tag">&lt;/<span class="name">wheel_separation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">wheel_diameter</span>&gt;</span>0.065<span class="tag">&lt;/<span class="name">wheel_diameter</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- limits --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_wheel_torque</span>&gt;</span>20<span class="tag">&lt;/<span class="name">max_wheel_torque</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max_wheel_acceleration</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">max_wheel_acceleration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- output --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">publish_odom</span>&gt;</span>true<span class="tag">&lt;/<span class="name">publish_odom</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">publish_odom_tf</span>&gt;</span>true<span class="tag">&lt;/<span class="name">publish_odom_tf</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">publish_wheel_tf</span>&gt;</span>true<span class="tag">&lt;/<span class="name">publish_wheel_tf</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">odometry_frame</span>&gt;</span>odom<span class="tag">&lt;/<span class="name">odometry_frame</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">robot_base_frame</span>&gt;</span>base_footprint<span class="tag">&lt;/<span class="name">robot_base_frame</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>imuæ’ä»¶å’Œæ¿€å…‰é›·è¾¾æ’ä»¶çš„ä½¿ç”¨ä¸ä¸¤è½®å·®é€Ÿç±»ä¼¼ï¼Œå¯ä»¥ç›´æ¥çœ‹æºæ–‡ä»¶ï¼Œæ¥ä¸‹æ¥ç›´æ¥ç¼–å†™&#x2F;launch&#x2F;gazebo.launch.pyæ–‡ä»¶</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> launch <span class="keyword">import</span> LaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch.actions <span class="keyword">import</span> ExecuteProcess</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions <span class="keyword">import</span> Node</span><br><span class="line"><span class="keyword">from</span> launch_ros.substitutions <span class="keyword">import</span> FindPackageShare</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_launch_description</span>():</span><br><span class="line">    robot_name_in_model = <span class="string">&#x27;fishbot&#x27;</span></span><br><span class="line">    package_name = <span class="string">&#x27;fishbot_description&#x27;</span></span><br><span class="line">    urdf_name = <span class="string">&quot;fishbot_gazebo.urdf&quot;</span></span><br><span class="line"></span><br><span class="line">    ld = LaunchDescription()</span><br><span class="line">    pkg_share = FindPackageShare(package=package_name).find(package_name) </span><br><span class="line">    urdf_model_path = os.path.join(pkg_share, <span class="string">f&#x27;urdf/<span class="subst">&#123;urdf_name&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Start Gazebo server</span></span><br><span class="line">    start_gazebo_cmd =  ExecuteProcess(</span><br><span class="line">        cmd=[<span class="string">&#x27;gazebo&#x27;</span>, <span class="string">&#x27;--verbose&#x27;</span>,<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;libgazebo_ros_init.so&#x27;</span>, <span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;libgazebo_ros_factory.so&#x27;</span>],</span><br><span class="line">        output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># gazeboé€šè¿‡/spawn_entity serviceå°†æœºå™¨äººæ¨¡å‹åŠ è½½åˆ°ä»¿çœŸç¯å¢ƒä¸­</span></span><br><span class="line">    spawn_entity_cmd = Node(</span><br><span class="line">        package=<span class="string">&#x27;gazebo_ros&#x27;</span>, </span><br><span class="line">        executable=<span class="string">&#x27;spawn_entity.py&#x27;</span>,</span><br><span class="line">        arguments=[<span class="string">&#x27;-entity&#x27;</span>, robot_name_in_model,  <span class="string">&#x27;-file&#x27;</span>, urdf_model_path ], output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># robot_state_publisherå’Œjoint_state_publisherèŠ‚ç‚¹ä¼šå‘å¸ƒå®Œæ•´çš„æœºå™¨äººtfä¿¡æ¯ï¼Œè¿™æ ·rvizå°±èƒ½è®¢é˜…è¿™äº›ä¿¡æ¯å¹¶å›¾å½¢åŒ–æ˜¾ç¤ºå‡ºæ¥</span></span><br><span class="line">    robot_state_publisher_node = Node(</span><br><span class="line">        package=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">        executable=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">        arguments=[urdf_model_path]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    joint_state_publisher_node = Node(</span><br><span class="line">        package=<span class="string">&#x27;joint_state_publisher&#x27;</span>,</span><br><span class="line">        executable=<span class="string">&#x27;joint_state_publisher&#x27;</span>,</span><br><span class="line">        name=<span class="string">&#x27;joint_state_publisher&#x27;</span>,</span><br><span class="line">        arguments=[urdf_model_path]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    rviz2_node = Node(</span><br><span class="line">        package=<span class="string">&#x27;rviz2&#x27;</span>,</span><br><span class="line">        executable=<span class="string">&#x27;rviz2&#x27;</span>,</span><br><span class="line">        name=<span class="string">&#x27;rviz2&#x27;</span>,</span><br><span class="line">        output=<span class="string">&#x27;screen&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    ld.add_action(start_gazebo_cmd)</span><br><span class="line">    ld.add_action(spawn_entity_cmd)</span><br><span class="line">    ld.add_action(robot_state_publisher_node)</span><br><span class="line">    ld.add_action(joint_state_publisher_node)</span><br><span class="line">    ld.add_action(rviz2_node)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ld</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ¶‰åŠåˆ°launchæ–‡ä»¶ï¼Œæ¨èç¿»é˜…<a target="_blank" rel="noopener" href="https://www.robotsfan.com/posts/7a5950c4.html">fanziqiâ€™s blog</a>  </p>
<h2 id="Chapter5ï¼šnav2å¯¼èˆª"><a href="#Chapter5ï¼šnav2å¯¼èˆª" class="headerlink" title="Chapter5ï¼šnav2å¯¼èˆª"></a>Chapter5ï¼šnav2å¯¼èˆª</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/07/28/ROS2-Learning/" data-id="clz6ow4890000x0k3hr7p4voq" data-title="ROS2_Learning" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/07/28/hello-world/" class="article-date">
  <time class="dt-published" datetime="2024-07-27T21:21:46.581Z" itemprop="datePublished">2024-07-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/07/28/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/07/28/hello-world/" data-id="clz4n4oz20000ikk3760tcfqh" data-title="Hello World" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/09/08/Reinforcement-Learning/">Reinforcement Learning</a>
          </li>
        
          <li>
            <a href="/2024/09/02/Multi-Agents/">Multi Agents</a>
          </li>
        
          <li>
            <a href="/2024/07/28/ROS2-Learning/">ROS2_Learning</a>
          </li>
        
          <li>
            <a href="/2024/07/28/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>