<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Multi Agents | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="此博客与我的团队项目“多机对抗”同步   Chapter1：在gazebo中独立操纵多台机器人1. 在gazebo中加载两台机器人最简单的想法是直接在gazebo中加载两台机器人，再通过发布 不同的速度控制话题 分别控制这两台机器人，这里，我自定义了一个simp_four_wheel.urdf文件，你也可以使用两轮差速模型。不清楚如何编写urdf文件的可以翻阅我的博客：ROS2-Learning&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="Multi Agents">
<meta property="og:url" content="http://example.com/2024/09/02/Multi-Agents/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="此博客与我的团队项目“多机对抗”同步   Chapter1：在gazebo中独立操纵多台机器人1. 在gazebo中加载两台机器人最简单的想法是直接在gazebo中加载两台机器人，再通过发布 不同的速度控制话题 分别控制这两台机器人，这里，我自定义了一个simp_four_wheel.urdf文件，你也可以使用两轮差速模型。不清楚如何编写urdf文件的可以翻阅我的博客：ROS2-Learning&amp;">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/Multi-Agents/two_robots.png">
<meta property="og:image" content="http://example.com/images/Multi-Agents/failure_ns.png">
<meta property="og:image" content="http://example.com/images/Multi-Agents/valid_two_robots.png">
<meta property="og:image" content="http://example.com/images/Multi-Agents/FRC_field1.png">
<meta property="og:image" content="http://example.com/images/Multi-Agents/FRC_field2.png">
<meta property="og:image" content="http://example.com/images/Multi-Agents/scoring_rules.png">
<meta property="og:image" content="http://example.com/images/Multi-Agents/FRCThree_env.png">
<meta property="og:image" content="http://example.com/images/Multi-Agents/m_FRC_field.jpg">
<meta property="og:image" content="http://example.com/images/Multi-Agents/BlueAgent.jpg">
<meta property="og:image" content="http://example.com/images/Multi-Agents/AMPBlue.jpg">
<meta property="og:image" content="http://example.com/images/Multi-Agents/500000Training.png">
<meta property="article:published_time" content="2024-09-02T05:51:46.000Z">
<meta property="article:modified_time" content="2025-03-10T05:37:28.651Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/Multi-Agents/two_robots.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Multi-Agents" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/09/02/Multi-Agents/" class="article-date">
  <time class="dt-published" datetime="2024-09-02T05:51:46.000Z" itemprop="datePublished">2024-09-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Multi Agents
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>此博客与我的团队项目“多机对抗”同步  </p>
<h2 id="Chapter1：在gazebo中独立操纵多台机器人"><a href="#Chapter1：在gazebo中独立操纵多台机器人" class="headerlink" title="Chapter1：在gazebo中独立操纵多台机器人"></a>Chapter1：在gazebo中独立操纵多台机器人</h2><h3 id="1-在gazebo中加载两台机器人"><a href="#1-在gazebo中加载两台机器人" class="headerlink" title="1. 在gazebo中加载两台机器人"></a>1. 在gazebo中加载两台机器人</h3><p>最简单的想法是直接在gazebo中加载两台机器人，再通过发布 <em>不同的速度控制话题</em> 分别控制这两台机器人，这里，我自定义了一个simp_four_wheel.urdf文件，你也可以使用<a target="_blank" rel="noopener" href="https://github.com/fishros/fishbot/blob/navgation2/src/fishbot_description/urdf/fishbot_gazebo.urdf">两轮差速模型</a>。不清楚如何编写urdf文件的可以翻阅我的博客：<strong>ROS2-Learning&#x2F;Chapter 4</strong>  </p>
<hr>
<p>小插曲，gazebo保存地图文件有两种格式，一种是直接创建好地图并直接Save，地图会被保存为sdf文件+config文件组成的一个文件夹，这个sdf地图文件无法通过命令行（launch文件）启动，而是在gazebo中点击Insert添加<br>如果想要通过launch文件启动地图文件，你需要将gazebo文件<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45084787/article/details/136536598">另存为.world文件</a></p>
<hr>
<p>接下来编写launch文件，直接翻倍spawn_entity节点：  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Start Gazebo server</span></span><br><span class="line">start_gazebo_cmd =  ExecuteProcess(</span><br><span class="line">    cmd=[<span class="string">&#x27;gazebo&#x27;</span>, <span class="string">&#x27;--verbose&#x27;</span>,<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;libgazebo_ros_init.so&#x27;</span>, <span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;libgazebo_ros_factory.so&#x27;</span>, gazebo_world_path],</span><br><span class="line">    output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Launch the robot</span></span><br><span class="line">spawn_entity_1_cmd = Node(</span><br><span class="line">    package=<span class="string">&#x27;gazebo_ros&#x27;</span>, </span><br><span class="line">    executable=<span class="string">&#x27;spawn_entity.py&#x27;</span>,</span><br><span class="line">    name=<span class="string">&#x27;spawn_entity_1&#x27;</span>,</span><br><span class="line">    arguments=[<span class="string">&#x27;-entity&#x27;</span>, <span class="string">&#x27;robot1&#x27;</span>,  <span class="string">&#x27;-file&#x27;</span>, urdf_model_path ,<span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;-5&#x27;</span>], output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line"></span><br><span class="line">spawn_entity_2_cmd = Node(</span><br><span class="line">    package=<span class="string">&#x27;gazebo_ros&#x27;</span>, </span><br><span class="line">    executable=<span class="string">&#x27;spawn_entity.py&#x27;</span>,</span><br><span class="line">    name=<span class="string">&#x27;spawn_entity_2&#x27;</span>,</span><br><span class="line">    arguments=[<span class="string">&#x27;-entity&#x27;</span>, <span class="string">&#x27;robot2&#x27;</span>,  <span class="string">&#x27;-file&#x27;</span>, urdf_model_path ,<span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;-Y&#x27;</span>, <span class="string">&#x27;3.14&#x27;</span>], output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rqt_steering_cmd = Node(</span><br><span class="line">    package=<span class="string">&#x27;rqt_robot_steering&#x27;</span>, </span><br><span class="line">    executable=<span class="string">&#x27;rqt_robot_steering&#x27;</span>,</span><br><span class="line">    output=<span class="string">&#x27;screen&#x27;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><img src="/images/Multi-Agents/two_robots.png" alt="two_robots"></p>
<p>现在使用rqt_robot_steering，可以看到两辆小车同时运动，这是由于这两辆小车是通过同一个urdf文件加载的，而在对应的urdf文件中：  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gazebo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">&quot;four_wheels_controller&quot;</span> <span class="attr">filename</span>=<span class="string">&quot;libgazebo_ros_diff_drive.so&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ros</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">namespace</span>&gt;</span>/<span class="tag">&lt;/<span class="name">namespace</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remapping</span>&gt;</span>cmd_vel:=cmd_vel<span class="tag">&lt;/<span class="name">remapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remapping</span>&gt;</span>odom:=odom<span class="tag">&lt;/<span class="name">remapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ros</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>两辆小车通过diff_drive插件，订阅到的cmd_vel主题是相同的，所以无法分别控制<br>解决方案是再写一个urdf文件，并将它的diff_drive插件订阅的cmd_vel话题map到一个其他的名称，如</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gazebo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">&quot;four_wheels_controller&quot;</span> <span class="attr">filename</span>=<span class="string">&quot;libgazebo_ros_diff_drive.so&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ros</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">namespace</span>&gt;</span>/robot2<span class="tag">&lt;/<span class="name">namespace</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remapping</span>&gt;</span>cmd_vel:=/robot2/cmd_vel<span class="tag">&lt;/<span class="name">remapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remapping</span>&gt;</span>odom:=/robot2/odom<span class="tag">&lt;/<span class="name">remapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ros</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-尝试使用节点参数namespace：失败"><a href="#2-尝试使用节点参数namespace：失败" class="headerlink" title="2. 尝试使用节点参数namespace：失败"></a>2. 尝试使用节点参数namespace：失败</h3><p>在刚才的解决方案中，有两个问题：</p>
<ol>
<li>两个节点的link&#x2F;joint名称是完全相同的，使用robot_state_publisher发布时两个机器人的消息会混淆，导致rviz会认为这个环境中只有一个机器人，但它同时存在于当前世界下的两个位置，在rviz中的体现是机器人不停地在两个位置之间闪烁，如果希望rviz可以区分这两个机器人，那么你对应机器人的urdf文件的所有link&#x2F;joint的名称都要做出区分</li>
<li>如果需要加载更多机器人，只能编写更多的urdf文件，每个机器人的文件的架构是一样的，但机器人的所有名称都要做修改，极其繁琐</li>
</ol>
<p>我最初的想法是使用robot_state_publisher等节点的namespace参数，从逻辑上来讲namespace参数会影响spawn_entity与robot_state_publisher发布的关于机器人的所有消息，包括link&#x2F;joint与插件的输入输出接口，都加上对应的命名空间，但实际操作后：  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Start Gazebo server</span></span><br><span class="line">start_gazebo_cmd =  ExecuteProcess(</span><br><span class="line">    cmd=[<span class="string">&#x27;gazebo&#x27;</span>, <span class="string">&#x27;--verbose&#x27;</span>,<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;libgazebo_ros_init.so&#x27;</span>, <span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;libgazebo_ros_factory.so&#x27;</span>, gazebo_world_path],</span><br><span class="line">    output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Launch the robot</span></span><br><span class="line">spawn_entity_1_cmd = Node(</span><br><span class="line">    package=<span class="string">&#x27;gazebo_ros&#x27;</span>, </span><br><span class="line">    executable=<span class="string">&#x27;spawn_entity.py&#x27;</span>,</span><br><span class="line">    name=<span class="string">&#x27;spawn_entity_1&#x27;</span>,</span><br><span class="line">    namespace=<span class="string">&#x27;robot1&#x27;</span>,</span><br><span class="line">    arguments=[<span class="string">&#x27;-entity&#x27;</span>, <span class="string">&#x27;robot1&#x27;</span>,  <span class="string">&#x27;-file&#x27;</span>, urdf_model_path ,<span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;-5&#x27;</span>], output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line"></span><br><span class="line">spawn_entity_2_cmd = Node(</span><br><span class="line">    package=<span class="string">&#x27;gazebo_ros&#x27;</span>, </span><br><span class="line">    executable=<span class="string">&#x27;spawn_entity.py&#x27;</span>,</span><br><span class="line">    name=<span class="string">&#x27;spawn_entity_2&#x27;</span>,</span><br><span class="line">    namespace=<span class="string">&#x27;robot2&#x27;</span>,</span><br><span class="line">    arguments=[<span class="string">&#x27;-entity&#x27;</span>, <span class="string">&#x27;robot2&#x27;</span>,  <span class="string">&#x27;-file&#x27;</span>, urdf_model_path ,<span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;-Y&#x27;</span>, <span class="string">&#x27;3.14&#x27;</span>], output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rqt_steering_cmd = Node(</span><br><span class="line">    package=<span class="string">&#x27;rqt_robot_steering&#x27;</span>, </span><br><span class="line">    executable=<span class="string">&#x27;rqt_robot_steering&#x27;</span>,</span><br><span class="line">    output=<span class="string">&#x27;screen&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">robot_state_publisher1_node = Node(</span><br><span class="line">    package=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">    executable=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">    name=<span class="string">&#x27;robot_state_publisher1&#x27;</span>,</span><br><span class="line">    namespace=<span class="string">&#x27;robot1&#x27;</span>,</span><br><span class="line">    arguments=[urdf_model_path],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">joint_state_publisher1_node = Node(</span><br><span class="line">    package=<span class="string">&#x27;joint_state_publisher&#x27;</span>,</span><br><span class="line">    executable=<span class="string">&#x27;joint_state_publisher&#x27;</span>,</span><br><span class="line">    name=<span class="string">&#x27;joint_state_publisher1&#x27;</span>,</span><br><span class="line">    namespace=<span class="string">&#x27;robot1&#x27;</span>,</span><br><span class="line">    arguments=[urdf_model_path],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">rviz2_node = Node(</span><br><span class="line">    package=<span class="string">&#x27;rviz2&#x27;</span>,</span><br><span class="line">    executable=<span class="string">&#x27;rviz2&#x27;</span>,</span><br><span class="line">    name=<span class="string">&#x27;rviz2&#x27;</span>,</span><br><span class="line">    output=<span class="string">&#x27;screen&#x27;</span>,</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p><img src="/images/Multi-Agents/failure_ns.png" alt="failure_ns"></p>
<p>frame名称和cmd_vel依旧没有命名空间前缀，但robot_state_publisher发布的joint_states和robot_description拥有命名空间，我的判断是spawn_entity节点接收namespace后无法为urdf文件中的插件节点加上命名空间前缀  </p>
<h3 id="3-xacro文件的使用"><a href="#3-xacro文件的使用" class="headerlink" title="3. xacro文件的使用"></a>3. xacro文件的使用</h3><hr>
<p>在这一部分，我参考了<a target="_blank" rel="noopener" href="https://robotics.snowcron.com/robotics_ros2/dif_drive_xacro.htm">snowcron</a>并对其<a target="_blank" rel="noopener" href="https://robotics.snowcron.com/robotics_ros2/multi_bot_03_intro.htm">源码</a>进行了分割</p>
<hr>
<p>urdf（xml）文件无法使用参数，变量等抽象化的术式，这也导致我们无法向urdf文件传入参数（如robot_name&#x3D;’robot1’）来去修改urdf文件<br>xacro文件是xml macro。xacro实用程序运行所有宏并输出结果，生成单个文件，其方式类似于预处理器对包含文件和宏执行的操作，通过xacro文件，我们可以传递参数，定义变量，从而对urdf代码进行分块，并 <strong>实时生成</strong> 符合我们要求的urdf文件  </p>
<p>使xacro文件有意义的文件头：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">&quot;http://www.ros.org/wiki/xacro&quot;</span> <span class="attr">name</span>=<span class="string">&quot;bot&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- all other stuff --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>定义变量并使用：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;wheel_radius&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.04&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;wheel_length&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;wheel_color_name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;red&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">&quot;wheel_color_rgb&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1 0 0 1&quot;</span> /&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!--允许四则运算和括号--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;$&#123;wheel_name&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">visual</span>&gt;</span><span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">&quot;$&#123;wheeldiam/2&#125;&quot;</span> <span class="attr">length</span>=<span class="string">&quot;0.1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">&quot;$&#123;reflect*(width+.02)&#125; 0 0.25&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>定义一个宏并使用：  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">&quot;wheel&quot;</span> <span class="attr">params</span>=<span class="string">&quot;wheel_name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;$&#123;wheel_name&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">&quot;$&#123;wheel_radius&#125;&quot;</span> <span class="attr">length</span>=<span class="string">&quot;$&#123;wheel_length&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;$&#123;wheel_color_name&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;$&#123;wheel_color_rgb&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">xacro:wheel</span> <span class="attr">wheel_name</span>=<span class="string">&quot;right_wheel_frontside&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>声明参数与其默认值：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">&quot;http://www.ros.org/wiki/xacro&quot;</span> <span class="attr">name</span>=<span class="string">&quot;multi_bot_03&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:arg</span> <span class="attr">name</span>=<span class="string">&quot;namespace&quot;</span> <span class="attr">default</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:arg</span> <span class="attr">name</span>=<span class="string">&quot;robot_material_name&quot;</span> <span class="attr">default</span>=<span class="string">&quot;Green&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:arg</span> <span class="attr">name</span>=<span class="string">&quot;robot_material_color_rgb&quot;</span> <span class="attr">default</span>=<span class="string">&quot;0 1 0 1&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(find multi_bot_03)/description/xacro/inertial_macros.xacro&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(find multi_bot_03)/description/xacro/lidar.xacro&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(find multi_bot_03)/description/xacro/camera.xacro&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(find multi_bot_03)/description/xacro/imu_sensor.xacro&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(find multi_bot_03)/description/xacro/gazebo_control.xacro&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">&quot;$(find multi_bot_03)/description/xacro/robot_core.xacro&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在robot_core.xacro中使用这些参数，这里使用了$(arg namespace)：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">&quot;http://www.ros.org/wiki/xacro&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">&quot;box_link&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">params</span>=<span class="string">&quot;name size color color_rgb mass mass_x mass_y mass_z&quot;</span> &gt;</span></span><br><span class="line">        </span><br><span class="line">        # Here we use the &quot;namespace&quot; as a prefix</span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;$(arg namespace)/$&#123;name&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">&quot;$&#123;size&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">&quot;$&#123;color&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">&quot;$&#123;color_rgb&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过launch.py文件向xacro文件传递参数：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">robot_description_config = xacro.process_file(</span><br><span class="line">def_urdf,</span><br><span class="line">    mappings=&#123;</span><br><span class="line">        <span class="comment"># &quot;robot_name&quot;: robot[&#x27;name&#x27;],</span></span><br><span class="line">        <span class="string">&quot;namespace&quot;</span>: namespace,</span><br><span class="line">        <span class="string">&quot;robot_material_name&quot;</span>: robot[<span class="string">&#x27;color_name&#x27;</span>],</span><br><span class="line">        <span class="string">&quot;robot_material_color_rgb&quot;</span>: robot[<span class="string">&#x27;color_rgb&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>通过在xacro文件中每一个link&#x2F;joint&#x2F;插件端口加上$(arg namespace)前缀，并向xacro文件传递参数，我们可以试试生成我们需要的拥有命名空间的机器人urdf文件，我们将它写在launch文件的 <strong>for循环</strong> 中以加载多个机器人  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> robot <span class="keyword">in</span> robots:</span><br><span class="line">    <span class="comment"># Ex.: /robot1</span></span><br><span class="line">    namespace = <span class="string">&quot;/&quot;</span> + robot[<span class="string">&#x27;name&#x27;</span>] <span class="keyword">if</span> robot[<span class="string">&#x27;name&#x27;</span>] != <span class="string">&quot;&quot;</span> <span class="keyword">else</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    robot_description_config = xacro.process_file(</span><br><span class="line">        path_to_urdf_xacro,</span><br><span class="line">        mappings=&#123;</span><br><span class="line">            <span class="string">&quot;namespace&quot;</span>: namespace,</span><br><span class="line">            <span class="string">&quot;robot_material_name&quot;</span>: robot[<span class="string">&#x27;color_name&#x27;</span>],</span><br><span class="line">            <span class="string">&quot;robot_material_color_rgb&quot;</span>: robot[<span class="string">&#x27;color_rgb&#x27;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># robot_description_config 是你实时生成的机器人urdf文件</span></span><br><span class="line">    params = &#123;<span class="string">&#x27;robot_description&#x27;</span>: robot_description_config.toxml(), </span><br><span class="line">        <span class="string">&#x27;use_sim_time&#x27;</span>: <span class="literal">True</span>&#125; <span class="comment"># 这里一定要使用simulation time</span></span><br><span class="line"></span><br><span class="line">    start_robot_state_publisher_cmd = Node(</span><br><span class="line">        package=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">        executable=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">        name=<span class="string">&#x27;robot_state_publisher&#x27;</span>,</span><br><span class="line">        namespace=namespace,</span><br><span class="line">        output=<span class="string">&#x27;screen&#x27;</span>,</span><br><span class="line">        parameters=[params]</span><br><span class="line">    )    </span><br><span class="line">    arrNodes.append(start_robot_state_publisher_cmd)</span><br><span class="line">                                 </span><br><span class="line">    spawn_entity_cmd = Node(package=<span class="string">&#x27;gazebo_ros&#x27;</span>, executable=<span class="string">&#x27;spawn_entity.py&#x27;</span>,</span><br><span class="line">        namespace=namespace,</span><br><span class="line">        arguments=[</span><br><span class="line">            <span class="string">&quot;-topic&quot;</span>, namespace + <span class="string">&quot;/robot_description&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;-entity&#x27;</span>, robot[<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;-robot_namespace&#x27;</span>, robot[<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;-x&#x27;</span>, <span class="built_in">str</span>(robot[<span class="string">&#x27;x_pos&#x27;</span>]),</span><br><span class="line">            <span class="string">&#x27;-y&#x27;</span>, <span class="built_in">str</span>(robot[<span class="string">&#x27;y_pos&#x27;</span>]),</span><br><span class="line">            <span class="string">&#x27;-z&#x27;</span>, <span class="built_in">str</span>(robot[<span class="string">&#x27;z_pos&#x27;</span>]),             </span><br><span class="line">        ],</span><br><span class="line">        parameters=[&#123;<span class="string">&#x27;use_sim_time&#x27;</span>: use_sim_time&#125;],</span><br><span class="line">        output=<span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line">    arrNodes.append(spawn_entity_cmd)</span><br><span class="line"></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>现在可以分别控制两个机器人，并在rviz中正确显示了（每个机器人的link&#x2F;joint&#x2F;robot_description&#x2F;控制接口都具有命名空间前缀）<br><img src="/images/Multi-Agents/valid_two_robots.png" alt="valid_two_robots"></p>
<hr>
<p>注意这一行：<code>params = &#123;&#39;robot_description&#39;: robot_description_config.toxml(), &#39;use_sim_time&#39;: True&#125;</code><br>如果不设置’use_sim_time’（默认为false），gazebo插件会默认使用系统时间，并根据自己的timer发布数据，在多个插件存在时这会导致不同插件发布消息的时间不一致。<br>在rviz中的体现是“no transform from front_left_wheel to odom”报错，无法显示机器人的四个轮子，我的理解是不使用simulation time导致joint_state_publisher发布的轮轴的tf关系与robot_state_publisher发布的其他关节的tf信息没有对其，导致robot_description不完整（缺少轮轴的tf关系）  </p>
<h2 id="Chapter2：Unity与ML-agents"><a href="#Chapter2：Unity与ML-agents" class="headerlink" title="Chapter2：Unity与ML-agents"></a>Chapter2：Unity与ML-agents</h2><h3 id="下载与环境配置"><a href="#下载与环境配置" class="headerlink" title="- 下载与环境配置"></a>- 下载与环境配置</h3><p>Date:2024&#x2F;9&#x2F;23，在写这篇博客的时候，<a target="_blank" rel="noopener" href="https://github.com/Unity-Technologies/ml-agents/blob/develop/docs/Installation.md">ML-agents github</a>忽然更新到了branch-21，ml-agents&#x3D;&#x3D;1.0.0。<br>最新版本的下载教程所提供的环境是正确的，不需要重新配置环境，可以直接使用，不过ml-agents1.0使用的Unity包是预发行的非稳定版本；branch-20，ml-agents&#x3D;&#x3D;0.30.0的环境错误很多，不过使用的Unity包都是长期稳定版本。<br>首先在官网下载<a target="_blank" rel="noopener" href="https://unity.com/cn/download">UnityHub</a>，<a target="_blank" rel="noopener" href="https://www.anaconda.com/download">anaconda</a>，使用C#还需要下载<a target="_blank" rel="noopener" href="https://dotnet.microsoft.com/en-us/download">.NET SDK</a><br>目前建议直接 <strong>下载最新版本</strong>，在<a target="_blank" rel="noopener" href="https://github.com/Unity-Technologies/ml-agents/blob/develop/docs/Installation.md">ML-agents github</a>跟着教程直接下载<br><em>下面是ml-agents&#x3D;&#x3D;0.30.0的环境配置</em>：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#create a new environment</span><br><span class="line">conda create -n unity_rl python=3.10.0 &amp;&amp; conda activate mlagents</span><br><span class="line">#install ml-agents clones for models and projects</span><br><span class="line">git clone --branch release_20 https://github.com/Unity-Technologies/ml-agents.git</span><br><span class="line">#install ml-agents</span><br><span class="line">python -m pip install mlagents==0.30.0</span><br><span class="line">#need to Downgrade protobuf</span><br><span class="line">pip uninstall protobuf</span><br><span class="line">pip install protobuf==3.20.0</span><br><span class="line">#you might need to install six</span><br><span class="line">pip install six</span><br><span class="line">#default torch installation is not cannot compute for RTX3060(sm86)</span><br><span class="line">pip uninstall torch</span><br><span class="line">conda install pytorch==1.11.0 torchvision==0.12.0 torchaudio==0.11.0 cudatoolkit=11.3 -c pytorch</span><br><span class="line"># numpy&#x27; has no attribute &#x27;float&#x27;. `np.float` was a deprecated alias for the builtin `float` ...</span><br><span class="line">cd path-to-buffer.py &amp; change line210 np.float to float</span><br><span class="line"># Could not infer dtype of numpy.float32&quot; When trying to learn ml-agents</span><br><span class="line">pip uninstall numpy</span><br><span class="line">pip install numpy==1.22.0</span><br><span class="line"># this will raise an error &#x27;mlagents-envs requires numpy==1.21.2&#x27;, just ignore it</span><br></pre></td></tr></table></figure>

<p><a href="https://'earn.unity.com/tutorial/install-unity-software">Unity基本使用</a><br>跟随<a target="_blank" rel="noopener" href="https://github.com/Unity-Technologies/ml-agents/blob/develop/docs/Getting-Started.md">官方教程</a>创建代理环境并训练mlagents</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ml-agents</span><br><span class="line">mlagents-learn config/ppo/3DBall.yaml --run-id=first3DBallRun</span><br></pre></td></tr></table></figure>

<h3 id="复用SoccerTwo环境"><a href="#复用SoccerTwo环境" class="headerlink" title="- 复用SoccerTwo环境"></a>- 复用SoccerTwo环境</h3><ol>
<li>在UnityHub中New Project新建一个项目，将Editor Version改为2023.2.13f1</li>
<li>复制ml-agents&#x2F;Project&#x2F;ML-Agents&#x2F;Examples&#x2F;Soccer文件夹到新建项目的Assets文件夹下</li>
<li>将新建项目的Packages文件夹替换为ml-agents&#x2F;Project&#x2F;Packages文件夹</li>
<li>复制com.unity.ml-agents,com.unity.ml-agents.extensions,ml-agents-trainer-plugin文件夹到你项目的同级目录</li>
<li>在UnityHub下运行你的项目文件</li>
</ol>
<h3 id="ML-Agents代码解析"><a href="#ML-Agents代码解析" class="headerlink" title="- ML-Agents代码解析"></a>- ML-Agents代码解析</h3><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Packages/com.unity.ml-agents@3.0/api/index.html">官方API库</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/tianjuewudi/article/details/121115480">SoccerTwo代码解析</a></p>
<h2 id="Chapter3：FRC-Three-simple"><a href="#Chapter3：FRC-Three-simple" class="headerlink" title="Chapter3：FRC Three simple"></a>Chapter3：FRC Three simple</h2><h3 id="FRC比赛规则"><a href="#FRC比赛规则" class="headerlink" title="- FRC比赛规则"></a>- FRC比赛规则</h3><p><img src="/images/Multi-Agents/FRC_field1.png" alt="FRC field1"><br><img src="/images/Multi-Agents/FRC_field2.png" alt="FRC field2"></p>
<ol>
<li>场景内允许两只队伍，每队三个机器人在场地内比赛，机器人通过将NOTE投入到 <em>己方场地内的</em> Speaker中以得分</li>
<li>比赛前15秒，机器人处于自动阶段，按照预先设定的程序得分；在剩下的2分15秒内，操作手控制自己的机器人。机器人从Source处收集来NOTEs，并送入Speaker和AMP中得分。每当一个队伍在其AMP中积累2个音符，操作者可以决定激活 <em>放大状态</em> 的时间。在放大状态的10秒内投入Speaker可以获得更高得分</li>
<li>如果双方队伍都在手动阶段的前45秒内按下 <em>合作竞争按钮</em> 重新利用一个音符（将投入AMP的NOTE取出用于得分），那么比赛中的所有队伍都会获得1个合作竞争分（这会影响他们在比赛中的排名），同时旋律奖励（一种得分成就，当一个队伍在扩音器和扬声器中积累了一定数量的音符时，可以获得额外的分数）所需的音符数量也会减少</li>
<li>机器人被允许跨过半场以干扰对手的得分（如争夺对方的NOTE，迫使对方犯规等），并可以与对手发生接触（但接触时间需要小于5秒）</li>
</ol>
<p><img src="/images/Multi-Agents/scoring_rules.png" alt="scoring rules"></p>
<h3 id="FRC公开论坛、咨询与仿真"><a href="#FRC公开论坛、咨询与仿真" class="headerlink" title="- FRC公开论坛、咨询与仿真"></a>- FRC公开论坛、咨询与仿真</h3><p><a target="_blank" rel="noopener" href="https://www.chiefdelphi.com/c/first/open-alliance/89">开源的FRC联盟</a><br>比赛录像可以从youtube上直接搜索FRC event review<br><a target="_blank" rel="noopener" href="https://mostudios.itch.io/mosimulator">MoSimulator</a>使用Unity制作了FRC游戏模拟<br><a target="_blank" rel="noopener" href="https://www.chiefdelphi.com/t/6328s-advance-swerve-drive-example-with-more-enhanced-physics-simulation-collision-detection-and-more/470626/3">Maple-Swerve-Skeleton</a>集成了碰撞模拟，驾驶模拟，游戏道具模拟，<strong>里程计模拟（打滑）</strong> 与 <strong>视觉模拟</strong></p>
<h3 id="my-AgentFRC-simple"><a href="#my-AgentFRC-simple" class="headerlink" title="- my AgentFRC simple"></a>- my AgentFRC simple</h3><p>Enviroment Design：基于官方文档SoccerTwo环境做出修改。删除场景内的足球，将代理数添加至3v3，仿照FRC比赛场地添加AMP(blue and purple)与Source(yellow)，直接将BlueGoal和PurpleGoal球门视为蓝队和紫队的Speaker。</p>
<p><img src="/images/Multi-Agents/FRCThree_env.png" alt="FRCThree env"></p>
<p>Game Design：代理的动作空间仍为3*discrete(前后、左右、水平转动共三维)，代理通过与Source接触获得Notes，并通过与AMP或Speaker接触将Note投入并得分（得分计入各队的 <strong>GroupReward</strong>）。得分规则与GameManual一致：携带Note的代理与己方的AMP接触时团队得分+1，AMP中储存的Note+1，当AMP中已经存储了两个Note并再次与己方的代理接触时，触发<strong>放大时间</strong> （注意在FRC比赛中放大时间是由操作手决定的，可以在任意时间触发，这里通过代理再次触碰的方式实现代理自主决定何时触发放大时间）；携带Note的代理与己方的Speaker接触时团队得分+2，在放大时间内得分+5</p>
<p>Module Introduction：</p>
<p>Unity中C#脚本文件下声明为public的变量会显示在UI窗口中，可以通过将Hierarchy窗口下的物体拖动到对应的方框下实现变量赋值</p>
<ul>
<li>FRC_field<br><img src="/images/Multi-Agents/m_FRC_field.jpg" alt="my FRC field"><br>FRCEnvController文件注册了环境中的所有6个代理，用以更新环境计时器并在游戏重新开始时重置代理位置。BlueScore和PurpleScore是我创建的计分板</li>
<li>BlueAgent<br><img src="/images/Multi-Agents/BlueAgent.jpg" alt="BlueAgent"><br>BehaviourParameters文件是ML-Agents的库文件，它定义了网络的观测空间（输入端）与动作空间（输出端）。VectorObservation下的Space Size需要与对应代理脚本文件中定义的CollectObservation()下的addObservation数目一致，RaySensor等传感器文件获得的观测空间不计入Space Size。注意Behaviour Name需要与trainingconfig.yaml文件中的名称保持一致才能训练</li>
<li>AMPBlue<br><img src="/images/Multi-Agents/AMPBlue.jpg" alt="AMPBlue"><br>AMPController类内储存了FRCEnv，因为FRCEnv注册了环境中的6个代理，现在AMPController可以通过FRCEnv为代理添加GroupReward<br>AMP的Collider文件下勾选了IsTrigger，现在AMP不会参与物理碰撞（可以直接穿过），含有RigidBody的物体 <em>发生移动</em> 并进入AMP内部，会触发OnTriggerEnter函数，通过这种逻辑判断代理与AMP发生接触</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/HenryLiuOZ/FRCThree">Code Implementation</a>：包含了我的Script文件，训练好的网络与视频演示</p>
<p><img src="/images/Multi-Agents/500000Training.png" alt="500000Training"></p>
<h2 id="Chapter4：Mosimulator-FRCThree"><a href="#Chapter4：Mosimulator-FRCThree" class="headerlink" title="Chapter4：Mosimulator FRCThree"></a>Chapter4：Mosimulator FRCThree</h2><h3 id="task-definition"><a href="#task-definition" class="headerlink" title="- task definition"></a>- task definition</h3><h3 id="results"><a href="#results" class="headerlink" title="- results"></a>- results</h3><p><a target="_blank" rel="noopener" href="https://github.com/HenryLiuOZ/MoSimFRC_ML">github repository</a><br><a target="_blank" rel="noopener" href="https://github.com/HenryLiuOZ/FRCVideos">videos</a>can be found here.<br>在无任何引导（使用了curiosity）的情况下，FRCThree包括FRCOne的训练速度是缓慢的，在大约120万个训练步数后才能学会基本的shoot-&gt;intake notes的循环并尽可能清空己方场地的notes。由于amp动作较为复杂且基础得分是shoot的一半(只有alliance source内部达到2个notes时，之后的10秒内，成功的note shoot会得到额外的三分分值)，环境代理几乎不会做出amp的动作。<br>从tensorboard上看，无指导的FRCThree训练大约在200万步遇到瓶颈，几乎不再上升，但此时单episode的平均得分大约是35，除去白送的15分，可以说提升空间还是很大的。但显然代理陷入了局部最优解。</p>
<h3 id="further-works"><a href="#further-works" class="headerlink" title="- further works"></a>- further works</h3><h2 id="Chapter5：MALiR-——-Multi-Agent-LLM-instructed-Reinforcement-Learning"><a href="#Chapter5：MALiR-——-Multi-Agent-LLM-instructed-Reinforcement-Learning" class="headerlink" title="Chapter5：MALiR —— Multi-Agent LLM instructed Reinforcement Learning"></a>Chapter5：MALiR —— Multi-Agent LLM instructed Reinforcement Learning</h2><h3 id="method"><a href="#method" class="headerlink" title="- method"></a>- method</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/09/02/Multi-Agents/" data-id="cm0ku4u150000x4k3fj0j90ug" data-title="Multi Agents" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2024/09/08/Reinforcement-Learning/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Reinforcement Learning
        
      </div>
    </a>
  
  
    <a href="/2024/07/28/ROS2-Learning/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">ROS2_Learning</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/09/08/Reinforcement-Learning/">Reinforcement Learning</a>
          </li>
        
          <li>
            <a href="/2024/09/02/Multi-Agents/">Multi Agents</a>
          </li>
        
          <li>
            <a href="/2024/07/28/ROS2-Learning/">ROS2_Learning</a>
          </li>
        
          <li>
            <a href="/2024/07/28/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>